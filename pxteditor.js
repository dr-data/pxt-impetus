var pxt;!function(e){var t,r;t=e.editor||(e.editor={}),(r=t.FilterState||(t.FilterState={}))[r.Hidden=0]="Hidden",r[r.Visible=1]="Visible",r[r.Disabled=2]="Disabled",t.initExtensionsAsync=function(e){return Promise.resolve({})},t.initFieldExtensionsAsync=function(e){return Promise.resolve({})}}(pxt||(pxt={})),function(w){!function(e){var y={};function v(e,t,r,o){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:r,error:o},"*")}function a(o){return new Promise(function(e,t){var r=w.Util.clone(o);r.id=ts.pxtc.Util.guidGen(),o.response&&(y[r.id]={resolve:e,reject:t}),window.parent.postMessage(r,"*"),o.response||e(void 0)})}e.bindEditorMessages=function(m){var g=(w.appTarget.appTheme.allowParentController||w.shell.isControllerMode())&&w.BrowserUtils.isIFrame(),b=w.appTarget.appTheme.allowPackageExtensions,h=w.appTarget.appTheme.allowSimulatorTelemetry;(g||b||h)&&window.addEventListener("message",function(e){var t=e.data;if(!t||!/^pxt(host|editor|pkgext|sim)$/.test(t.type))return!1;if("pxtpkgext"===t.type&&b)m.handleExtensionRequest(t);else if("pxtsim"===t.type&&h){var r=t;"event"===r.action&&(r.category||r.message?w.reportError(r.category,r.message,r.data):w.tickEvent(r.tick,r.data))}else if(g){var o=Promise.resolve(),n=void 0;if("pxthost"==t.type){var a=y[t.id];a?o=o.then(function(){return a.resolve(t)}):w.debug("pxthost: unknown request "+t.id)}else if("pxteditor"==t.type){var s=t;switch(w.debug("pxteditor: "+s.action),s.action.toLowerCase()){case"switchjavascript":o=o.then(function(){return m.openJavaScript()});break;case"switchblocks":o=o.then(function(){return m.openBlocks()});break;case"startsimulator":o=o.then(function(){return m.startSimulator()});break;case"restartsimulator":o=o.then(function(){return m.restartSimulator()});break;case"hidesimulator":o=o.then(function(){return m.collapseSimulator()});break;case"showsimulator":o=o.then(function(){return m.expandSimulator()});break;case"closeflyout":o=o.then(function(){return m.closeFlyout()});break;case"redo":o=o.then(function(){var e=m.editor;e&&e.hasRedo()&&e.redo()});break;case"undo":o=o.then(function(){var e=m.editor;e&&e.hasUndo()&&e.undo()});break;case"setscale":var i=t;o=o.then(function(){return m.editor.setScale(i.scale)});break;case"stopsimulator":var c=t;o=o.then(function(){return m.stopSimulator(c.unload)});break;case"newproject":var l=t;o=o.then(function(){return m.newProject(l.options)});break;case"importproject":var u=t;o=o.then(function(){return m.importProjectAsync(u.project,{filters:u.filters,searchBar:u.searchBar})});break;case"proxytosim":var p=t;o=o.then(function(){return m.proxySimulatorMessage(p.content)});break;case"renderblocks":var d=t;o=o.then(function(){return m.renderBlocksAsync(d)}).then(function(e){n=e.xml});break;case"toggletrace":var f=t;o=o.then(function(){return m.toggleTrace(f.intervalSpeed)})}}o.done(function(){return v(t,n,!0,void 0)},function(e){return v(t,n,!1,e)})}return!0},!1)},e.enableControllerAnalytics=function(){if(w.appTarget.appTheme.allowParentController&&w.BrowserUtils.isIFrame()){var r=w.tickEvent;w.tickEvent=function(e,t){r&&r(e,t),a({type:"pxthost",action:"event",tick:e,response:!1,data:t})};var o=w.reportException;w.reportException=function(e,t){o&&o(e,t);try{a({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}};var n=w.reportError;w.reportError=function(e,t,r){n&&n(e,t,r),a({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:r})}}},e.postHostMessageAsync=a}(w.editor||(w.editor={}))}(pxt||(pxt={})),function(e){var t,r;t=e.editor||(e.editor={}),(r=t.PermissionResponses||(t.PermissionResponses={}))[r.Granted=0]="Granted",r[r.Denied=1]="Denied",r[r.NotAvailable=2]="NotAvailable"}(pxt||(pxt={})),function(i){!function(e){var r,o=function(){function e(){this.items={}}return e.prototype.removeItem=function(e){delete this.items[e]},e.prototype.getItem=function(e){return this.items[e]},e.prototype.setItem=function(e,t){this.items[e]=t},e.prototype.clear=function(){this.items={}},e}(),n=function(){function e(e){this.storageId=e}return e.prototype.targetKey=function(e){return this.storageId+"/"+e},e.prototype.removeItem=function(e){window.localStorage.removeItem(this.targetKey(e))},e.prototype.getItem=function(e){return window.localStorage[this.targetKey(e)]},e.prototype.setItem=function(e,t){window.localStorage[this.targetKey(e)]=t},e.prototype.clear=function(){for(var e=this.targetKey(""),t=[],r=0;r<window.localStorage.length;++r){var o=window.localStorage.key(r);0==o.indexOf(e)&&t.push(o)}t.forEach(function(e){return window.localStorage.removeItem(e)})},e}();function a(){if(i.appTarget)return i.appTarget.id;var e=window.pxtConfig;if(e)return e.targetId;var t=window.pxtTargetBundle;return t?t.id:""}function s(){if(!r){var e=a(),t=!1;if(!i.shell.isSandboxMode())try{window.localStorage[e]="1";window.localStorage[e];t=!0}catch(e){}t?(r=new n(e),i.debug("storage: local under "+e)):(r=new o,i.debug("storage: in memory"))}}e.storageId=a,e.setLocal=function(e,t){s(),r.setItem(e,t)},e.getLocal=function(e){return s(),r.getItem(e)},e.removeLocal=function(e){s(),r.removeItem(e)},e.clearLocal=function(){s(),r.clear()}}(i.storage||(i.storage={}))}(pxt||(pxt={})),function(o){!function(e){function s(e){var t=o.appTarget.appTheme.invertedMonaco,r=monaco.editor.create(e,{model:null,ariaLabel:o.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!1,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,minimap:{enabled:!1},autoIndent:!0,dragAndDrop:!0,matchBrackets:!0,occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",accessibilityHelpUrl:""});return r.layout(),r}e.syncModels=function(e,n,a,t){if(!t){var r=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),s={};e.sortedDeps().forEach(function(o){o.getFiles().forEach(function(e){var t=o.id+"/"+e;if(/\.(ts)$/.test(e)&&t!=a){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]){var r=o.readFile(e)||" ";n[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(r,t)}s[t]="1"}})}),Object.keys(r).filter(function(e){return/\.(ts)$/.test(e)&&!s[e]}).forEach(function(e){n[e].dispose()})}},e.initMonacoAsync=function(a){return new Promise(function(t,e){if("object"!=typeof window.monaco){var r=window.MonacoPaths,o=function(){var e=window.require;e.config({paths:r}),e(["vs/editor/editor.main"],function(){monaco.languages.typescript&&(monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1}),monaco.languages.typescript.typescriptDefaults.setMaximunWorkerIdleTime(12e5)),t(s(a))})};if(window.require)o();else{var n=document.createElement("script");n.type="text/javascript",n.src=r["vs/loader"],n.addEventListener("load",o),document.body.appendChild(n)}}else t(s(a))})},e.createEditor=s}(o.vs||(o.vs={}))}(pxt||(pxt={})),function(l){!function(e){var a,t,s;(t=a=e.EditorLayoutType||(e.EditorLayoutType={}))[t.IDE=0]="IDE",t[t.Sandbox=1]="Sandbox",t[t.Widget=2]="Widget";var i=!(t[t.Controller=3]="Controller");function r(){if(void 0===s){var e=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||l.BrowserUtils.isIFrame(),t=/nosandbox=1/i.test(window.location.href),r=/controller=1/i.test(window.location.href)&&l.BrowserUtils.isIFrame(),o=/readonly=1/i.test(window.location.href),n=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href);if(s=a.IDE,t?s=a.Widget:r?s=a.Controller:e&&(s=a.Sandbox),r&&o&&(i=!0),n)switch(n[1].toLowerCase()){case"widget":s=a.Widget;break;case"sandbox":s=a.Sandbox;break;case"ide":s=a.IDE}l.debug("shell: layout type "+a[s]+", readonly "+c())}}function o(){return r(),s==a.Sandbox}function c(){return o()&&!/[?&]edit=1/i.test(window.location.href)||n()&&i}function n(){return r(),s==a.Controller}e.layoutTypeClass=function(){return r(),l.shell.EditorLayoutType[s].toLowerCase()},e.isSandboxMode=o,e.isReadOnly=c,e.isControllerMode=n}(l.shell||(l.shell={}))}(pxt||(pxt={})),function(r){(r.workspace||(r.workspace={})).freshHeader=function(e,t){return{target:r.appTarget.id,targetVersion:r.appTarget.versions.target,name:e,meta:{},editor:r.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:r.U.guidGen(),recentUse:t,modificationTime:t,blobId:null,blobVersion:null,blobCurrent:!1,isDeleted:!1}}}(pxt||(pxt={}));