var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim,pxsim;!function(t){var e,n;(e=t.accessibility||(t.accessibility={})).makeFocusable=function(t){t.setAttribute("focusable","true"),t.setAttribute("tabindex","0")},e.enableKeyboardInteraction=function(t,n,i){n&&t.addEventListener("keydown",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||n()}),i&&t.addEventListener("keyup",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||i()})},e.setAria=function(t,e,n){e&&!t.hasAttribute("role")&&t.setAttribute("role",e),n&&!t.hasAttribute("aria-label")&&t.setAttribute("aria-label",n)},e.setLiveContent=function(t){n||((n=document.createElement("div")).setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-hidden","false"),n.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(n)),n.textContent!==t&&(n.textContent=t)}}(pxsim||(pxsim={})),function(v){var c="blue",p="red";var d=function(t){return 0<t.reduce(function(t,e){return t+(e?1:0)},0)};function m(t,e){var n={};for(var i in t)n[i]=t[i];for(var r in e)n[r]=e[r];return n}function h(t){v.U.assert(!!t,"Invalid pin: "+t);var e=/^(\w+)\.\s*(?:[a-z]*)?([A-Z][A-Z\d_]+)$/.exec(t);return e?e[2]:void 0}function f(t){return"-Z"===t.orientation&&"male"===t.style}v.readPin=h;var e=function(){function t(t){this.availablePowerPins={top:{threeVolt:v.mkRange(26,51).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:v.mkRange(26,51).map(function(t){return{type:"breadboard",row:"-",col:""+t}})},bottom:{threeVolt:v.mkRange(1,26).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:v.mkRange(1,26).map(function(t){return{type:"breadboard",row:"-",col:""+t}})}},this.opts=t}return t.prototype.allocPartIRs=function(n,i,g){var e=this,r=[],a=function(t,e,n,i){for(var r=[],o=0;o<t.numberOfPins;o++){var s=t.pinDefinitions[o],a=void 0;if("string"==typeof s.target)a=s.target;else{var u=s.target.pinInstantiationIdx;v.U.assert(!!n&&void 0!==n[u],"No pin found for PinInstantiationIdx: "+u+'. (Is the part missing an ArgumentRole or "trackArgs=" annotations?)'),a=n[u]}var l=t.visual.pinLocations[o],c=g.yOffset+l.y,p=Math.round(c/t.visual.pinDistance),d=c-p*t.visual.pinDistance,h=g.xOffset+l.x,f=Math.round(h/t.visual.pinDistance),m={partRelativeRowIdx:p,partRelativeColIdx:f,xOffset:h-f*t.visual.pinDistance,yOffset:d};r.push({def:s,loc:l,target:a,bbFit:m})}return{name:e,def:t,pins:r,partParams:i||{},bbFit:g}};if("singleton"===n.instantiation.kind)r.push(a(n,i));else if("function"===n.instantiation.kind){var u=n.instantiation,l=u.fullyQualifiedName.split(","),o={};l.forEach(function(t){e.opts.fnArgs[t]&&e.opts.fnArgs[t].forEach(function(t){o[t]=1})});var t=Object.keys(o);v.U.assert(!!t&&!!t.length,"Failed to read pin(s) from callsite for: "+l),t.forEach(function(t){var e=t.split(",");v.U.assert(e.length===u.argumentRoles.length,"Mismatch between number of arguments at callsite (function name: "+l+") vs number of argument roles in part definition (part: "+i+").");var o=[],s={};e.forEach(function(t,e){var n=u.argumentRoles[e];if(void 0!==n.partParameter&&(s[n.partParameter]=t),void 0!==n.pinInstantiationIdx){var i=n.pinInstantiationIdx,r=h(t);o[i]=r}}),r.push(a(n,i,o,s))})}return r},t.prototype.computePartDimensions=function(t,e){var n=t.visual.pinLocations,o=t.pinDefinitions,i=t.numberOfPins;v.U.assert(n.length===i,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+e+'"'),v.U.assert(o.length===i,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+e+'"'),v.U.assert(0<i,'Part "'+e+'" has no pins');var r,s,a,u,l=n.map(function(t,e){return n={idx:e},i=t,r=o[e],m(m(n,i),r);var n,i,r}).filter(function(t){return"-Z"===t.orientation}),c=0<l.length,p=t.visual.pinDistance;if(c){var d=l[0],h=Math.ceil(d.x/p),f=Math.ceil(d.y/p);r=h*p-d.x,s=f*p-d.y,a=Math.ceil((r+t.visual.width)/p)+1,u=Math.ceil((s+t.visual.height)/p)+1}else a=Math.ceil(t.visual.width/p),u=Math.ceil(t.visual.height/p),r=a*p-t.visual.width,s=u*p-t.visual.height;return{xOffset:r,yOffset:s,rowCount:u,colCount:a}},t.prototype.allocColumns=function(t){var e=t.length,n=v.visuals.BREADBOARD_MID_COLS-t.map(function(t){return t.colCount}).reduce(function(t,e){return t+e},0);n<=0&&console.log("Not enough breadboard space!");var i=Math.floor(n/(e-1+2)),r=n-i*(e-1),o=Math.floor(r/2),s=(Math.ceil(r/2),1+o);return t.map(function(t){var e=s;return s+=t.colCount+i,e})},t.prototype.placeParts=function(t){var i=v.visuals.BREADBOARD_MID_ROWS+2,r=this.allocColumns(t.map(function(t){return t.bbFit})),o=t.map(function(t){var e=i-t.bbFit.rowCount,n=Math.floor(e/2);return 4<n&&(n=4),n<1&&(n=1),n});return t.map(function(t,e){var n=o[e];return m({startColumnIdx:r[e],startRowIdx:n},t)})},t.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=v.visuals.GPIO_WIRE_COLORS.map(function(t){return t})),this.availableWireColors.pop()},t.prototype.allocWireIRs=function(a){var u=this,l=[],t=a.pins.map(function(t,e){var n,i=t.target,r=a.startColumnIdx+t.bbFit.partRelativeColIdx,o=v.visuals.getColumnName(r),s=a.startRowIdx+t.bbFit.partRelativeRowIdx;(7<=s&&(s-=2),f(t.def))?n={type:"breadboard",row:s<5?"j":"a",col:o,style:t.def.style}:n={type:"breadboard",row:v.visuals.getRowName(s),col:o,xOffset:t.bbFit.xOffset/a.def.visual.pinDistance,yOffset:t.bbFit.yOffset/a.def.visual.pinDistance,style:t.def.style};return{start:n,end:i,color:"ground"===i?c:"threeVolt"===i?p:"number"==typeof t.def.colorGroup?l[t.def.colorGroup]?l[t.def.colorGroup]:l[t.def.colorGroup]=u.nextColor():u.nextColor(),pinIdx:e}});return m(a,{wires:t})},t.prototype.allocLocation=function(t,e){var n=this;if("ground"===t||"threeVolt"===t){if("ground"===t&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===t&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};v.U.assert(!!e.referenceBBPin);var i=this.opts.getBBCoord(e.referenceBBPin),r=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(t){return n.opts.getBBCoord(t)});r[0]&&r[1]||console.debug('No more available "'+t+'" locations!');var o=0==v.visuals.findClosestCoordIdx(i,r),s=void 0;o?"ground"===t?s=this.availablePowerPins.top.ground:"threeVolt"===t&&(s=this.availablePowerPins.top.threeVolt):"ground"===t?s=this.availablePowerPins.bottom.ground:"threeVolt"===t&&(s=this.availablePowerPins.bottom.threeVolt);var a=s.map(function(t){return n.opts.getBBCoord(t)}),u=v.visuals.findClosestCoordIdx(i,a),l=s[u];return o?(this.availablePowerPins.top.ground.splice(u,1),this.availablePowerPins.top.threeVolt.splice(u,1)):(this.availablePowerPins.bottom.ground.splice(u,1),this.availablePowerPins.bottom.threeVolt.splice(u,1)),l}if("breadboard"===t.type)return t;if("MOSI"===t||"MISO"===t||"SCK"===t)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.spiPins[t]};if("SDA"===t||"SCL"===t)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:l=this.opts.boardDef.i2cPins[t]};v.U.assert("string"==typeof t,"Unknown location type: "+t);var c=t,p=this.opts.boardDef.gpioPinMap[c];return p?{type:"dalboard",pin:p}:void 0},t.prototype.getBoardGroundPin=function(){var t=this.opts.boardDef.groundPins[0]||null;return t||console.log("No available ground pin on board!"),t},t.prototype.getBoardThreeVoltPin=function(){var t=this.opts.boardDef.threeVoltPins[0]||null;return t||console.log("No available 3.3V pin on board!"),t},t.prototype.allocPowerWires=function(t){var e,n,i=this.getBoardGroundPin(),r=this.getBoardThreeVoltPin();this.opts.boardDef.attachPowerOnRight?(e={type:"breadboard",row:"-",col:"50"},n={type:"breadboard",row:"-",col:"25"}):(e={type:"breadboard",row:"-",col:"26"},n={type:"breadboard",row:"-",col:"1"});var o=[],s=[];t.bottomGround&&t.topGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:this.allocLocation("ground",{referenceBBPin:n}),color:c}),t.topGround?o.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:{type:"dalboard",pin:i},color:c}):t.bottomGround&&o.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:c}),t.bottomThreeVolt&&t.bottomGround&&s.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:p}),t.topThreeVolt?s.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:{type:"dalboard",pin:r},color:p}):t.bottomThreeVolt&&s.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:p});var a=[];0<o.length&&a.push({wireIndices:o.map(function(t,e){return e})});var u=o.length;return 0<s.length&&a.push({wireIndices:s.map(function(t,e){return e+u})}),{wires:o.concat(s),assembly:a}},t.prototype.allocWire=function(t){var i=this,r=[t.start,t.end],n=r.map(function(t){return"ground"===t||"threeVolt"===t}),o=r.map(function(t,e){return n[e]?void 0:i.allocLocation(t,{})});if((o=o.map(function(t,e){if(t)return t;var n=o[1-e];return i.allocLocation(r[e],{referenceBBPin:n})}))[0]&&o[1])return{start:o[0],end:o[1],color:t.color}},t.prototype.allocPart=function(r){var t=r.pins.filter(function(t){return f(t.def)}).map(function(t){var e=r.startRowIdx+t.bbFit.partRelativeRowIdx;7<=e&&(e-=2);var n=v.visuals.getRowName(e),i=r.startColumnIdx+t.bbFit.partRelativeColIdx;return{type:"breadboard",row:n,col:v.visuals.getColumnName(i)}});return{name:r.name,visual:r.def.visual,bbFit:r.bbFit,startColumnIdx:r.startColumnIdx,startRowIdx:r.startRowIdx,breadboardConnections:t,params:r.partParams,simulationBehavior:r.def.simulationBehavior}},t.prototype.allocAll=function(){var t,o=this,e=this.opts.partsList.map(function(t){return{name:t,def:o.opts.partDefs[t]}}).filter(function(t){return!!t.def});if(0<e.length){e.map(function(t){return t.name}),e.map(function(t){return t.def});var r=e.map(function(t){return o.computePartDimensions(t.def,t.name)}),s=[];e.forEach(function(t,e){var n=r[e],i=o.allocPartIRs(t.def,t.name,n);s=s.concat(i)});var n=this.placeParts(s).map(function(t){return o.allocWireIRs(t)}),i=n.map(function(t){return t.wires}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){return n=[(e=t).start,e.end],i=n.map(function(t){return"ground"===t}),r=n.map(function(t){return"threeVolt"===t}),o=n.map(function(t){return function(t){var e=!1;if("string"!=typeof t&&"breadboard"===t.type){var n=t.row;e=0<=["a","b","c","d","e"].indexOf(n)}return e}(t)}),s=d(i),a=d(r),u=d(o),{topGround:s&&!u,topThreeVolt:a&&!u,bottomGround:s&&u,bottomThreeVolt:a&&u,singleGround:s,singleThreeVolt:a};var e,n,i,r,o,s,a,u});this.powerUsage=((t=i.reduce(function(t,e){return{topGround:t.topGround||e.topGround,topThreeVolt:t.topThreeVolt||e.topThreeVolt,bottomGround:t.bottomGround||e.bottomGround,bottomThreeVolt:t.bottomThreeVolt||e.bottomThreeVolt,singleGround:e.singleGround?null===t.singleGround:t.singleGround,singleThreeVolt:e.singleThreeVolt?null===t.singleThreeVolt:t.singleThreeVolt}},{topGround:!1,topThreeVolt:!1,bottomGround:!1,bottomThreeVolt:!1,singleGround:null,singleThreeVolt:null})).singleGround&&(t.topGround=t.bottomGround=!1),t.singleThreeVolt&&(t.topThreeVolt=t.bottomThreeVolt=!1),t);var a=this.allocPowerWires(this.powerUsage),u=n.map(function(t,e){var n=o.allocPart(t),i=t.wires.map(function(t){return o.allocWire(t)});if(!i.some(function(t){return!t})){var r=[];return t.wires.forEach(function(t,e){r[t.pinIdx]=e}),{part:n,wires:i,assembly:t.def.assembly.map(function(t){return{part:t.part,wireIndices:(t.pinIndices||[]).map(function(t){return r[t]})}})}}}).filter(function(t){return!!t}),l=[a].concat(u);return{partsAndWires:l,requiresBreadboard:l.some(function(t){return t.part&&t.part.breadboardConnections&&0<t.part.breadboardConnections.length||t.wires&&t.wires.some(function(t){return"breadboard"==t.end.type&&"croc"!=t.end.style||"breadboard"==t.start.type&&"croc"!=t.start.style})})}}return{partsAndWires:[]}},t}();v.allocateDefinitions=function(t){return new e(t).allocAll()}}(pxsim||(pxsim={})),function(t){!function(a){var t=function(t){this.seq=0,this.type=t},e=function(i){function t(t,e){var n=i.call(this,"response")||this;return n.request_seq=t.seq,n.command=t.command,e?(n.success=!1,n.message=e):n.success=!0,n}return __extends(t,i),t}(a.Message=t);a.Response=e;var n=function(i){function t(t,e){var n=i.call(this,"event")||this;return n.event=t,e&&(n.body=e),n}return __extends(t,i),t}(t);a.Event=n;var i=function(t,e,n,i,r){void 0===n&&(n=0),this.name=t,this.path=e,this.sourceReference=n,i&&(this.origin=i),r&&(this.adapterData=r)};a.Source=i;var r=function(t,e,n){void 0===n&&(n=!1),this.name=t,this.variablesReference=e,this.expensive=n};a.Scope=r;var o=function(t,e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this.id=t,this.source=n,this.line=i,this.column=r,this.name=e};a.StackFrame=o;var s=function(t,e){this.id=t,this.name=e||"Thread #"+t};a.Thread=s;var u=function(t,e,n,i,r){void 0===n&&(n=0),this.name=t,this.value=e,this.variablesReference=n,"number"==typeof r&&(this.namedVariables=r),"number"==typeof i&&(this.indexedVariables=i)};a.Variable=u;var l=function(t,e,n,i){this.verified=t,"number"==typeof e&&(this.line=e),"number"==typeof n&&(this.column=n),i&&(this.source=i)};a.Breakpoint=l;var c=function(t,e){this.id=t,this.name=e};a.Module=c;var p=function(t,e,n){void 0===n&&(n=0),this.label=t,this.start=e,this.length=n};a.CompletionItem=p;var d=function(r){function t(t,e,n){void 0===n&&(n=null);var i=r.call(this,"stopped")||this;(i.body={reason:t,threadId:e},n)&&(i.body.text=n);return i}return __extends(t,r),t}(n);a.StoppedEvent=d;var h=function(i){function t(t,e){var n=i.call(this,"continued")||this;return n.body={threadId:t},"boolean"==typeof e&&(n.body.allThreadsContinued=e),n}return __extends(t,i),t}(n);a.ContinuedEvent=h;var f=function(t){function e(){return t.call(this,"initialized")||this}return __extends(e,t),e}(n);a.InitializedEvent=f;var m=function(n){function t(t){var e=n.call(this,"terminated")||this;"boolean"==typeof t&&(e.body={restart:t});return e}return __extends(t,n),t}(n);a.TerminatedEvent=m;var g=function(r){function t(t,e,n){void 0===e&&(e="console");var i=r.call(this,"output")||this;return i.body={category:e,output:t},void 0!==n&&(i.body.data=n),i}return __extends(t,r),t}(n);a.OutputEvent=g;var v=function(i){function t(t,e){var n=i.call(this,"thread")||this;return n.body={reason:t,threadId:e},n}return __extends(t,i),t}(n);a.ThreadEvent=v;var b=function(i){function t(t,e){var n=i.call(this,"breakpoint")||this;return n.body={reason:t,breakpoint:e},n}return __extends(t,i),t}(n);a.BreakpointEvent=b;var y=function(i){function t(t,e){var n=i.call(this,"module")||this;return n.body={reason:t,module:e},n}return __extends(t,i),t}(n);a.ModuleEvent=y;var w=function(){function t(){this._pendingRequests={}}return t.prototype.start=function(t){var i=this;this._sequence=1,this.host=t,this.host.onData(function(t){if("request"===t.type)i.dispatchRequest(t);else if("response"===t.type){var e=t,n=i._pendingRequests[e.seq];n&&(delete i._pendingRequests[e.seq],n(e))}})},t.prototype.stop=function(){this.host&&this.host.close()},t.prototype.sendEvent=function(t){this.send("event",t)},t.prototype.sendResponse=function(t){0<t.seq?console.error("attempt to send more than one response for command "+t.command):this.send("response",t)},t.prototype.sendRequest=function(t,e,n,i){var r=this,o={command:t};if(e&&0<Object.keys(e).length&&(o.arguments=e),this.send("request",o),i){this._pendingRequests[o.seq]=i;var s=setTimeout(function(){clearTimeout(s);var t=r._pendingRequests[o.seq];t&&(delete r._pendingRequests[o.seq],t(new a.Response(o,"timeout")))},n)}},t.prototype.send=function(t,e){if(e.type=t,e.seq=this._sequence++,this.host){var n=JSON.stringify(e);this.host.send(n)}},t.prototype.dispatchRequest=function(t){},t}(),x=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t._debuggerLinesStartAt1=!1,t._debuggerColumnsStartAt1=!1,t._clientLinesStartAt1=!0,t._clientColumnsStartAt1=!0,t}return __extends(o,e),o.prototype.shutdown=function(){},o.prototype.dispatchRequest=function(t){var e=new a.Response(t);try{if("initialize"===t.command){var n=t.arguments;if("boolean"==typeof n.linesStartAt1&&(this._clientLinesStartAt1=n.linesStartAt1),"boolean"==typeof n.columnsStartAt1&&(this._clientColumnsStartAt1=n.columnsStartAt1),"path"!==n.pathFormat)this.sendErrorResponse(e,2018,"debug adapter only supports native paths",null);else{var i=e;i.body={},this.initializeRequest(i,n)}}else"launch"===t.command?this.launchRequest(e,t.arguments):"attach"===t.command?this.attachRequest(e,t.arguments):"disconnect"===t.command?this.disconnectRequest(e,t.arguments):"setBreakpoints"===t.command?this.setBreakPointsRequest(e,t.arguments):"setFunctionBreakpoints"===t.command?this.setFunctionBreakPointsRequest(e,t.arguments):"setExceptionBreakpoints"===t.command?this.setExceptionBreakPointsRequest(e,t.arguments):"configurationDone"===t.command?this.configurationDoneRequest(e,t.arguments):"continue"===t.command?this.continueRequest(e,t.arguments):"next"===t.command?this.nextRequest(e,t.arguments):"stepIn"===t.command?this.stepInRequest(e,t.arguments):"stepOut"===t.command?this.stepOutRequest(e,t.arguments):"stepBack"===t.command?this.stepBackRequest(e,t.arguments):"restartFrame"===t.command?this.restartFrameRequest(e,t.arguments):"goto"===t.command?this.gotoRequest(e,t.arguments):"pause"===t.command?this.pauseRequest(e,t.arguments):"stackTrace"===t.command?this.stackTraceRequest(e,t.arguments):"scopes"===t.command?this.scopesRequest(e,t.arguments):"variables"===t.command?this.variablesRequest(e,t.arguments):"setVariable"===t.command?this.setVariableRequest(e,t.arguments):"source"===t.command?this.sourceRequest(e,t.arguments):"threads"===t.command?this.threadsRequest(e):"evaluate"===t.command?this.evaluateRequest(e,t.arguments):"stepInTargets"===t.command?this.stepInTargetsRequest(e,t.arguments):"gotoTargets"===t.command?this.gotoTargetsRequest(e,t.arguments):"completions"===t.command?this.completionsRequest(e,t.arguments):this.customRequest(t.command,e,t.arguments)}catch(t){this.sendErrorResponse(e,1104,"{_stack}",{_exception:t.message,_stack:t.stack})}},o.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsConfigurationDoneRequest=!0,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,this.sendResponse(t)},o.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},o.prototype.launchRequest=function(t,e){this.sendResponse(t)},o.prototype.attachRequest=function(t,e){this.sendResponse(t)},o.prototype.setBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setFunctionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.setExceptionBreakPointsRequest=function(t,e){this.sendResponse(t)},o.prototype.configurationDoneRequest=function(t,e){this.sendResponse(t)},o.prototype.continueRequest=function(t,e){this.sendResponse(t)},o.prototype.nextRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInRequest=function(t,e){this.sendResponse(t)},o.prototype.stepOutRequest=function(t,e){this.sendResponse(t)},o.prototype.stepBackRequest=function(t,e){this.sendResponse(t)},o.prototype.restartFrameRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoRequest=function(t,e){this.sendResponse(t)},o.prototype.pauseRequest=function(t,e){this.sendResponse(t)},o.prototype.sourceRequest=function(t,e){this.sendResponse(t)},o.prototype.threadsRequest=function(t){this.sendResponse(t)},o.prototype.stackTraceRequest=function(t,e){this.sendResponse(t)},o.prototype.scopesRequest=function(t,e){this.sendResponse(t)},o.prototype.variablesRequest=function(t,e){this.sendResponse(t)},o.prototype.setVariableRequest=function(t,e){this.sendResponse(t)},o.prototype.evaluateRequest=function(t,e){this.sendResponse(t)},o.prototype.stepInTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.gotoTargetsRequest=function(t,e){this.sendResponse(t)},o.prototype.completionsRequest=function(t,e){this.sendResponse(t)},o.prototype.customRequest=function(t,e,n){this.sendErrorResponse(e,1014,"unrecognized request",null)},o.prototype.sendErrorResponse=function(t,e,n,i){var r;"number"==typeof e?(r={id:e,format:n},i&&(r.variables=i),r.showUser=!0):r=e,t.success=!1,o.formatPII(r.format,!0,r.variables),t.body||(t.body={}),t.body.error=r,this.sendResponse(t)},o.prototype.convertClientLineToDebugger=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t+1:this._clientLinesStartAt1?t-1:t},o.prototype.convertDebuggerLineToClient=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t-1:this._clientLinesStartAt1?t+1:t},o.prototype.convertClientColumnToDebugger=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t+1:this._clientColumnsStartAt1?t-1:t},o.prototype.convertDebuggerColumnToClient=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t-1:this._clientColumnsStartAt1?t+1:t},o.prototype.convertClientPathToDebugger=function(t){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.prototype.convertDebuggerPathToClient=function(t){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?o.uri2path(t):o.path2uri(t):t},o.path2uri=function(t){var e=t.replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},o.uri2path=function(t){return t},o.formatPII=function(t,n,i){return t.replace(o._formatPIIRegexp,function(t,e){return n&&0<e.length&&"_"!==e[0]?t:i[e]&&i.hasOwnProperty(e)?i[e]:t})},o._formatPIIRegexp=/{([^}]+)}/g,o}(a.ProtocolServer=w);a.DebugSession=x}(t.protocol||(t.protocol={}))}(pxsim||(pxsim={})),function(t){!function(t){t.injectPolyphils=function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,i=arguments[1]>>0,r=i<0?Math.max(n+i,0):Math.min(i,n),o=arguments[2],s=void 0===o?n:o>>0,a=s<0?Math.max(n+s,0):Math.min(s,n);r<a;)e[r]=t,r++;return e}}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint16Array.prototype.fill||Object.defineProperty(Uint16Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0}),Uint32Array.prototype.fill||Object.defineProperty(Uint32Array.prototype,"fill",{value:Array.prototype.fill,writable:!0,enumerable:!0})};var e=function(){function t(t){this._func=t,this._evaluated=!1}return Object.defineProperty(t.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),t}();function u(t){t=t.replace(/\\/g,"/");var e=[];return t.split("/").forEach(function(t){".."===t&&e.length?e.pop():t&&"."!==t&&e.push(t)}),e}t.Lazy=e,t.getNormalizedParts=u,t.normalizePath=function(t){return u(t).join("/")},t.relativePath=function(t,e){for(var n=u(t),i=u(e),r=0;n[r]===i[r]&&++r!==n.length&&r!==i.length;);for(var o=n.slice(r),s=i.slice(r),a=0;a<o.length;a++)s.unshift("..");return s.join("/")},t.pathJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";return t.forEach(function(t){t.replace(/\\/g,"/"),t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,t.length-1)),n+="/"+t}),n},t.toArray=function(t){if(Array.isArray(t))return t;for(var e=[],n=0;n<t.length;++n)e.push(t[n]);return e}}(t.util||(t.util={}))}(pxsim||(pxsim={})),function(u){u.getWarningMessage=function(t){for(var e={type:"debugger",subtype:"warning",breakpointIds:[],message:t},n=u.runtime.currFrame;null!=n;)e.breakpointIds.push(n.lastBrkId),n=n.parent;return e};var t=function(){function t(t){var i=this;for(var e in this.fileMap={},this.idMap={},t.forEach(function(t){var e=t[0],n=t[1];i.fileMap[n.source.path]||(i.fileMap[n.source.path]=[]),i.fileMap[n.source.path].push(t),i.idMap[e]=n}),this.fileMap){var n=this.fileMap[e];this.fileMap[e]=n.sort(function(t,e){var n=t[1],i=e[1];return n.line===i.line?i.endLine===n.endLine?n.column-i.column:i.endLine-n.endLine:n.line-i.line})}}return t.prototype.getById=function(t){return this.idMap[t]},t.prototype.verifyBreakpoint=function(t,e){var n,i=this.fileMap[t];if(i)for(var r=0,o=i;r<o.length;r++){var s=o[r],a=s[0],u=s[1];u.line<=e.line&&u.endLine>=e.line&&(n=[a,u])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},t}();function o(t,e){function o(t){switch(typeof t){case"string":case"number":case"boolean":return t;case"function":return{text:"(function)"};case"undefined":return null;case"object":return t?t instanceof u.RefObject?{id:(e[t.id]=t).id,preview:u.RefObject.toDebugString(t)}:{text:"(object)"}:null;default:throw new Error}}return function(t){for(var e={},n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];!/^__/.test(r)&&/___\d+$/.test(r)&&(e[r.replace(/___\d+$/,"")]=o(t[r]))}return e}(t)}u.BreakpointMap=t,u.dumpHeap=o,u.getBreakpointMsg=function(t,e){for(var n={},i={type:"debugger",subtype:"breakpoint",breakpointId:e,globals:o(u.runtime.globals,n),stackframes:[]};null!=t;){var r=t.fn?t.fn.info:null;r&&i.stackframes.push({locals:o(t,n),funcInfo:r,breakpointId:t.lastBrkId}),t=t.parent}return{msg:i,heap:n}};var e=function(i){function n(t){var e=i.call(this)||this,n={onDebuggerBreakpoint:function(t){return e.onDebuggerBreakpoint(t)},onDebuggerWarning:function(t){return e.onDebuggerWarning(t)},onDebuggerResume:function(){return e.onDebuggerResume()},onStateChanged:function(t){return e.onStateChanged(t)}};return e.driver=new u.SimulatorDriver(t,n),e}return __extends(n,i),n.prototype.runCode=function(t,e,n,i,r){this.breakpoints=i,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new u.protocol.InitializedEvent),this.driver.run(t,{parts:e,fnArgs:n,boardDefinition:r})},n.prototype.stopSimulator=function(t){void 0===t&&(t=!1),this.driver.stop(t)},n.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,t.body.supportsConfigurationDoneRequest=!0,this.sendResponse(t)},n.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},n.prototype.launchRequest=function(t,e){this.projectDir||(this.projectDir=u.util.normalizePath(e.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(t)},n.prototype.setBreakPointsRequest=function(r,o){var s=this;r.body={breakpoints:[]};var a=[];o.breakpoints.forEach(function(t){if(s.breakpoints){var e=s.breakpoints.verifyBreakpoint(u.util.relativePath(s.projectDir,o.source.path),t),n=e[0],i=e[1];r.body.breakpoints.push(i),i.verified&&a.push(n)}else r.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(a),this.sendResponse(r)},n.prototype.continueRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Resume),this.sendResponse(t)},n.prototype.nextRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOver),this.sendResponse(t)},n.prototype.stepInRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepInto),this.sendResponse(t)},n.prototype.stepOutRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.StepOut),this.sendResponse(t)},n.prototype.pauseRequest=function(t,e){this.driver.resume(u.SimulatorDebuggerCommand.Pause),this.sendResponse(t)},n.prototype.threadsRequest=function(t){t.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(t)},n.prototype.stackTraceRequest=function(t,e){if(this.lastBreak){var n=this.state.getFrames();t.body={stackFrames:n}}this.sendResponse(t)},n.prototype.scopesRequest=function(t,e){this.state&&(t.body={scopes:this.state.getScopes(e.frameId)}),this.sendResponse(t)},n.prototype.variablesRequest=function(t,e){this.state&&(t.body={variables:this.state.getVariables(e.variablesReference)}),this.sendResponse(t)},n.prototype.onDebuggerBreakpoint=function(t){if(this.lastBreak=t,this.state=new r(this.lastBreak,this.breakpoints,this.projectDir),t.exceptionMessage){var e=t.exceptionMessage.replace(/___\d+/g,"");this.sendEvent(new u.protocol.StoppedEvent("exception",n.THREAD_ID,e))}else this.sendEvent(new u.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(t){},n.prototype.onDebuggerResume=function(){this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(t){switch(t){case u.SimulatorState.Paused:break;case u.SimulatorState.Running:this.sendEvent(new u.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case u.SimulatorState.Stopped:this.sendEvent(new u.protocol.TerminatedEvent);break;case u.SimulatorState.Unloaded:}},n.prototype.fixBreakpoints=function(){for(var t in this.breakpoints.idMap){var e=this.breakpoints.idMap[t];e.source.path=u.util.pathJoin(this.projectDir,e.source.path),e.line=this.convertDebuggerLineToClient(e.line),e.endLine=this.convertDebuggerLineToClient(e.endLine),e.column=this.convertDebuggerColumnToClient(e.column),e.endColumn=this.convertDebuggerColumnToClient(e.endColumn)}},n.THREAD_ID=1,n}(u.protocol.DebugSession);u.SimDebugSession=e;var r=function(){function t(t,e,n){this._message=t,this._map=e,this._dir=n,this._currentId=1,this._frames={},this._vars={};var i=this.nextId();this._vars[i]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:i,expensive:!1}}return t.prototype.getFrames=function(){var i=this;return this._message.stackframes.map(function(t,e){var n=i._map.getById(t.breakpointId);if(n)return{id:(i._frames[t.breakpointId]=t).breakpointId,name:t.funcInfo?t.funcInfo.functionName:0===e?"main":"anonymous",line:n.line,column:n.column,endLine:n.endLine,endColumn:n.endLine,source:n.source}}).filter(function(t){return!!t})},t.prototype.getScopes=function(t){var e=this._frames[t];if(e){var n=this.nextId();return this._vars[n]=this.getVariableValues(e.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},t.prototype.getVariables=function(t){var e=this._vars[t];return e&&e.value||[]},t.prototype.getVariableValues=function(s){var a=this;return new u.util.Lazy(function(){var t=[];for(var e in s){var n=s[e],i=void 0,r=0;null===n?i="null":void 0===n?i="undefined":"object"==typeof n?(i="(object)",r=a.nextId(),a._vars[r]=a.getVariableValues(n)):i=n.toString();var o=e.substr(0,e.lastIndexOf("___"));t.push({name:o,value:i,variablesReference:r})}return t})},t.prototype.nextId=function(){return this._currentId++},t}()}(pxsim||(pxsim={})),function(a){function u(t){function e(){try{window.print()}catch(t){}}void 0===t&&(t=0),t?setTimeout(e,t):e()}function i(t){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(t,"*")}function n(){setInterval(function(){a.Runtime.postMessage({type:"simulator",command:"reload"})},500)}a.print=u,function(t){function e(t){t.origin;var e=t.data||{},n=e.type||"";if(n)switch(n||""){case"run":o(e);break;case"instructions":a.instructions.renderInstructions(e);break;case"stop":r();break;case"mute":s(e.mute);break;case"print":u();break;case"custom":a.handleCustomMessage&&a.handleCustomMessage(e);break;case"pxteditor":break;case"debugger":i&&i.handleDebuggerMsg(e);break;default:!function(t){if(!i||i.dead)return;i.board.receiveMessage(t)}(e)}}var i;function r(){i&&(i.kill(),i.board&&i.board.kill())}function o(t){r(),t.mute&&s(t.mute),t.localizedStrings&&a.localization.setLocalizedStrings(t.localizedStrings),(i=new a.Runtime(t)).board.initAsync(t).done(function(){i.run(function(t){a.dumpLivePointers(),a.Runtime.postMessage({type:"toplevelcodefinished"})})})}function s(t){a.AudioContextManager.mute(t)}t.start=function(){window.addEventListener("message",e,!1);var t=window.location.hash.slice(1);"undefined"!=typeof window&&(window.applicationCache.status===window.applicationCache.UPDATEREADY&&n(),window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&n()})),a.Runtime.postMessage({type:"ready",frameid:t})},t.stop=r,t.run=o}(a.Embed||(a.Embed={})),a.tickEvent=function(t,e){i({type:"pxtsim",action:"event",tick:t,data:e})},a.reportError=function(t,e,n){i({type:"pxtsim",action:"event",tick:"error",category:t,message:e,data:n})},a.reload=n}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(t){pxsim.Embed.start()}),function(N){!function(t){var l=10,i=30,s=function(t){return t+"x"},a=20,T=3,M=5,L=5,c=40,p=50,d=1.5,e=[816*.95,1056*.95],n=[1,1],r=n[0],o=n[1],u=(e[0]-86.4)/o-48*o,h=465,f=400,O=1.7,m=.17,g=.25,v=.3,b=.23,y=u-36,w="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+u+"px;\n                height: "+((e[1]-86.4)/r-48*r)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((u-h)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";function x(t,e){t.classList?t.classList.add(e):t.className.indexOf(e)<0&&(t.className+=" "+e)}function C(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg","svg"),i={l:0,t:0,w:0,h:0},r=document.createElementNS("http://www.w3.org/2000/svg","svg");n.appendChild(r),r.appendChild(t.el);var o={viewBox:t.x+" "+t.y+" "+t.w+" "+t.h,preserveAspectRatio:"xMidYMid"};i.w=t.w,i.h=t.h;var s=function(t){i.h*=t,i.w*=t,o.width=i.w,o.height=i.h};e.cmpScale&&s(e.cmpScale),e.cmpWidth&&e.cmpWidth<i.w?s(e.cmpWidth/i.w):e.cmpHeight&&e.cmpHeight<i.h&&s(e.cmpHeight/i.h),N.svg.hydrate(r,o);var a=i.l,u=i.t,l=i.w,c=i.h,p=function(t){if(t<i.l){var e=i.l-t;i.l=t,i.w+=e}},d=function(t){var e=i.l+i.w;if(e<t){var n=t-e;i.w+=n}},h=function(t){if(t<i.t){var e=i.t-t;i.t=t,i.h+=e}},f=function(t){var e=i.t+i.h;if(e<t){var n=t-e;i.h+=n}},m=[-.3,.3],g=m[0],v=m[1],b=[1.4,1];if(e&&e.top){var y=(_=e.topSize)/b[0],w=[a+l/2,u-T-(E=_/b[1])/2],x=w[0],C=w[1],R=N.visuals.mkTxt(x,C,_,0,e.top,g,v);N.svg.addClass(R,"cmp-lbl"),n.appendChild(R);var k=y*e.top.length;h(C-E/2),p(x-k/2),d(x+k/2)}if(e&&e.bot){y=(_=e.botSize)/b[0];var I=[a+l/2,u+c+T+(E=_/b[1])/2];x=I[0],C=I[1],R=N.visuals.mkTxt(x,C,_,0,e.bot,g,v);N.svg.addClass(R,"cmp-lbl"),n.appendChild(R);k=y*e.bot.length;f(C+E/2),p(x-k/2),d(x+k/2)}if(e&&e.right){var E=(_=e.rightSize)/b[1],D=(k=(y=_/b[0])*e.right.length,[a+l+M+k/2,u+c/2]),S=(x=D[0],D[1]);R=N.visuals.mkTxt(x,S,_,0,e.right,g,v);N.svg.addClass(R,"cmp-lbl"),n.appendChild(R),h(S-E/2),d(x+k/2),f(S+E/2)}if(e&&e.left){E=(_=e.leftSize)/b[1],k=(y=_/b[0])*e.left.length;var _,B=[a-L-k/2,u+c/2];x=B[0],S=B[1],R=N.visuals.mkTxt(x,S,_,0,e.left,g,v);N.svg.addClass(R,"cmp-lbl"),n.appendChild(R),h(S-E/2),p(x-k/2),f(S+E/2)}var P={viewBox:i.l+" "+i.t+" "+i.w+" "+i.h,width:i.w*O,height:i.h*O,preserveAspectRatio:"xMidYMid"};N.svg.hydrate(n,P);var A=document.createElement("div");return A.appendChild(n),A}function R(t,e){var n,i=N.runtime.board;if("wire"==t)n=N.visuals.mkWirePart([0,0],e.wireClr||"red",e.crocClips);else{var r=t;if("string"==typeof r.builtIn)n=(0,i.builtinPartVisuals[r.builtIn])([0,0]);else n=N.visuals.mkGenericPartSVG(r)}return C(n,e)}function k(t,e,n){void 0===n&&(n=!1);var i={state:N.runtime.board,boardDef:t.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:t.allAlloc.requiresBreadboard,partDefs:t.cmpDefs,maxWidth:e+"px",fnArgs:t.fnArgs,wireframe:n,partsList:[]},r=new N.visuals.BoardHost(N.visuals.mkBoardView({visual:i.boardDef.visual,wireframe:i.wireframe}),i),o=r.getView();return N.svg.addClass(o,"board-svg"),r}function I(){var t=document.createElement("div");return x(t,"instr-panel"),t}function E(r){var t,o=I(),e=C((t=r.boardDef.visual,N.visuals.mkBoardView({visual:t}).getView()),{left:s(1),leftSize:i,cmpScale:m});o.appendChild(e);var n=C(new N.visuals.Breadboard({}).getSVGAndSize(),{left:s(1),leftSize:i,cmpScale:g});return o.appendChild(n),r.allCmps.forEach(function(t){var e=1;"buttonpair"===t.visual.builtIn&&(e=2);var n=R(t.visual,{left:s(e),leftSize:i,cmpScale:v});x(n,"partslist-cmp"),o.appendChild(n)}),r.allWireColors.forEach(function(t){var e=r.colorToWires[t].length,n=r.boardDef.pinStyles[t]||"female",i=R("wire",{left:s(e),leftSize:a,wireClr:t,cmpScale:b,crocClips:"croc"==n});x(i,"partslist-wire"),o.appendChild(i)}),o}function D(t,i){var e=I(),n=k(i,h,!0);!function(i,r,o){var t=i.getView();0<r&&N.svg.addClass(t,"grayed");for(var e=function(n){var t=o.stepToCmps[n];t&&t.forEach(function(t){var e=i.addPart(t);n===r&&(t.breadboardConnections.forEach(function(t){return i.highlightBreadboardPin(t)}),N.svg.addClass(e.element,"notgrayed"))});var e=o.stepToWires[n];e&&e.forEach(function(t){var e=i.addWire(t);n===r&&("breadboard"==t.start.type?i.highlightBreadboardPin(t.start):i.highlightBoardPin(t.start.pin),"breadboard"==t.end.type?i.highlightBreadboardPin(t.end):i.highlightBoardPin(t.end.pin),i.highlightWire(e))})},n=0;n<=r;n++)e(n)}(n,t,i),e.appendChild(n.getView());var r=document.createElement("div");x(r,"panel-num-outer"),x(r,"noselect"),e.appendChild(r);var o=document.createElement("div");x(o,"panel-num"),o.textContent=t+1+"",r.appendChild(o);var s=document.createElement("div");x(s,"reqs-div"),e.appendChild(s);var a=i.stepToWires[t]||[],u=function(t){if("breadboard"===t.type){var e=t;return"("+e.row+","+e.col+")"}return t.pin};return a.forEach(function(t){var e=!1;"dalboard"==t.end.type&&(e="croc"==i.boardDef.pinStyles[t.end.pin]);var n=R("wire",{top:u(t.end),topSize:l,bot:u(t.start),botSize:l,wireClr:t.color,cmpHeight:c,crocClips:e});x(n,"cmp-div"),s.appendChild(n)}),(i.stepToCmps[t]||[]).forEach(function(o){("buttonpair"===o.visual.builtIn?[o.breadboardConnections[0],o.breadboardConnections[2]]:[o.breadboardConnections[0]]).forEach(function(t,e){var n;t?n="("+t.row+","+t.col+")":n="";var i=d;"buttonpair"===o.visual.builtIn&&(i*=.5);var r=R(o.visual,{top:n,topSize:l,cmpHeight:p,cmpScale:i});x(r,"cmp-div"),s.appendChild(r)})}),e}function S(t,e){e.boardDef.pinStyles||(e.boardDef.pinStyles={}),e.configData&&N.setConfigData(e.configData.cfg,e.configData.cfgKey);var n={type:"run",code:"",boardDefinition:e.boardDef,partDefinitions:e.partDefinitions};N.runtime=new N.Runtime(n),N.runtime.board=null,N.initCurrentRuntime(n);var i=document.createElement("style");i.textContent+=w,document.head.appendChild(i);var r,o,s,a=e.partDefinitions,u=new N.visuals.Breadboard({}),l=function(t){var e=N.allocateDefinitions(t),r=[],o=[],s=1;e.partsAndWires.forEach(function(t){var n=t.part,i=t.wires;t.assembly.forEach(function(t,e){t.part&&n&&(o[s+e]=[n]),t.wireIndices&&0<t.wireIndices.length&&i&&(r[s+e]=t.wireIndices.map(function(t){return i[t]}))}),s+=t.assembly.length});var n=s-1,i=e.partsAndWires.map(function(t){return t.part}).filter(function(t){return!!t}),a=e.partsAndWires.map(function(t){return t.wires||[]}).reduce(function(t,e){return t.concat(e)},[]),u={},l=[];return a.forEach(function(t){u[t.color]||(u[t.color]=[],l.push(t.color)),u[t.color].push(t)}),{boardDef:t.boardDef,cmpDefs:t.partDefs,fnArgs:t.fnArgs,allAlloc:e,stepToWires:r,stepToCmps:o,allWires:a,allCmps:i,lastStep:n,colorToWires:u,allWireColors:l}}({boardDef:e.boardDef,partDefs:a,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:u.getCoord.bind(u)}),c=(r=l,o=document.getElementById("front-panel"),(s=k(r,f,!1)).addAll(r.allAlloc),o.appendChild(s.getView()),E(l));t.appendChild(c);for(var p=0;p<=l.lastStep;p++){var d=D(p,l);t.appendChild(d)}var h=function(t){var e=I();x(e,"back-panel");var n=k(t,y,!1);return n.addAll(t.allAlloc),e.appendChild(n.getView()),e}(l);t.appendChild(h)}t.renderParts=S,t.renderInstructions=function(t){document.getElementById("proj-title").innerText=t.options.name||"",S(document.body,t.options)}}(N.instructions||(N.instructions={}))}(pxsim||(pxsim={})),function(s){function a(t,e){if(void 0===e&&(e="sim: check failed"),!t)throw new Error(e)}s.quiet=!1,s.check=a,s.floatingPoint=!1,s.refCounting=!0,s.title="";var n={},i={};s.noRefCounting=function(){s.refCounting=!1,s.runtime&&(s.runtime.refCounting=!1)},s.getConfig=function(t){return i.hasOwnProperty(t+"")?i[t+""]:null},s.getConfigKey=function(t){return n.hasOwnProperty(t)?n[t]:null},s.getAllConfigKeys=function(){return Object.keys(n)},s.setConfig=function(t,e){i[t]=e},s.setConfigData=function(t,e){i=t,n=e},s.getConfigData=function(){return{cfg:i,cfgKey:n}},s.enableFloatingPoint=function(){s.floatingPoint=!0},s.setTitle=function(t){s.title=t};var r=function(){function t(){this.refcnt=1,s.runtime?this.id=s.runtime.registerLiveObject(this):this.id=0}return t.prototype.destroy=function(){},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefObject id:"+this.id+" refs:"+this.refcnt)},t.prototype.toDebugString=function(){return"(object)"},t.toAny=function(t){return t&&t.toAny?t.toAny():t},t.toDebugString=function(t){return null===t?"null":void 0===t?"undefined;":t.toDebugString?t.toDebugString():"string"==typeof t?JSON.stringify(t):t.toString()},t}();s.RefObject=r;var o=function(t,e,n,i,r,o){this.func=t,this.caps=e,this.a0=n,this.a1=i,this.a2=r,this.cb=o};s.FnWrapper=o;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.destroy=function(){for(var t=this.vtable.refmask,e=0;e<t.length;++e)t[e]&&v(this.fields[e]);this.fields=null,this.vtable=null},t.prototype.isRef=function(t){return a(0<=t&&t<this.fields.length),!!this.vtable.refmask[t]},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+") len:"+this.fields.length)},t}(r);s.RefRecord=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fields=[],t}return __extends(t,e),t.prototype.isRef=function(t){return a(0<=t&&t<this.fields.length),t<this.reflen},t.prototype.ldclo=function(t){return a(0<=(t>>=2)&&t<this.fields.length),this.fields[t]},t.prototype.destroy=function(){for(var t=0;t<this.reflen;++t)v(this.fields[t]);this.fields=null,this.func=null},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" refs:"+this.refcnt+" len:"+this.fields.length)},t}(r);s.RefAction=l,function(t){function i(t,e,n,i){var r=s.getResume();t instanceof l?(h.incr(t),r(new o(t.func,t.fields,e,n,i,function(){h.decr(t)}))):r(new o(t,null,e,n,i,null))}t.mkAction=function(t,e,n){var i=new l;i.reflen=t,i.func=n;for(var r=0;r<e;++r)i.fields.push(null);return i},t.runAction3=i,t.runAction2=function(t,e,n){i(t,e,n,null)},t.runAction1=function(t,e){i(t,e,null,null)},t.runAction0=function(t){i(t,null,null,null)}}(s.pxtcore||(s.pxtcore={}));var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.v=0,t}return __extends(t,e),t.prototype.print=function(){},t}(r);s.RefLocal=t;var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.v=null,t}return __extends(t,e),t.prototype.destroy=function(){v(this.v)},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" refs:"+this.refcnt+" v:"+this.v)},t}(r);s.RefRefLocal=e;var c,p,d,h,f,m,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vtable=42,t.data=[],t}return __extends(t,e),t.prototype.findIdx=function(t){for(var e=0;e<this.data.length;++e)if(this.data[e].key>>1==t)return e;return-1},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.data.length;++t)1&this.data[t].key&&v(this.data[t].val),this.data[t].val=0;this.data=[]},t.prototype.print=function(){s.runtime&&s.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" refs:"+this.refcnt+" size:"+this.data.length)},t.prototype.toAny=function(){var e={};return this.data.forEach(function(t){e[t.keyName]=r.toAny(t.val)}),e},t}(r);function v(t){if(s.runtime&&s.runtime.refCounting&&t instanceof r){var e=t;a(0<e.refcnt),0==--e.refcnt&&(s.runtime.unregisterLiveObject(e),e.destroy())}}function b(t){return t}function y(t){if(!s.runtime||!s.runtime.refCounting)return t;if(t instanceof r){var e=t;a(0<e.refcnt),e.refcnt++}return t}function w(){s.runtime&&s.runtime.dumpLivePointers()}s.RefMap=g,s.decr=v,s.initString=b,s.incr=y,s.dumpLivePointers=w,(c=s.numops||(s.numops={})).toString=function(t){return null===t?"null":void 0===t?"undefined":b(t.toString())},c.toBoolDecr=function(t){return v(t),!!t},c.toBool=function(t){return!!t},(p=s.langsupp||(s.langsupp={})).toInt=function(t){return 0|t},p.toFloat=function(t){return t},p.ignore=function(t){return t},p.ptreqDecr=function(t,e){return s.Number_.eqDecr(t,e)},(d=s.pxtcore||(s.pxtcore={})).incr=s.incr,d.decr=s.decr,d.ptrOfLiteral=function(t){return t},d.debugMemLeaks=function(){w()},d.allocate=function(){s.U.userError("allocate() called in simulator")},d.templateHash=function(){return 0},d.programHash=function(){return 0},d.programSize=function(){return 0},d.afterProgramPage=function(){return 0},d.getConfig=function(t,e){var n=s.getConfig(t);return null==n?e:n},d.toInt=function(t){return t>>0},d.toUInt=function(t){return t>>>0},d.toDouble=function(t){return t},d.toFloat=function(t){return t},d.fromInt=function(t){return t},d.fromUInt=function(t){return t},d.fromDouble=function(t){return t},d.fromFloat=function(t){return t},d.fromBool=function(t){return!!t},function(o){function r(t){null==t&&s.U.userError("Dereferencing null/undefined value.")}o.incr=s.incr,o.decr=s.decr,o.toInt8=function(t){return(255&t)<<24>>24},o.toInt16=function(t){return(65535&t)<<16>>16},o.toInt32=function(t){return 0|t},o.toUInt32=function(t){return t>>>0},o.toUInt8=function(t){return 255&t},o.toUInt16=function(t){return 65535&t},o.nullFix=function(t){return null==t||!1===t?0:!0===t?1:t},o.nullCheck=r,o.panic=function(t){s.U.userError("PANIC! Code "+t)},o.stringToBool=function(t){return o.decr(t),t?1:0},o.ptrToBool=function(t){return o.decr(t),t?1:0},o.emptyToNull=function(t){return""==t?0:t},o.ldfld=function(t,e){r(t),a(!t.isRef(e));var n,i=(n=t.fields[e],s.floatingPoint||void 0!==n?n:0);return o.decr(t),i},o.stfld=function(t,e,n){r(t),a(!t.isRef(e)),t.fields[e]=n,o.decr(t)},o.ldfldRef=function(t,e){r(t),a(t.isRef(e));var n,i=o.incr(void 0===(n=t.fields[e])?null:n);return o.decr(t),i},o.stfldRef=function(t,e,n){r(t),a(t.isRef(e)),o.decr(t.fields[e]),t.fields[e]=n,o.decr(t)},o.ldloc=function(t){return t.v},o.ldlocRef=function(t){return o.incr(t.v)},o.stloc=function(t,e){t.v=e},o.stlocRef=function(t,e){o.decr(t.v),t.v=e},o.mkloc=function(){return new t},o.mklocRef=function(){return new e},o.stclo=function(t,e,n){return a(0<=e&&e<t.fields.length),a(null===t.fields[e]),t.fields[e]=n,t},o.runtimeWarning=function(t){s.Runtime.postMessage(s.getWarningMessage(t))},o.mkMap=function(){return new g},o.mapGet=function(t,e){var n=t.findIdx(e);if(n<0)return o.decr(t),0;var i=t.data[n].val;return o.decr(t),i},o.mapGetRef=function(t,e){var n=t.findIdx(e);if(n<0)return o.decr(t),0;var i=o.incr(t.data[n].val);return o.decr(t),i},o.mapSet=function(t,e,n,i){var r=t.findIdx(e);r<0?t.data.push({key:e<<1,val:n,keyName:i}):(1&t.data[r].key&&(o.decr(t.data[r].val),t.data[r].key=e<<1),t.data[r].val=n,t.data[r].keyName=i),o.decr(t)},o.mapSetRef=function(t,e,n,i){var r=t.findIdx(e);r<0?t.data.push({key:e<<1|1,val:n,keyName:i}):(1&t.data[r].key?o.decr(t.data[r].val):t.data[r].key=e<<1|1,t.data[r].val=n,t.data[r].keyName=i),o.decr(t)}}(h=s.pxtrt||(s.pxtrt={})),(f=s.pxtcore||(s.pxtcore={})).mkClassInstance=function(t){a(!!t.methods),a(!!t.refmask);for(var e=new u,n=(e.vtable=t).refmask.length,i=0;i<n;++i)e.fields.push(s.floatingPoint?void 0:0);return e},f.switch_eq=function(t,e){return t==e&&(f.decr(e),!0)},(m=s.thread||(s.thread={})).panic=h.panic,m.pause=function(t){var e=s.getResume();setTimeout(function(){e()},t)},m.runInBackground=function(t){s.runtime.runFiberAsync(t).done()},m.forever=function(e){h.nullCheck(e),y(e),function t(){s.runtime.runFiberAsync(e).then(function(){return Promise.delay(20)}).then(t).done()}()}}(pxsim||(pxsim={})),function(u){var t,e,n,i,o=function(e){function t(){var t=e.call(this)||this;return t.data=[],t}return __extends(t,e),t.prototype.toArray=function(){return this.data.slice(0)},t.prototype.toAny=function(){return this.data.map(function(t){return u.RefObject.toAny(t)})},t.prototype.toDebugString=function(){for(var t="[",e=0;e<this.data.length;++e)if(0<e&&(t+=","),15<(t+=u.RefObject.toDebugString(this.data[e])).length){t+="...";break}return t+="]"},t.prototype.destroy=function(){for(var t=this.data,e=0;e<t.length;++e)u.decr(t[e]),t[e]=0;this.data=[]},t.prototype.isValidIndex=function(t){return 0<=t&&t<this.data.length},t.prototype.push=function(t){this.data.push(t)},t.prototype.pop=function(){var t=this.data.pop();return null==t?0:t},t.prototype.getLength=function(){return this.data.length},t.prototype.setLength=function(t){this.data.length=t},t.prototype.getAt=function(t){return null!=this.data[t]?this.data[t]:0},t.prototype.setAt=function(t,e){this.data[t]=e},t.prototype.insertAt=function(t,e){this.data.splice(t,0,e)},t.prototype.removeAt=function(t){var e=this.data.splice(t,1);return null==e[0]?0:e[0]},t.prototype.indexOf=function(t,e){if(0!=t)return this.data.indexOf(t,e);for(var n=this.data.indexOf(t,e),i=-1,r=e;r<this.data.length;r++)if(null==this.data[r]){i=r;break}return n<i||-1==i?n:i},t.prototype.print=function(){},t}(u.RefObject);function r(t,e){var n=65535&t,i=65535&e;return n*i+((t>>>16&65535)*i+n*(e>>>16&65535)<<16>>>0)|0}u.RefCollection=o,function(t){function i(t,e){if(u.pxtrt.nullCheck(t),t.isValidIndex(e))return t.removeAt(e)}function r(t,e,n){return u.pxtrt.nullCheck(t),t.indexOf(e,n)}t.mk=function(){return new o},t.length=function(t){return u.pxtrt.nullCheck(t),t.getLength()},t.setLength=function(t,e){u.pxtrt.nullCheck(t),t.setLength(e)},t.push=function(t,e){u.pxtrt.nullCheck(t),u.incr(e),t.push(e)},t.pop=function(t,e){return u.pxtrt.nullCheck(t),t.pop()},t.getAt=function(t,e){u.pxtrt.nullCheck(t);var n=t.getAt(e);return u.incr(n),n},t.removeAt=i,t.insertAt=function(t,e,n){u.pxtrt.nullCheck(t),u.incr(n),t.insertAt(e,n)},t.setAt=function(t,e,n){u.pxtrt.nullCheck(t),t.isValidIndex(e)&&u.decr(t.getAt(e)),u.incr(n),t.setAt(e,n)},t.indexOf=r,t.removeElement=function(t,e){u.pxtrt.nullCheck(t);var n=r(t,e,0);return 0<=n?(i(t,n),1):0}}(u.Array_||(u.Array_={})),(t=u.Math_||(u.Math_={})).imul=function(t,e){return r(t,e)},t.idiv=function(t,e){return t/e>>0},t.round=function(t){return Math.round(t)},t.ceil=function(t){return Math.ceil(t)},t.floor=function(t){return Math.floor(t)},t.sqrt=function(t){return Math.sqrt(t)},t.pow=function(t,e){return u.floatingPoint?Math.pow(t,e):0|Math.pow(t,e)},t.log=function(t){return Math.log(t)},t.exp=function(t){return Math.exp(t)},t.sin=function(t){return Math.sin(t)},t.cos=function(t){return Math.cos(t)},t.tan=function(t){return Math.tan(t)},t.asin=function(t){return Math.asin(t)},t.acos=function(t){return Math.acos(t)},t.atan=function(t){return Math.atan(t)},t.atan2=function(t,e){return Math.atan2(t,e)},t.trunc=function(t){return 0<t?Math.floor(t):Math.ceil(t)},t.random=function(){return Math.random()},t.randomRange=function(t,e){if(t==e)return t;if(e<t){var n=t;t=e,e=n}return Math.floor(t)==t&&Math.floor(e)==e?t+Math.floor(Math.random()*(e-t+1)):t+Math.random()*(e-t)},function(t){function n(t,e){return u.pxtrt.nullFix(t)==u.pxtrt.nullFix(e)}t.lt=function(t,e){return t<e},t.le=function(t,e){return t<=e},t.neq=function(t,e){return!n(t,e)},t.eq=n,t.eqDecr=function(t,e){return u.pxtrt.nullFix(t)==u.pxtrt.nullFix(e)&&(u.decr(e),!0)},t.gt=function(t,e){return e<t},t.ge=function(t,e){return e<=t},t.div=function(t,e){return 0|Math.floor(t/e)},t.mod=function(t,e){return t%e},t.bnot=function(t){return~t},t.toString=function(t){return u.initString(t+"")}}(u.Number_||(u.Number_={})),(e=u.thumb||(u.thumb={})).adds=function(t,e){return t+e|0},e.subs=function(t,e){return t-e|0},e.divs=function(t,e){return 0|Math.floor(t/e)},e.muls=function(t,e){return r(t,e)},e.ands=function(t,e){return t&e},e.orrs=function(t,e){return t|e},e.eors=function(t,e){return t^e},e.lsls=function(t,e){return t<<e},e.lsrs=function(t,e){return t>>>e},e.asrs=function(t,e){return t>>e},e.bnot=function(t){return~t},e.ignore=function(t){return t},function(t){function n(t){return t<<16>>16}t.adds=function(t,e){return n(t+e)},t.subs=function(t,e){return n(t-e)},t.divs=function(t,e){return n(Math.floor(t/e))},t.muls=function(t,e){return n(r(t,e))},t.ands=function(t,e){return n(t&e)},t.orrs=function(t,e){return n(t|e)},t.eors=function(t,e){return n(t^e)},t.lsls=function(t,e){return n(t<<e)},t.lsrs=function(t,e){return(65535&t)>>>e},t.asrs=function(t,e){return n(t>>e)},t.bnot=function(t){return~t},t.ignore=function(t){return t}}(u.avr||(u.avr={})),(n=u.String_||(u.String_={})).mkEmpty=function(){return""},n.fromCharCode=function(t){return u.initString(String.fromCharCode(t))},n.toNumber=function(t){return parseInt(t)},n.concat=function(t,e){return u.initString(t+e)},n.substring=function(t,e,n){return u.pxtrt.nullCheck(t),u.initString(t.slice(e,e+n))},n.equals=function(t,e){return t==e},n.compare=function(t,e){return t==e?0:t<e?-1:1},n.compareDecr=function(t,e){return t==e?(u.decr(e),0):t<e?-1:1},n.length=function(t){return t.length},n.isEmpty=function(t){return null==t||0==t.length},n.substr=function(t,e,n){return u.initString(t.substr(e,n))},n.charAt=function(t,e){return u.initString(t.charAt(e))},n.charCodeAt=function(t,e){return u.pxtrt.nullCheck(t),n=t,i=e,u.pxtrt.nullCheck(n),0<=i&&i<n.length?t.charCodeAt(e):0;var n,i},(i=u.Boolean_||(u.Boolean_={})).toString=function(t){return t?"true":"false"},i.bang=function(t){return!t};var p=function(n){function t(t){var e=n.call(this)||this;return e.data=t,e}return __extends(t,n),t.prototype.print=function(){},t}(u.RefObject);u.RefBuffer=p,function(t){var r,e;function l(t){var e=function(t){switch(t){case r.Int8LE:return-1;case r.UInt8LE:return 1;case r.Int16LE:return-2;case r.UInt16LE:return 2;case r.Int32LE:return-4;case r.UInt32LE:return 4;case r.Int8BE:return-10;case r.UInt8BE:return 10;case r.Int16BE:return-20;case r.UInt16BE:return 20;case r.Int32BE:return-40;case r.UInt32BE:return 40;case r.Float32LE:return 4;case r.Float32BE:return 40;case r.Float64LE:return 8;case r.Float64BE:return 80;default:throw u.U.userError("bad format")}}(t),n=!1;e<0&&(n=!0,e=-e);var i=!1;return 10<=e&&(i=!0,e/=10),{size:e,signed:n,swap:i,isFloat:t>=r.Float32LE}}function i(t){return new p(new Uint8Array(t))}function o(t,e){return 0<=e&&e<t.data.length}function s(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=-1),n<0||n>t.data.length||(i<0&&(i=t.data.length),i=Math.min(i,t.data.length-n),t.data.fill(e,n,n+i))}function a(t,e,n,i,r){if(n.buffer===t.buffer)a(t,e,n.slice(i,i+r),0,r);else for(var o=0;o<r;++o)t[e+o]=n[i+o]}(e=r=t.NumberFormat||(t.NumberFormat={}))[e.Int8LE=1]="Int8LE",e[e.UInt8LE=2]="UInt8LE",e[e.Int16LE=3]="Int16LE",e[e.UInt16LE=4]="UInt16LE",e[e.Int32LE=5]="Int32LE",e[e.Int8BE=6]="Int8BE",e[e.UInt8BE=7]="UInt8BE",e[e.Int16BE=8]="Int16BE",e[e.UInt16BE=9]="UInt16BE",e[e.Int32BE=10]="Int32BE",e[e.UInt32LE=11]="UInt32LE",e[e.UInt32BE=12]="UInt32BE",e[e.Float32LE=13]="Float32LE",e[e.Float64LE=14]="Float64LE",e[e.Float32BE=15]="Float32BE",e[e.Float64BE=16]="Float64BE",t.getNumber=function(t,e,n){var i=l(e);if(i.isFloat){var r=t.data.buffer.slice(n,n+i.size);return i.swap&&new Uint8Array(r).reverse(),4==i.size?new Float32Array(r)[0]:new Float64Array(r)[0]}for(var o=0,s=0;s<i.size;++s){o<<=8;var a=i.swap?n+s:n+i.size-s-1;o|=t.data[a]}if(i.signed){var u=32-8*i.size;o=o<<u>>u}else o>>>=0;return o},t.setNumber=function(t,e,n,i){var r=l(e);if(r.isFloat){var o=new Uint8Array(r.size);4==r.size?new Float32Array(o.buffer)[0]=i:new Float64Array(o.buffer)[0]=i,r.swap&&o.reverse();for(var s=0;s<r.size;++s)t.data[n+s]=o[s]}else for(s=0;s<r.size;++s){var a=r.swap?n+r.size-s-1:n+s;t.data[a]=255&i,i>>=8}},t.createBuffer=i,t.createBufferFromHex=function(t){for(var e=i(t.length>>1),n=0;n<t.length;n+=2)e.data[n>>1]=parseInt(t.slice(n,n+2),16);return e},t.getBytes=function(t){return t.data},t.getByte=function(t,e){return o(t,e)?t.data[e]:0},t.setByte=function(t,e,n){o(t,e)&&(t.data[e]=n)},t.length=function(t){return t.data.length},t.fill=s,t.slice=function(t,e,n){return e=Math.min(t.data.length,e),n<0&&(n=t.data.length),n=Math.min(n,t.data.length-e),new p(t.data.slice(e,e+n))},t.toHex=function(t){for(var e="0123456789abcdef",n="",i=0;i<t.data.length;++i)n+=e[t.data[i]>>4],n+=e[15&t.data[i]];return n};var c=-2147483648;t.shift=function(t,e,n,i){i<0&&(i=t.data.length-n),n<0||n+i>t.data.length||n+i<n||0==i||0==e||e==c||0!=i&&0!=e&&e!=c&&(e<=-i||i<=e?s(t,0):e<0?(e=-e,a(t.data,n+e,t.data,n,i-e),t.data.fill(0,n,n+e)):(i-=e,a(t.data,n,t.data,n+e,i),t.data.fill(0,n+i,n+i+e)))},t.rotate=function(t,e,n,i){if(i<0&&(i=t.data.length-n),!(n<0||n+i>t.data.length||n+i<n||0==i||0==e||e==c)){e<0&&(e+=i<<8),(e%=i)<0&&(e+=i);for(var r=t.data,o=e,s=0,a=o,u=i;s!=a;){var l=r[s+n];r[s+++n]=r[a+n],r[a+++n]=l,a==u?a=o:s==o&&(o=a)}}},t.write=function(t,e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=-1),r<0&&(r=n.data.length),i<0||e<0||e>t.data.length||(r=Math.min(n.data.length-i,t.data.length-e))<0||a(t.data,e,n.data,i,r)}}(u.BufferMethods||(u.BufferMethods={}))}(pxsim||(pxsim={})),function(t){var e,n;e=t.localization||(t.localization={}),n={},e.setLocalizedStrings=function(t){n=t||{}},e.lf=function(t){return n[t]||t}}(pxsim||(pxsim={})),function(pxsim){var U,hC;function getResume(){return pxsim.runtime.getResume()}hC=U=pxsim.U||(pxsim.U={}),hC.addClass=function(i,t){i&&t&&0!=t.length&&t.split(" ").forEach(function(t){var e,n;n=t,(e=i).classList?e.classList.add(n):e.className.indexOf(n)<0&&(e.className+=" "+n)})},hC.removeClass=function(i,t){i&&t&&0!=t.length&&t.split(" ").forEach(function(t){var e,n;n=t,(e=i).classList?e.classList.remove(n):e.className=e.className.replace(n,"").replace(/\s{2,}/," ")})},hC.remove=function(t){t.parentElement.removeChild(t)},hC.removeChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},hC.assert=function(t,e){if(void 0===e&&(e="Assertion failed"),!t)throw new Error(e)},hC.repeatMap=function(t,e){t=t||0;for(var n=[],i=0;i<t;++i)n.push(e(i));return n},hC.userError=function(t){var e=new Error(t);throw e.isUserError=!0,e},hC.now=function(){return Date.now()},hC.nextTick=function(t){Promise._async._schedule(t)},pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function t(){this.serialOutBuffer=""}return t.prototype.updateView=function(){},t.prototype.receiveMessage=function(t){},t.prototype.initAsync=function(t){return this.runOptions=t,Promise.resolve()},t.prototype.kill=function(){},t.prototype.writeSerial=function(t){t&&(this.serialOutBuffer+=t,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(Runtime.postMessage({type:"serial",data:this.serialOutBuffer,id:pxsim.runtime.id,sim:!0}),this.serialOutBuffer=""))},t}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(e){function t(){var t=e.call(this)||this;return t.id="b"+Math.round(2147483647*Math.random()),t.bus=new pxsim.EventBus(pxsim.runtime),t.updateSubscribers=[],t.updateView=function(){t.updateSubscribers.forEach(function(t){return t()})},t.builtinParts={},t.builtinVisuals={},t.builtinPartVisuals={},t}return __extends(t,e),t.prototype.kill=function(){e.prototype.kill.call(this),pxsim.AudioContextManager.stop()},t}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(BaseBoard);function initBareRuntime(){pxsim.runtime.board=new BareBoard;var t=pxsim;t.basic={pause:pxsim.thread.pause,showNumber:function(t){var e=getResume();console.log("SHOW NUMBER:",t),U.nextTick(e)}},t.serial={writeString:function(t){return pxsim.runtime.board.writeSerial(t)}},t.pins={createBuffer:pxsim.BufferMethods.createBuffer},t.control={inBackground:pxsim.thread.runInBackground}}pxsim.initBareRuntime=initBareRuntime;var EventQueue=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.max=5,this.events=[],this.awaiters=[]}return t.prototype.push=function(t,e){if(0<this.awaiters.length)if(e){var n=this.awaiters.shift();n&&n()}else{var i=this.awaiters.slice();this.awaiters=[],i.forEach(function(t){return t()})}!this.handler||this.events.length>this.max||(this.events.push(t),1!=this.events.length||this.lock||this.poke())},t.prototype.poke=function(){var t=this;this.lock=!0;var e,n=this.events.shift();(e=this.runtime).runFiberAsync.apply(e,[this.handler].concat(this.valueToArgs?this.valueToArgs(n):[n])).done(function(){0<t.events.length?t.poke():t.lock=!1})},Object.defineProperty(t.prototype,"handler",{get:function(){return this._handler},set:function(t){this._handler&&pxsim.pxtcore.decr(this._handler),this._handler=t,this._handler&&pxsim.pxtcore.incr(this._handler)},enumerable:!0,configurable:!0}),t.prototype.addAwaiter=function(t){this.awaiters.push(t)},t}();function _leave(t,e){return t.parent.retval=e,t.finalCallback&&t.finalCallback(e),t.parent}function syntheticRefAction(e){return pxsim.pxtcore.mkAction(0,0,function(t){return _leave(t,e(t))})}pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0,pxsim.syntheticRefAction=syntheticRefAction;var Runtime=function(){function Runtime(msg){var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.startTime=0,this.globals={},this.loopLock=null,this.loopLockWaitList=[],this.refCountingDebug=!1,this.refCounting=!0,this.refObjId=1,this.liveRefObjs={},this.stringRefCounts={},this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var yieldMaxSteps=100,entryPoint,pxtrt=pxsim.pxtrt,breakpoints=null,breakAlways=!1,globals=this.globals,yieldSteps=yieldMaxSteps,currResume,dbgHeap,dbgResume,breakFrame=null,lastYield=Date.now(),__this=this,tracePauseMs=0;function oops(t){throw new Error("sim error: "+t)}function doNothing(t){return t.pc=-1,leave(t,t.parent.retval)}function flushLoopLock(){for(;0<__this.loopLockWaitList.length&&!__this.loopLock;){__this.loopLockWaitList.shift()()}}function maybeYield(t,e,n){yieldSteps=yieldMaxSteps;var i=Date.now();if(20<=i-lastYield){lastYield=i,t.pc=e,t.r0=n;var r=new Object;__this.loopLock=r;return setTimeout(function(){__this.dead||(U.assert(t.pc==e),U.assert(__this.loopLock===r),__this.loopLock=null,loop(t),flushLoopLock())},5),!0}return!1}function setupDebugger(t){breakpoints=new Uint8Array(t),breakAlways=!0}function isBreakFrame(t){if(!breakFrame)return!0;for(var e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(e,n,t,i){U.assert(!dbgResume),U.assert(!dbgHeap),e.pc=n,e.r0=i;var r=pxsim.getBreakpointMsg(e,t),o=r.msg,s=r.heap;return dbgHeap=s,Runtime.postMessage(o),dbgResume=function(t){if(dbgHeap=dbgResume=null,!__this.dead){switch(pxsim.runtime=__this,U.assert(e.pc==n),breakAlways=!1,breakFrame=null,t.subtype){case"resume":break;case"stepover":breakAlways=!0,breakFrame=e;break;case"stepinto":breakAlways=!0;break;case"stepout":breakAlways=!0,breakFrame=e.parent||e}return loop(e)}},null}function trace(t,e,n,i){setupResume(e,n),"<main>"===i.functionName||"main.ts"===i.fileName?(Runtime.postMessage({type:"debugger",subtype:"trace",breakpointId:t}),pxsim.thread.pause(tracePauseMs)):pxsim.thread.pause(0),checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var e=t;if(e.setBreakpoints){breakpoints.fill(0);for(var n=0,i=e.setBreakpoints;n<i.length;n++){var r=i[n];breakpoints[r]=1}}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakAlways=!0,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t);break;case"variables":var o=void 0;if(dbgHeap){var s=dbgHeap[t.variablesReference];void 0!==s&&(o=pxsim.dumpHeap(s,dbgHeap))}Runtime.postMessage({type:"debugger",subtype:"variables",req_seq:t.seq,variables:o})}}function loop(e){if(__this.dead)console.log("Runtime terminated");else{U.assert(!__this.loopLock);try{for(pxsim.runtime=__this;e;)__this.currFrame=e,__this.currFrame.overwrittenPC=!1,e=e.fn(e),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(e=__this.currFrame)}catch(t){if(__this.errorHandler)__this.errorHandler(t);else{console.error("Simulator crashed, no error handler",t.stack);var n=pxsim.getBreakpointMsg(e,e.lastBrkId).msg;n.exceptionMessage=t.message,n.exceptionStack=t.stack,Runtime.postMessage(n),__this.postError&&__this.postError(t)}}}}function actionCall(t,e){return e&&(t.finalCallback=e),t.depth=t.parent.depth+1,1e3<t.depth&&U.userError("Stack overflow"),t.pc=0,t}var leave=_leave;function setupTop(t){var e=setupTopCore(t);return setupResume(e,0),e}function setupTopCore(t){var e={parent:null,pc:0,depth:0,fn:function(){return t&&t(e.retval),null}};return e}function topCall(t,e){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0),loop(actionCall({parent:setupTopCore(e),fn:t,depth:0,pc:0}))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(t,e){currResume=buildResume(t,e)}function buildResume(o,s){currResume&&oops("already has resume"),o.pc=s;var a=Date.now(),u=function(t){if(!__this.dead){if(!__this.loopLock){pxsim.runtime=__this;var e=Date.now();if(3<e-a&&(lastYield=e),U.assert(o.pc==s),t instanceof pxsim.FnWrapper){var n=t,i={parent:o,fn:n.func,lambdaArgs:[n.a0,n.a1,n.a2],pc:0,caps:n.caps,depth:o.depth+1,finalCallback:n.cb},r={};return __this.loopLock=r,U.nextTick(function(){U.assert(__this.loopLock===r),__this.loopLock=null,loop(actionCall(i)),flushLoopLock()})}return o.retval=t,loop(o)}__this.loopLockWaitList.push(function(){return u(t)})}};return u}eval(msg.code),this.refCounting=pxsim.refCounting,this.run=function(t){return topCall(entryPoint,t)},this.getResume=function(){currResume||oops("noresume");var t=currResume;return currResume=null,t},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(t){currResume=null,0<=t&&(_this.currFrame.pc=t),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(t){var e=this.refObjId++;return this.refCounting&&(this.liveRefObjs[e+""]=t),e},Runtime.prototype.unregisterLiveObject=function(t){U.assert(0==t.refcnt,"ref count is not 0"),delete this.liveRefObjs[t.id+""]},Runtime.prototype.runningTime=function(){return U.now()-this.startTime},Runtime.prototype.runFiberAsync=function(n,i,r,o){var s=this;return pxsim.incr(n),new Promise(function(t,e){return U.nextTick(function(){(pxsim.runtime=s).setupTop(t),pxsim.pxtcore.runAction3(n,i,r,o),pxsim.decr(n)})})},Runtime.postMessage=function(t){t&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(t,"*"),Runtime.messagePosted&&Runtime.messagePosted(t))},Runtime.prototype.kill=function(){this.dead=!0,this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView()},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(t){this.running!=t&&(this.running=t,this.running?(this.startTime=U.now(),Runtime.postMessage({type:"status",runtimeid:this.id,state:"running"})):Runtime.postMessage({type:"status",runtimeid:this.id,state:"killed"}),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){var n=this;if(this.refCounting&&this.refCountingDebug){var t=Object.keys(this.liveRefObjs),e=Object.keys(this.stringRefCounts);console.log("Live objects: "+t.length+" objects, "+e.length+" strings"),t.forEach(function(t){return n.liveRefObjs[t].print()}),e.forEach(function(t){var e=n.stringRefCounts[t];console.log("Live String:",JSON.stringify(t),"refcnt=",e)})}},Runtime}();pxsim.Runtime=Runtime}(pxsim||(pxsim={})),function(r){var o,t,n,e;(t=o=r.SimulatorState||(r.SimulatorState={}))[t.Unloaded=0]="Unloaded",t[t.Stopped=1]="Stopped",t[t.Running=2]="Running",t[t.Paused=3]="Paused",(e=n=r.SimulatorDebuggerCommand||(r.SimulatorDebuggerCommand={}))[e.StepInto=0]="StepInto",e[e.StepOver=1]="StepOver",e[e.StepOut=2]="StepOut",e[e.Resume=3]="Resume",e[e.Pause=4]="Pause";var i=function(){function t(t,e){void 0===e&&(e={}),this.container=t,this.options=e,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.runOptions={},this.state=o.Unloaded,this.frameCleanupTimeout=0,this.debuggerSeq=1,this.debuggerResolvers={}}return t.prototype.setHwDebugger=function(t){t?(this.hwdbg=t,this.setState(o.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(o.Running),this.stop())},t.prototype.handleHwDebuggerMsg=function(t){this.hwdbg&&this.handleMessage(t)},t.prototype.setThemes=function(t){r.U.assert(t&&0<t.length),this.themes=t},t.prototype.setState=function(t){this.state!=t&&(this.state=t,this.freeze(this.state==o.Paused),this.options.onStateChanged&&this.options.onStateChanged(this.state))},t.prototype.freeze=function(t){var n="pause-overlay";t?r.util.toArray(this.container.querySelectorAll("div.simframe")).forEach(function(t){if(!t.querySelector("div."+n)){var e=document.createElement("div");e.className=n,e.onclick=function(t){return t.preventDefault(),!1},t.appendChild(e)}}):r.util.toArray(this.container.querySelectorAll("div.simframe div."+n)).forEach(function(t){return t.parentElement.removeChild(t)})},t.prototype.postMessage=function(t,e){if(this.hwdbg)this.hwdbg.postMessage(t);else{var n=this.container.getElementsByTagName("iframe");!e||"eventbus"!==t.type&&"radiopacket"!=t.type&&"irpacket"!=t.type||(n.length<2?(this.container.appendChild(this.createFrame()),n=this.container.getElementsByTagName("iframe")):n[1].dataset.runid!=this.runId&&this.startFrame(n[1]));for(var i=0;i<n.length;++i){var r=n[i];e&&r.contentWindow==e||r.contentWindow.postMessage(t,"*")}}},t.prototype.createFrame=function(t){var e=document.createElement("div");e.className="simframe";var n=document.createElement("iframe");n.id="sim-frame-"+this.nextId(),n.allowFullscreen=!0,n.setAttribute("sandbox","allow-same-origin allow-scripts"),n.sandbox.value="allow-scripts allow-same-origin";var i=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";return n.className="no-select",this.runOptions.aspectRatio&&(e.style.paddingBottom=100/this.runOptions.aspectRatio+"%"),n.src=i+"#"+n.id,n.frameBorder="0",n.dataset.runid=this.runId,e.appendChild(n),e},t.prototype.stop=function(t){if(void 0===t&&(t=!1),this.clearDebugger(),this.postMessage({type:"stop"}),this.setState(o.Stopped),t)this.unload();else{for(var e=this.container.getElementsByTagName("iframe"),n=0;n<e.length;++n){var i=e[n];r.U.addClass(i,this.getStoppedClass())}this.scheduleFrameCleanup()}},t.prototype.unload=function(){this.cancelFrameCleanup(),this.container.innerHTML="",this.setState(o.Unloaded)},t.prototype.mute=function(t){this.postMessage({type:"mute",mute:t})},t.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},t.prototype.scheduleFrameCleanup=function(){var t=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){t.frameCleanupTimeout=0,t.cleanupFrames()},5e3)},t.prototype.applyAspectRatio=function(){for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e)t[e].parentElement.style.paddingBottom=100/this.runOptions.aspectRatio+"%"},t.prototype.cleanupFrames=function(){for(var t=this.container.getElementsByTagName("iframe"),e=1;e<t.length;++e){var n=t[e];this.state!=o.Stopped&&n.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(n.parentElement):n.parentElement.remove())}},t.prototype.hide=function(t){if(this.options.removeElement){for(var e=this.container.getElementsByTagName("iframe"),n=0;n<e.length;++n){var i=e[n];this.options.removeElement(i.parentElement,t)}0==e.length&&t&&t()}},t.prototype.unhide=function(){if(this.options.unhideElement)for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e){var n=t[e];this.options.unhideElement(n.parentElement)}},t.prototype.run=function(t,e){void 0===e&&(e={}),this.clearDebugger(),this.runOptions=e,this.runId=this.nextId(),this.addEventListeners(),this.currentRuntime={type:"run",boardDefinition:e.boardDefinition,parts:e.parts,fnArgs:e.fnArgs,code:t,partDefinitions:e.partDefinitions,mute:e.mute,highContrast:e.highContrast,light:e.light,cdnUrl:e.cdnUrl,localizedStrings:e.localizedStrings,refCountingDebug:e.refCountingDebug,version:e.version},this.applyAspectRatio(),this.scheduleFrameCleanup();var n=this.container.getElementsByTagName("iframe").item(0);if(n)this.startFrame(n);else{var i=this.createFrame(e.light);this.container.appendChild(i),n=i.firstElementChild}this.setState(o.Running),this.setTraceInterval(this.traceInterval)},t.prototype.startFrame=function(t){var e=JSON.parse(JSON.stringify(this.currentRuntime)),n="",i=/player=([A-Za-z0-9]+)/i.exec(window.location.href);i&&(n=i[1]),e.frameCounter=++this.frameCounter,e.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:n},e.id=e.options.theme+"-"+this.nextId(),t.dataset.runid=this.runId,t.contentWindow.postMessage(e,"*"),r.U.removeClass(t,this.getStoppedClass())},t.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},t.prototype.handleMessage=function(t,e){switch(t.type||""){case"ready":var n=t.frameid,i=document.getElementById(n);i&&(this.startFrame(i),this.options.revealElement&&this.options.revealElement(i));break;case"simulator":this.handleSimulatorCommand(t);break;case"serial":break;case"pxteditor":case"custom":break;case"debugger":this.handleDebuggerMessage(t);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:"radiopacket"==t.type&&(t.rssi=10),this.postMessage(t,e)}},t.prototype.addEventListeners=function(){var e=this;this.listener||(this.listener=function(t){e.hwdbg||e.handleMessage(t.data,t.source)},window.addEventListener("message",this.listener,!1))},t.prototype.resume=function(t){var e;switch(t){case n.Resume:e="resume",this.setState(o.Running);break;case n.StepInto:e="stepinto",this.setState(o.Running);break;case n.StepOut:e="stepout",this.setState(o.Running);break;case n.StepOver:e="stepover",this.setState(o.Running);break;case n.Pause:e="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:e})},t.prototype.setBreakpoints=function(t){this.postDebuggerMessage("config",{setBreakpoints:t})},t.prototype.setTraceInterval=function(t){this.traceInterval=t,this.postDebuggerMessage("traceConfig",{interval:t})},t.prototype.variablesAsync=function(t){return this.postDebuggerMessageAsync("variables",{variablesReference:t}).then(function(t){return t},function(t){})},t.prototype.handleSimulatorCommand=function(t){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(t)},t.prototype.clearDebugger=function(){var e=this,n=new Error("Debugging cancelled");Object.keys(this.debuggerResolvers).forEach(function(t){(0,e.debuggerResolvers[t].reject)(n)}),this.debuggerResolvers={},this.debuggerSeq++},t.prototype.handleDebuggerMessage=function(t){("trace"!==t.subtype&&console.log("DBG-MSG",t.subtype,t),t.seq)&&((n=this.debuggerResolvers[t.seq].resolve)&&n(t));switch(t.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(t);break;case"breakpoint":var e=t;this.state==o.Running?(e.exceptionMessage?this.stop():this.setState(o.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(e)):console.error("debugger: trying to pause from "+this.state);break;case"trace":this.options.onTraceMessage&&this.options.onTraceMessage(t);break;default:var n,i=t.req_seq;if(i)(n=this.debuggerResolvers[i].resolve)&&(delete this.debuggerResolvers[i],n(t))}},t.prototype.postDebuggerMessageAsync=function(i,r){var o=this;return void 0===r&&(r={}),new Promise(function(t,e){var n=o.debuggerSeq++;o.debuggerResolvers[n.toString()]={resolve:t,reject:e},o.postDebuggerMessage(i,r,n)})},t.prototype.postDebuggerMessage=function(t,e,n){void 0===e&&(e={});var i=JSON.parse(JSON.stringify(e));i.type="debugger",i.subtype=t,n&&(i.seq=n),this.postMessage(i)},t.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},t.prototype.getStoppedClass=function(){return this.options&&this.options.stoppedClass?this.options.stoppedClass:"grayscale"},t}();r.SimulatorDriver=i}(pxsim||(pxsim={})),function(o){o.mkRange=function(t,e){for(var n=[];t<e;t++)n.push(t);return n};var t=function(){function t(t,e){this.runtime=t,this.valueToArgs=e,this.queues={},this.nextNotifyEvent=1024}return t.prototype.setNotify=function(t,e){this.notifyID=t,this.notifyOneID=e},t.prototype.start=function(t,e,n){var i=t+":"+e,r=this.queues[i];return r||(r=this.queues[i]=new o.EventQueue(this.runtime,this.valueToArgs)),r},t.prototype.listen=function(t,e,n){this.start(t,e,!0).handler=n},t.prototype.queue=function(t,e,n){void 0===n&&(n=null);var i=this.notifyID&&this.notifyOneID&&t==this.notifyOneID;i&&(t=this.notifyID);var r=this.start(t,e,!1);r&&r.push(n,i)},t.prototype.wait=function(t,e,n){this.start(t,e,!0).addAwaiter(n)},t}(),e=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return __extends(t,i),t.prototype.queue=function(t,e,n){void 0===n&&(n=0),i.prototype.queue.call(this,t,e,n)},t}(o.EventBusGeneric=t);o.EventBus=e;var n=function(){function t(n){var i=this;this.runtime=n,this.queue=[],this.process=function(){var t=i.queue[0];if(t&&!i.runtime.dead){n=i.runtime;var e=t.frame();n.queueDisplayUpdate(),n.maybeUpdateDisplay(),!1===e?(i.queue.shift(),i.queue[0]&&(i.queue[0].setTimeoutHandle=setTimeout(i.process,i.queue[0].interval)),t.whenDone(!1)):t.setTimeoutHandle=setTimeout(i.process,t.interval)}}}return t.prototype.cancelAll=function(){var t=this.queue;this.queue=[];for(var e=0,n=t;e<n.length;e++){var i=n[e];i.whenDone(!0),i.setTimeoutHandle&&clearTimeout(i.setTimeoutHandle)}},t.prototype.cancelCurrent=function(){var t=this.queue[0];t&&(this.queue.shift(),t.whenDone(!0),t.setTimeoutHandle&&clearTimeout(t.setTimeoutHandle))},t.prototype.enqueue=function(t){t.whenDone||(t.whenDone=function(){}),this.queue.push(t),1==this.queue.length&&this.process()},t.prototype.executeAsync=function(n){var i=this;return o.U.assert(!n.whenDone),new Promise(function(t,e){n.whenDone=t,i.enqueue(n)})},t}();function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}o.AnimationQueue=n,function(t){var e,i,r,o,s=0,a=!1;function u(){return e||(e=function(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(t){}return}()),e}function n(){r&&(r.gain.value=0),s=0,o&&o.pause()}t.mute=function(t){a=t,n()},t.stop=n,t.frequency=function(){return s},t.tone=function(t,e){if(!(a||t<=0)){s=t;var n=u();if(n){i&&(i.stop(),i.disconnect(),i=void 0),e=Math.max(0,Math.min(1,e));try{i=n.createOscillator(),r=n.createGain(),i.type="triangle",i.connect(r),r.connect(n.destination),r.gain.value=e,i.start(0)}catch(t){return void(r=i=void 0)}i.frequency.value=t,r.gain.value=e}}},t.playBufferAsync=function(i){return i?new Promise(function(t){function e(){t&&t(),t=void 0}var n="data:audio/wav;base64,"+window.btoa(function(t){for(var e=t.length,n="",i=0;i<e;++i)n+=String.fromCharCode(t[i]);return n}(i.data));o=new Audio(n),a&&(o.volume=0),o.onended=function(){return e()},o.onpause=function(){return e()},o.onerror=function(){return e()},o.play()}):Promise.resolve()}}(o.AudioContextManager||(o.AudioContextManager={})),o.isTouchEnabled=i,o.hasPointerEvents=r,o.pointerEvents=r()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:i()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"}}(pxsim||(pxsim={})),function(P){!function(e){function o(e,n){return function(t){return t*(n/e)}}function n(t,e){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}e.translateEl=function(t,e){P.svg.hydrate(t,{transform:"translate("+e[0]+" "+e[1]+")"})},e.composeSVG=function(t){var e=[t.el1,t.el2],n=e[0],i=e[1];P.U.assert(0==n.x&&0==n.y&&0==i.x&&0==i.y,"el1 and el2 x,y offsets not supported");var r=function(t,e,n){return P.svg.hydrate(t,{x:e,y:n})},o=function(t,e,n){return P.svg.hydrate(t,{width:e+"px",height:n+"px"})},s=t.scaleUnit2,a=t.scaleUnit2/t.scaleUnit1,u=n.w*a,l=n.h*a;o(n.el,u,l);var c=1*i.w,p=1*i.h;o(i.el,c,p);var d=t.margin,h=d[0],f=d[1],m=d[2],g=d[3],v=t.middleMargin,b=Math.max(u,c),y=f+(b-u)/2,w=h;r(n.el,y,w);var x=f+(b-c)/2,C=w+l+v;r(i.el,x,C);var R,k,I,E=[w,w+l,C,C+p],D=f+b+g,S=h+l+v+p+m,_=P.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+D+" "+S,class:"sim-bb"});R=_,k=t.maxWidth,I=t.maxHeight,k&&P.svg.hydrate(R,{width:k}),I&&P.svg.hydrate(R,{height:I}),r(_,0,0);var B=P.svg.child(_,"g");return _.appendChild(n.el),_.appendChild(i.el),{under:B,over:P.svg.child(_,"g"),host:_,edges:E,scaleUnit:s,toHostCoord1:function(t){var e=t[0],n=t[1];return[e*a+y,n*a+w]},toHostCoord2:function(t){var e=t[0],n=t[1];return[1*e+x,1*n+C]}}},e.mkScaleFn=o,e.mkImageSVG=function(t){var e=o(t.imageUnitDist,t.targetUnitDist),n=e(t.width),i=e(t.height),r=P.svg.elt("image",{width:n,height:i});return r.setAttributeNS("http://www.w3.org/1999/xlink","href",""+t.image),{el:r,w:n,h:i,x:0,y:0}},e.findDistSqrd=n,e.findClosestCoordIdx=function(e,t){return t.map(function(t){return n(e,t)}).reduce(function(t,e,n,i){return e<i[t]?n:t},0)},e.mkTxt=function(t,e,n,i,r,o,s){var a=P.svg.elt("text");s=s||.3;var u=(o=o||-.33333)*n*r.length,l=s*n;return P.svg.hydrate(a,{style:"font-size:"+n+"px;",transform:"translate("+t+" "+e+") rotate("+i+") translate("+u+" "+l+")"}),P.svg.addClass(a,"noselect"),a.textContent=r,a},e.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],e.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},e.mapWireColor=function(t){return e.WIRE_COLOR_MAP[t]||t},e.PIN_DIST=15,e.rgbToHsl=function(t){var e,n,i,r=[t[0]/255,t[1]/255,t[2]/255],o=r[0],s=r[1],a=r[2],u=Math.min(o,s,a),l=Math.max(o,s,a),c=l-u,p=l+u;return i=p/2*100,0===c?n=e=0:(l===o?e=(s-a)/c%6*60:l===s?e=60*((a-o)/c+2):l===a&&(e=60*((o-s)/c+4)),n=50<i?c/(2-p)*100:c/p*100),[Math.floor(e),Math.floor(n),Math.floor(i)]}}(P.visuals||(P.visuals={}))}(pxsim||(pxsim={})),function(a){var s;!function(t){function o(t,e,n){var i={class:t,d:e};n&&(i.title=n);var r=s.elt("path");return s.hydrate(r,i),r}function r(t,e){void 0===e&&(e=!1);var n=s.elt("linearGradient");s.hydrate(n,{id:t,x1:"0%",y1:"0%",x2:e?"100%":"0%",y2:e?"0%":"100%"});s.child(n,"stop",{offset:"0%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"}),s.child(n,"stop",{offset:"100%"});return n}function i(t){var e=s.elt("title");return e.textContent=t,e}t.parseString=function(t){return(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("svg").item(0)},t.toDataUri=function(t){return"data:image/svg+xml,"+encodeURI(t)},t.cursorPoint=function(t,e,n){return t.x=n.clientX,t.y=n.clientY,t.matrixTransform(e.getScreenCTM().inverse())},t.rotateElement=function(t,e,n,i){t.setAttribute("transform","translate("+e+","+n+") rotate("+(i+90)+") translate("+-e+","+-n+")")},t.hasClass=function(t,e){return t.classList?t.classList.contains(e):-1<t.className.baseVal.indexOf(e)},t.addClass=function(t,e){t.classList?t.classList.add(e):t.className.baseVal.indexOf(e)<0&&(t.className.baseVal+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className.baseVal=t.className.baseVal.replace(e,"").replace(/\s{2,}/," ")},t.hydrate=function(t,e){for(var n in e)"title"==n?s.title(t,e[n]):t.setAttributeNS(null,n,e[n])},t.elt=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return e&&s.hydrate(n,e),n},t.child=function(t,e,n){var i=s.elt(e,n);return t.appendChild(i),i},t.mkPath=o,t.path=function(t,e,n,i){var r=o(e,n,i);return t.appendChild(r),r},t.fill=function(t,e){t.style.fill=e},t.filter=function(t,e){t.style.filter=e},t.fills=function(t,e){t.forEach(function(t){return t.style.fill=e})},t.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||0<navigator.maxTouchPoints)},t.onClick=function(e,n){var i=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return i=!0},!1)}),e.addEventListener(a.pointerEvents.up,function(t){return!i||(i=!1,n(t),t.preventDefault(),!1)},!1)},t.buttonEvents=function(e,n,i,r,o){var s=!1;a.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){return s=!0,i&&i(t),!0},!1)}),e.addEventListener(a.pointerEvents.move,function(t){return!s||(n&&n(t),t.preventDefault(),!1)},!1),e.addEventListener(a.pointerEvents.up,function(t){s=!1,r&&r(t)},!1),e.addEventListener(a.pointerEvents.leave,function(t){s=!1,r&&r(t)},!1),e.addEventListener("keydown",function(t){s=!1,o&&o(t)})},t.mkLinearGradient=r,t.linearGradient=function(t,e,n){void 0===n&&(n=!1);var i=r(e,n);return t.appendChild(i),i},t.setGradientColors=function(t,e,n){t&&(t.childNodes[0].style.stopColor=e,t.childNodes[1].style.stopColor=e,t.childNodes[2].style.stopColor=n,t.childNodes[3].style.stopColor=n)},t.setGradientValue=function(t,e){t.childNodes[1].getAttribute("offset")!=e&&(t.childNodes[1].setAttribute("offset",e),t.childNodes[2].setAttribute("offset",e))},t.animate=function(t,e){s.addClass(t,e);var n=t.parentElement;n&&(n.removeChild(t),n.appendChild(t))},t.mkTitle=i,t.title=function(t,e){var n=i(e);return t.appendChild(n),n},t.toHtmlColor=function(t){return"rgba("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+", "+(t>>24&1)+")"}}(s=a.svg||(a.svg={}))}(pxsim||(pxsim={})),function(t){var e=function(t){this.id=t};t.Button=e;var n=function(t){this.props=t,this.usesButtonAB=!1,this.aBtn=new e(this.props.ID_BUTTON_A),this.bBtn=new e(this.props.ID_BUTTON_B),this.abBtn=new e(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0};t.ButtonPairState=n}(pxsim||(pxsim={})),function(t){var e=function(){this.usesHeading=!1,this.heading=90};(pxsim||(pxsim={})).CompassState=e}(),function(e){var n,t;(t=n=e.PinFlags||(e.PinFlags={}))[t.Unused=0]="Unused",t[t.Digital=1]="Digital",t[t.Analog=2]="Analog",t[t.Input=4]="Input",t[t.Output=8]="Output",t[t.Touch=16]="Touch";var i=function(){function t(t){this.id=t,this.touched=!1,this.value=0,this.period=0,this.servoAngle=0,this.mode=n.Unused,this.pitch=!1,this.pull=0}return t.prototype.digitalReadPin=function(){return this.mode=n.Digital|n.Input,100<this.value?1:0},t.prototype.digitalWritePin=function(t){this.mode=n.Digital|n.Output,this.value=0<t?200:0,e.runtime.queueDisplayUpdate()},t.prototype.setPull=function(t){this.pull=t},t.prototype.analogReadPin=function(){return this.mode=n.Analog|n.Input,this.value||0},t.prototype.analogWritePin=function(t){this.mode=n.Analog|n.Output,this.value=Math.max(0,Math.min(1023,t)),e.runtime.queueDisplayUpdate()},t.prototype.analogSetPeriod=function(t){this.mode=n.Analog|n.Output,this.period=t,e.runtime.queueDisplayUpdate()},t.prototype.servoWritePin=function(t){this.analogSetPeriod(2e4),this.servoAngle=Math.max(0,Math.min(180,t)),e.runtime.queueDisplayUpdate()},t.prototype.servoSetPulse=function(t,e){},t.prototype.isTouched=function(){return this.mode=n.Touch|n.Analog|n.Input,this.touched},t}();e.Pin=i;var r=function(){function t(t){this.props=t,this.pins=t.pins.map(function(t){return null!=t?new i(t):null})}return t.prototype.getPin=function(e){return this.pins.filter(function(t){return t&&t.id==e})[0]||null},t}();e.EdgeConnectorState=r}(pxsim||(pxsim={})),function(t){var e=function(){function t(){this.files={}}return t.prototype.append=function(t,e){this.files[t]=(this.files[t]||"")+e},t.prototype.remove=function(t){delete this.files[t]},t}();t.FileSystemState=e}(pxsim||(pxsim={})),function(t){var e=function(){this.usesLightLevel=!1,this.lightLevel=128};(pxsim||(pxsim={})).LightSensorState=e}(),function(t){var p,e;(e=p=t.NeoPixelMode||(t.NeoPixelMode={}))[e.RGB=0]="RGB",e[e.RGBW=1]="RGBW";var n=function(){function t(){this.buffers={},this.colors={},this.dirty={}}return t.prototype.updateBuffer=function(t,e){this.buffers[e]=t,this.dirty[e]=!0},t.prototype.getColors=function(t,e){var n=this.colors[t]||(this.colors[t]=[]);if(this.dirty[t]){var i=this.buffers[t]||(this.buffers[t]=new Uint8Array([]));this.readNeoPixelBuffer(i,n,e),this.dirty[t]=!1}return n},t.prototype.readNeoPixelBuffer=function(t,e,n){for(var i=t,r=n===p.RGBW?4:3,o=Math.floor(i.length/r),s=0;s<o;s++){var a=i[s*r+1],u=i[s*r+0],l=i[s*r+2],c=0;4===r&&(c=i[s*r+3]),e[s]=[a,u,l,c]}},t}();t.NeoPixelState=n}(pxsim||(pxsim={})),function(t){var e=function(){function t(t){this.pin=t,this.on=!1}return t.prototype.toggle=function(){this.on=!this.on,this.on?this.pin.value=200:this.pin.value=0},t}();t.ToggleState=e}(pxsim||(pxsim={})),function(h){!function(d){d.mkBoardView=function(t){var e=t.visual;return new d.GenericBoardSvg({visualDef:e,wireframe:t.wireframe})};var t=function(){function t(t,e){var n=this;this.parts=[],this.boardView=t,(this.opts=e).boardDef.pinStyles||(e.boardDef.pinStyles={}),this.state=e.state;var i=e.partsList;if(0<i.length||e.forceBreadboardLayout){this.breadboard=new d.Breadboard({wireframe:e.wireframe});var r=e.boardDef.marginWhenBreadboarding||[0,0,40,0],o=d.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[r[0],r[1],20,r[3]],middleMargin:r[2],maxWidth:e.maxWidth,maxHeight:e.maxHeight}),s=o.under,a=o.over;this.view=o.host;var u=o.edges;this.fromMBCoord=o.toHostCoord1,this.fromBBCoord=o.toHostCoord2;o.scaleUnit;this.partGroup=a,this.partOverGroup=h.svg.child(this.view,"g"),this.style=h.svg.child(this.view,"style",{}),this.defs=h.svg.child(this.view,"defs",{}),this.wireFactory=new d.WireFactory(s,a,u,this.style,this.getLocCoord.bind(this),this.getPinStyle.bind(this));var l=h.allocateDefinitions({boardDef:e.boardDef,partDefs:e.partDefs,fnArgs:e.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:i});this.addAll(l),l.requiresBreadboard||e.forceBreadboardRender||this.breadboard.hide()}else{var c=this.boardView.getView().el;this.view=c,this.partGroup=h.svg.child(this.view,"g"),this.partOverGroup=h.svg.child(this.view,"g"),e.maxWidth&&h.svg.hydrate(this.view,{width:e.maxWidth}),e.maxHeight&&h.svg.hydrate(this.view,{height:e.maxHeight})}this.state.updateSubscribers.push(function(){return n.updateState()})}return t.prototype.highlightBoardPin=function(t){this.boardView.highlightPin(t)},t.prototype.highlightBreadboardPin=function(t){this.breadboard.highlightLoc(t)},t.prototype.highlightWire=function(t){t.wires.forEach(function(t){h.svg.addClass(t,"highlight"),t.style.visibility="visible"}),h.svg.addClass(t.endG,"highlight")},t.prototype.getView=function(){return this.view},t.prototype.updateState=function(){this.parts.forEach(function(t){return t.updateState()})},t.prototype.getBBCoord=function(t){var e=this.breadboard.getCoord(t);return this.fromBBCoord(e)},t.prototype.getPinCoord=function(t){var e=this.boardView.getCoord(t);return h.U.assert(!!e,"Unable to find coord for pin: "+t),this.fromMBCoord(e)},t.prototype.getLocCoord=function(t){var e;if("breadboard"===t.type){var n=t;e=this.getBBCoord(n)}else{var i=t.pin;e=this.getPinCoord(i)}return e||(console.error("Unknown location: "+name),[0,0])},t.prototype.getPinStyle=function(t){return"breadboard"==t.type?"female":this.opts.boardDef.pinStyles[t.pin]||"female"},t.prototype.addPart=function(t){var e=this,n=null;if(t.simulationBehavior){var i=t.simulationBehavior,r=this.state.builtinVisuals[i],o=this.state.builtinParts[i];(n=r()).init(this.state.bus,o,this.view,t.params)}else{var s=t.visual;n=new d.GenericPart(s)}this.parts.push(n),this.partGroup.appendChild(n.element),n.overElement&&this.partOverGroup.appendChild(n.overElement),n.defs&&n.defs.forEach(function(t){return e.defs.appendChild(t)}),this.style.textContent+=n.style||"";var a=t.startColumnIdx,u=t.startRowIdx,l={type:"breadboard",row:d.getRowName(u),col:d.getColumnName(a),xOffset:t.bbFit.xOffset/t.visual.pinDistance,yOffset:t.bbFit.yOffset/t.visual.pinDistance},c=this.getBBCoord(l);n.moveToCoord(c);var p="sim-"+t.name+"-cmp";return h.svg.addClass(n.element,p),h.svg.addClass(n.element,"sim-cmp"),n.updateTheme(),n.updateState(),n},t.prototype.addWire=function(t){return this.wireFactory.addWire(t.start,t.end,t.color)},t.prototype.addAll=function(t){var i=this;t.partsAndWires.forEach(function(t){var e=t.part;e&&i.addPart(e);var n=t.wires;n&&n.forEach(function(t){return i.addWire(t)})})},t}();d.BoardHost=t}(h.visuals||(h.visuals={}))}(pxsim||(pxsim={})),function(Z){!function(B){B.BREADBOARD_MID_ROWS=10,B.BREADBOARD_MID_COLS=30;var P=[4,4],t=B.BREADBOARD_MID_ROWS+P.length,A=[4,9,14,19],e=25+A.length,T=15*(B.BREADBOARD_MID_COLS+3),M=15*(t+4+5.5),L=M*(2/3),O=M*(.5*(1-2/3)),n=15*(B.BREADBOARD_MID_COLS-1),N=(T-n)/2,q=O+(L-15*(t-1))/2,U=15*(e-1),F=(T-U)/2,V=(O-15)/2,W=F,G=V+O+L,i=1.3,r=6,o=2,l=1.3,H=-90,s="abcdefghij".split("").reverse();function j(t){return""+(t+1)}function z(t){return s[t]}function Y(f){for(var m=f.xOffset||0,i=f.yOffset||0,g=[],v=Z.svg.elt("g"),b=f.colStartIdx||0,r=f.rowStartIdx||0,o=function(t){return t?t.slice(0,t.length):[]},y=function(t,e){for(var n,i=0;0<=(n=t.indexOf(e));)t.splice(n,1),i+=1;return i},s=0,a=o(f.rowIdxsWithGap),t=function(t){for(var c=0,p=o(f.colIdxsWithGap),d=i+t*f.pinDist+s*f.pinDist,h=t+r,e=function(t){var i=m+t*f.pinDist+c*f.pinDist,e=t+b,n=function(t){var e=i-.5*t.w,n=d-.5*t.h;return Z.svg.hydrate(t.el,{x:e,y:n}),v.appendChild(t.el),t.el},r=n(f.mkPin()),o=n(f.mkHoverPin()),s=f.getRowName(h),a=f.getColName(e),u=f.getGroupName?f.getGroupName(h,e):null,l={el:r,hoverEl:o,cx:i,cy:d,row:s,col:a,group:u};g.push(l),c+=y(p,e)},n=0;n<f.colCount;n++)e(n);s+=y(a,h)},e=0;e<f.rowCount;e++)t(e);return{g:v,allPins:g}}function J(){var t=Z.svg.elt("rect"),e=r;return Z.svg.hydrate(t,{class:"sim-bb-pin",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function K(){var t=Z.svg.elt("rect"),e=r*i;return Z.svg.hydrate(t,{class:"sim-bb-pin-hover",rx:o,ry:o,width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}}function Q(t,e,n,i,r,o,s){var a=B.mkTxt(t,e,n,i,r);Z.svg.addClass(a,"sim-bb-label"),s&&s.forEach(function(t){return Z.svg.addClass(a,t)});var u=B.mkTxt(t,e,n*l,i,r);return Z.svg.addClass(u,"sim-bb-label-hover"),s&&s.forEach(function(t){return Z.svg.addClass(u,t)}),{el:a,hoverEl:u,txt:r,group:o}}B.getColumnName=j,B.getRowName=z,B.mkGrid=Y;var a=function(){function t(t){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),t.wireframe&&Z.svg.addClass(this.bb,"sim-bb-outline")}return t.prototype.hide=function(){this.bb.style.display="none"},t.prototype.updateLocation=function(t,e){Z.svg.hydrate(this.bb,{x:t+"px",y:e+"px"})},t.prototype.getPin=function(t,e){var n=this.rowColToPin[t];if(!n)return null;var i=n[e];return i||null},t.prototype.getCoord=function(t){var e=t.row,n=t.col,i=t.xOffset,r=t.yOffset,o=this.getPin(e,n);if(!o)return null;var s=15*(i||0),a=15*(r||0);return[o.cx+s,o.cy+a]},t.prototype.getPinDist=function(){return 15},t.prototype.buildDom=function(){var a=this;this.bb=Z.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+T+" "+M,class:"sim-bb",width:T+"px",height:M+"px"}),this.styleEl=Z.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=Z.svg.child(this.bb,"defs",{}),Z.svg.child(this.bb,"rect",{class:"sim-bb-background",width:T,height:M,rx:4.5,ry:4.5});var r="sim-bb-channel-grad",t=Z.svg.elt("linearGradient");Z.svg.hydrate(t,{id:r,x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(t);Z.svg.child(t,"stop",{offset:"0%",style:"stop-color: #AAA;"}),Z.svg.child(t,"stop",{offset:"20%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"80%",style:"stop-color: #CCC;"}),Z.svg.child(t,"stop",{offset:"100%",style:"stop-color: #AAA;"});var e=function(t,e,n){var i=Z.svg.child(a.bb,"rect",{class:"sim-bb-channel "+(n||""),y:t-e/2,width:T,height:e});return i.setAttribute("fill","url(#"+r+")"),i};e(O+L/2,15,"sim-bb-mid-channel"),e(O,.75,"sim-bb-sml-channel"),e(O+L,.75);var n=function(t,e){return""+(t<B.BREADBOARD_MID_ROWS/2?"b":"t")+j(e)},i=function(t){return 0===t?"-":"+"},o=function(t,e){var n=e<25?"b":"t";return""+i(t)+n},s=Y({xOffset:N,yOffset:q,rowCount:B.BREADBOARD_MID_ROWS,colCount:B.BREADBOARD_MID_COLS,pinDist:15,mkPin:J,mkHoverPin:K,getRowName:z,getColName:j,getGroupName:n,rowIdxsWithGap:P});s.g;this.allPins=this.allPins.concat(s.allPins);var u=Y({xOffset:W,yOffset:G,rowCount:2,colCount:25,pinDist:15,mkPin:J,mkHoverPin:K,getRowName:i,getColName:j,getGroupName:o,colIdxsWithGap:A});u.g;this.allPins=this.allPins.concat(u.allPins);var l=Y({xOffset:F,yOffset:V,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:J,mkHoverPin:K,getRowName:i,getColName:j,getGroupName:o,colIdxsWithGap:A.map(function(t){return t+25})});l.g;this.allPins=this.allPins.concat(l.allPins),this.allPins.forEach(function(t){var e=t.el,n=t.row,i=t.col,r=t.hoverEl,o="("+n+","+i+")";Z.svg.hydrate(e,{title:o}),Z.svg.hydrate(r,{title:o})}),this.allPins.forEach(function(t){var e=a.rowColToPin[t.row];e||(e=a.rowColToPin[t.row]={}),e[t.col]=t});for(var c=function(t,e,n,i,r,o){var s=a.getCoord({type:"breadboard",row:t,col:e});return Q(s[0]+n,s[1]+i,10.5,-90,r,o)},p=0;p<B.BREADBOARD_MID_COLS;p++){var d=j(p),h=c(z(0),d,0,-15,d,n(0,p));this.allLabels.push(h);var f=B.BREADBOARD_MID_ROWS-1,m=c(z(f),d,0,15,d,n(f,p));this.allLabels.push(m)}for(var g=0;g<B.BREADBOARD_MID_ROWS;g++){var v=z(g);h=c(v,j(0),-15,0,v);this.allLabels.push(h);m=c(v,j(B.BREADBOARD_MID_COLS-1),15,0,v);this.allLabels.push(m)}var b=[Q(13.05,O+L+12,30,H,"-",o(0,0),["sim-bb-blue"]),Q(12,O+L+O-12,25.5,H,"+",o(1,0),["sim-bb-red"]),Q(T-12+1.05,O+L+12,30,H,"-",o(0,24),["sim-bb-blue"]),Q(T-12,O+L+O-12,25.5,H,"+",o(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(b);var y=[Q(13.05,12,30,H,"-",o(0,25),["sim-bb-blue"]),Q(12,O-12,25.5,H,"+",o(1,25),["sim-bb-red"]),Q(T-12+1.05,12,30,H,"-",o(0,49),["sim-bb-blue"]),Q(T-12,O-12,25.5,H,"+",o(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(y);var w={};this.allLabels.forEach(function(t){t.el;var e=t.txt;(w[e]=w[e]||[]).push(t)});this.allPins.forEach(function(e){var t,n=e.row,i=e.col,r=(e.group,a.rowColToLbls[n]||(a.rowColToLbls[n]={})),o=r[i]||(r[i]=[]);"-"===(t=e).row||"+"===t.row?Number(i)<=25?b.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):y.filter(function(t){return t.group==e.group}).forEach(function(t){return o.push(t)}):(w[n].forEach(function(t){return o.push(t)}),w[i].forEach(function(t){return o.push(t)}))});var x=U+22.5,C=(x-U)/2,R=function(t,e,n,i){var r=Z.svg.elt("rect");return Z.svg.hydrate(r,{class:"sim-bb-bar "+i,x:t,y:e-1.5,width:x,height:3}),{el:r,group:n}},k=[R(W-C,G-9,o(0,49),"sim-bb-blue"),R(W-C,G+15+9,o(1,49),"sim-bb-red"),R(F-C,V-9,o(0,0),"sim-bb-blue"),R(F-C,V+15+9,o(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(k),this.allPowerBars.forEach(function(t){return a.bb.appendChild(t.el)});var I=this.allPins.map(function(t){return t.group}).filter(function(t,e,n){return n.indexOf(t)==e}),E=I.map(function(t){return Z.svg.elt("g")});E.forEach(function(t){return Z.svg.addClass(t,"sim-bb-pin-group")}),E.forEach(function(t,e){return Z.svg.addClass(t,"group-"+I[e])});var D={};I.forEach(function(t,e){return D[t]=E[e]});var S={};this.allPins.forEach(function(t,e){var n=t.group;(S[n]||(S[n]=[])).push(t)}),I.forEach(function(t){var e=S[t],n=[e.map(function(t){return t.cx}),e.map(function(t){return t.cy})],i=n[0],r=n[1],o=function(t){return t.reduce(function(t,e){return t<e?t:e})},s=function(t){return t.reduce(function(t,e){return e<t?t:e})},a=[o(i),s(i),o(r),s(r)],u=a[0],l=a[1],c=a[2],p=a[3],d=Z.svg.elt("rect"),h=Math.max(l-u,1e-4),f=Math.max(p-c,1e-4);Z.svg.hydrate(d,{x:u,y:c,width:h,height:f}),Z.svg.addClass(d,"sim-bb-group-wire"),D[t].appendChild(d)}),this.allPins.forEach(function(t){var e=D[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)});var _=Z.svg.elt("g");Z.svg.hydrate(_,{class:"sim-bb-group-misc"}),E.push(_),this.allLabels.forEach(function(t){if(t.group){var e=D[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)}else _.appendChild(t.el),_.appendChild(t.hoverEl)}),E.forEach(function(t){return a.bb.appendChild(t)})},t.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:T,h:M}},t.prototype.highlightLoc=function(t){var e=t.row,n=t.col,i=this.rowColToPin[e][n];i.cx,i.cy;this.rowColToLbls[e][n].forEach(function(t){Z.svg.addClass(t.el,"highlight"),Z.svg.addClass(t.hoverEl,"highlight")})},t}();B.Breadboard=a}(Z.visuals||(Z.visuals={}))}(pxsim||(pxsim={})),function(k){!function(R){function h(t){var e=["sim-button","sim-button-outer"],n=e[0],i=e[1],r=R.PIN_DIST/2.5,o=R.PIN_DIST/5,s=.8*R.PIN_DIST,a=R.PIN_DIST/8,u=R.PIN_DIST/12,l=a+o,c=t[0],p=t[1],d=c-r/2,h=p-r/2,f=3*R.PIN_DIST-r,m=2*R.PIN_DIST+r,g=d,v=h+r,b=g+m/2,y=v+f/2,w=k.svg.elt("g"),x=function(t,e){k.svg.child(w,"rect",{class:"sim-button-tab",x:t,y:e,width:r,height:r})};x(d,h),x(d+2*R.PIN_DIST,h),x(d,h+3*R.PIN_DIST),x(d+2*R.PIN_DIST,h+3*R.PIN_DIST),k.svg.child(w,"rect",{class:i,x:g,y:v,rx:u,ry:u,width:m,height:f});var C=function(t,e){k.svg.child(w,"circle",{class:"sim-button-nut",cx:t,cy:e,r:o})};C(g+l,v+l),C(g+m-l,v+l),C(g+l,v+f-l),C(g+m-l,v+f-l);k.svg.child(w,"circle",{class:n,cx:b,cy:y,r:s});return{el:w,y:h,x:d,w:m,h:f+2*r}}R.mkBtnSvg=h,R.BUTTON_PAIR_STYLE="\n            .sim-button {\n                pointer-events: none;\n                fill: #000;\n            }\n            .sim-button-outer:active ~ .sim-button,\n            .sim-button-virtual:active {\n                fill: #FFA500;\n            }\n            .sim-button-outer {\n                cursor: pointer;\n                fill: #979797;\n            }\n            .sim-button-outer:hover {\n                stroke:gray;\n                stroke-width: "+R.PIN_DIST/5+"px;\n            }\n            .sim-button-nut {\n                fill:#000;\n                pointer-events:none;\n            }\n            .sim-button-nut:hover {\n                stroke:"+R.PIN_DIST/15+"px solid #704A4A;\n            }\n            .sim-button-tab {\n                fill:#FFF;\n                pointer-events:none;\n            }\n            .sim-button-virtual {\n                cursor: pointer;\n                fill: rgba(255, 255, 255, 0.6);\n                stroke: rgba(255, 255, 255, 1);\n                stroke-width: "+R.PIN_DIST/5+"px;\n            }\n            .sim-button-virtual:hover {\n                stroke: rgba(128, 128, 128, 1);\n            }\n            .sim-text-virtual {\n                fill: #000;\n                pointer-events:none;\n            }\n            ";var t=function(){function t(){this.style=R.BUTTON_PAIR_STYLE}return t.prototype.init=function(t,e){this.state=e,this.bus=t,this.defs=[],this.element=this.mkBtns(),this.updateState(),this.attachEvents()},t.prototype.moveToCoord=function(t){var e=3*R.PIN_DIST,n=t[0],i=t[1];R.translateEl(this.aBtn,[n,i]),R.translateEl(this.bBtn,[n+e,i]),R.translateEl(this.abBtn,[n+1.5*R.PIN_DIST,i+4*R.PIN_DIST])},t.prototype.updateState=function(){this.state.aBtn,this.state.bBtn,this.state.abBtn,this.aBtn,this.bBtn,this.abBtn;this.state.usesButtonAB&&"visible"!=this.abBtn.style.visibility&&(this.abBtn.style.visibility="visible")},t.prototype.updateTheme=function(){},t.prototype.mkBtns=function(){this.aBtn=h([0,0]).el,this.bBtn=h([0,0]).el;var t,e,n,i,r,o,s,a,u,l,c,p;this.abBtn=(t=2.8*R.PIN_DIST,e=(t-2*R.PIN_DIST)/2,n=R.PIN_DIST/2,r=i=0-e+t/2,o=1.3*R.PIN_DIST,a=s=-e,u=R.PIN_DIST/7,l=R.PIN_DIST/10,c=k.svg.elt("g"),k.svg.child(c,"rect",{class:"sim-button-virtual",x:s,y:a,rx:n,ry:n,width:t,height:t}),p=R.mkTxt(i+u,r+l,o,0,"A+B"),k.svg.addClass(p,"sim-text"),k.svg.addClass(p,"sim-text-virtual"),c.appendChild(p),c),this.abBtn.style.visibility="hidden";var d=k.svg.elt("g");return k.svg.addClass(d,"sim-buttonpair"),d.appendChild(this.aBtn),d.appendChild(this.bBtn),d.appendChild(this.abBtn),d},t.prototype.attachEvents=function(){var i=this,r=[this.state.aBtn,this.state.bBtn];[this.aBtn,this.bBtn].forEach(function(e,n){k.pointerEvents.down.forEach(function(t){return e.addEventListener(t,function(t){r[n].pressed=!0})}),e.addEventListener(k.pointerEvents.leave,function(t){r[n].pressed=!1}),e.addEventListener(k.pointerEvents.up,function(t){r[n].pressed=!1,i.bus.queue(r[n].id,i.state.props.BUTTON_EVT_UP),i.bus.queue(r[n].id,i.state.props.BUTTON_EVT_CLICK)})});var e=function(e){r.forEach(function(t){return t.pressed=e})};k.pointerEvents.down.forEach(function(t){return i.abBtn.addEventListener(t,function(t){e(!0)})}),this.abBtn.addEventListener(k.pointerEvents.leave,function(t){e(!1)}),this.abBtn.addEventListener(k.pointerEvents.up,function(t){e(!1),i.bus.queue(i.state.abBtn.id,i.state.props.BUTTON_EVT_UP),i.bus.queue(i.state.abBtn.id,i.state.props.BUTTON_EVT_CLICK)})},t}();R.ButtonPairView=t}(k.visuals||(k.visuals={}))}(pxsim||(pxsim={})),function(b){!function(d){d.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+d.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+d.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var h=.7*d.PIN_DIST,f=1.5*h,m=.66666*d.PIN_DIST,g=.66666*d.PIN_DIST+d.PIN_DIST/3,v=0,t=function(){function t(t){var i=this;this.props=t,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=v++;var r=t.visualDef,e=t.wireframe&&r.outlineImage?r.outlineImage:r.image,n=d.mkImageSVG({image:e,width:r.width,height:r.height,imageUnitDist:r.pinDist,targetUnitDist:d.PIN_DIST}),s=d.mkScaleFn(r.pinDist,d.PIN_DIST);this.width=n.w,this.height=n.h;var o=n.el;this.element=b.svg.elt("svg"),b.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),t.wireframe&&b.svg.addClass(this.element,"sim-board-outline"),this.style=b.svg.child(this.element,"style",{}),this.style.textContent+=d.BOARD_SYTLE,this.defs=b.svg.child(this.element,"defs",{}),this.g=b.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(o),this.background=o,b.svg.hydrate(o,{class:"sim-board"});var a=function(){var t=b.svg.elt("rect"),e=m;return b.svg.hydrate(t,{class:"sim-board-pin",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},u=function(){var t=b.svg.elt("rect"),e=g;return b.svg.hydrate(t,{class:"sim-board-pin-hover",width:e,height:e}),{el:t,w:e,h:e,x:0,y:0}},l=r.pinBlocks.map(function(e,t){var n=s(e.x)+d.PIN_DIST/2,i=s(e.y)+d.PIN_DIST/2,r=e.labels.length,o=d.mkGrid({xOffset:n,yOffset:i,rowCount:1,colCount:r,pinDist:d.PIN_DIST,mkPin:a,mkHoverPin:u,getRowName:function(){return""+(t+1)},getColName:function(t){return e.labels[t]},getGroupName:function(){return e.labels.join(" ")}});o.allPins,o.g;return b.svg.addClass(o.g,"sim-board-pin-group"),o}),c=[];l.forEach(function(t,n){return t.allPins.forEach(function(t,e){i.allPins.push(t),c.push(r.pinBlocks[n])})}),this.allPins.forEach(function(t){var e=t.col;b.svg.hydrate(t.el,{title:e}),b.svg.hydrate(t.hoverEl,{title:e})}),this.allPins.forEach(function(t){i.pinNmToPin[t.col]=t});var p=function(t,e,n,i,r){var o,s;"below"===r?(s=t,o=e+12+.25*n*i.length):(s=t,o=e-11-.32*n*i.length);return d.mkTxt(s,o,n,-90,i)};this.allLabels=this.allPins.map(function(t,e){var n=c[e];return function(t,e,n,i){var r=p(t,e,h,n,i);b.svg.addClass(r,"sim-board-pin-lbl");var o=p(t,e,f,n,i);return b.svg.addClass(o,"sim-board-pin-lbl-hover"),{el:r,hoverEl:o,txt:n}}(t.cx,t.cy,t.col,n.labelPosition)}),this.allPins.forEach(function(t,e){var n=i.allLabels[e];i.pinNmToLbl[t.col]=n}),this.allPins.forEach(function(t,e){var n=i.allLabels[e];i.g.appendChild(t.el),i.g.appendChild(t.hoverEl),i.g.appendChild(n.el),i.g.appendChild(n.hoverEl)})}return t.prototype.getCoord=function(t){var e=this.pinNmToPin[t];return e?[e.cx,e.cy]:null},t.prototype.mkGrayCover=function(t,e,n,i){var r=b.svg.elt("rect");return b.svg.hydrate(r,{x:t,y:e,width:n,height:i,class:"gray-cover"}),r},t.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},t.prototype.getPinDist=function(){return d.PIN_DIST},t.prototype.highlightPin=function(t){var e=this.pinNmToLbl[t],n=this.pinNmToPin[t];e&&n&&(b.svg.addClass(e.el,"highlight"),b.svg.addClass(e.hoverEl,"highlight"),b.svg.addClass(n.el,"highlight"),b.svg.addClass(n.hoverEl,"highlight"))},t}();d.GenericBoardSvg=t}(b.visuals||(b.visuals={}))}(pxsim||(pxsim={})),function(i){!function(e){function n(t){return e.mkImageSVG({image:t.image,width:t.width,height:t.height,imageUnitDist:t.pinDistance,targetUnitDist:e.PIN_DIST})}e.mkGenericPartSVG=n;var t=function(){function t(t){this.style="",this.defs=[];var e=n(t).el;this.element=i.svg.elt("g"),this.element.appendChild(e)}return t.prototype.moveToCoord=function(t){e.translateEl(this.element,t)},t.prototype.init=function(t,e,n){},t.prototype.updateState=function(){},t.prototype.updateTheme=function(){},t}();e.GenericPart=t}(i.visuals||(i.visuals={}))}(pxsim||(pxsim={})),function(r){!function(i){function e(){return r.svg.parseString('\n        <svg xmlns="http://www.w3.org/2000/svg" id="svg2" width="112.188" height="299.674">\n          <g id="layer1" stroke-linecap="round" stroke-linejoin="round" transform="scale(0.8)">\n            <path id="path8212" fill="#0061ff" stroke-width="6.6" d="M.378 44.61v255.064h112.188V44.61H.378z"/>\n            <path id="crankbase" fill="#00f" stroke-width="6.6" d="M56.57 88.047C25.328 88.047 0 113.373 0 144.615c.02 22.352 11.807 42.596 32.238 51.66.03 3.318.095 5.24.088 7.938 0 13.947 11.307 25.254 25.254 25.254 13.947 0 25.254-11.307 25.254-25.254-.006-2.986-.415-5.442-.32-8.746 19.487-9.45 30.606-29.195 30.625-50.852 0-31.24-25.33-56.568-56.57-56.568z"/>\n            <path id="lowertip" fill="#00a2ff" stroke-width="2" d="M.476 260.78v38.894h53.82v-10.486a6.82 6.566 0 0 1-4.545-6.182 6.82 6.566 0 0 1 6.82-6.566 6.82 6.566 0 0 1 6.82 6.566 6.82 6.566 0 0 1-4.545 6.182v10.486h53.82V260.78H.475z"/>\n            <path id="uppertip" fill="#00a2ff" stroke-width="2" d="M112.566 83.503V44.61h-53.82v10.487a6.82 6.566 0 0 1 4.544 6.18 6.82 6.566 0 0 1-6.818 6.568 6.82 6.566 0 0 1-6.82-6.567 6.82 6.566 0 0 1 4.546-6.18V44.61H.378v38.893h112.188z"/>\n            <path id="VCC" fill="red" stroke-width="2" d="M53.72 21.93h5.504v22.627H53.72z"/>\n            <path id="LOGIC" fill="#fc0" stroke-width="2" d="M47.3 21.93h5.503v22.627H47.3z"/>\n            <path id="GND" fill="#a02c2c" stroke-width="2" d="M60.14 21.93h5.505v22.627H60.14z"/>\n            <path id="connector" stroke-width="2" d="M45.064 0a1.488 1.488 0 0 0-1.488 1.488v24.5a1.488 1.488 0 0 0 1.488 1.487h22.71a1.488 1.488 0 0 0 1.49-1.488v-24.5A1.488 1.488 0 0 0 67.774 0h-22.71z"/>\n            <g id="crank" transform="translate(0 -752.688)">\n              <path id="arm" fill="#ececec" stroke="#000" stroke-width="1.372" d="M47.767 880.88c-4.447 1.162-8.412 8.278-8.412 18.492s3.77 18.312 8.412 18.494c8.024.314 78.496 5.06 78.51-16.952.012-22.013-74.377-21.117-78.51-20.035z"/>\n              <circle id="path8216" cx="56.661" cy="899.475" r="8.972" fill="gray" stroke-width="2"/>\n            </g>\n          </g>\n        </svg>\n                    ').firstElementChild}i.mkMicroServoPart=function(t){return void 0===t&&(t=[0,0]),{el:e(),x:t[0],y:t[1],w:112.188,h:299.674}};var t=function(){function t(){this.style="",this.overElement=void 0,this.defs=[],this.currentAngle=0,this.targetAngle=0,this.lastAngleTime=0}return t.prototype.init=function(t,e,n,i){this.state=e,this.pin=this.state.props.servos[r.readPin(i.name||i.pin)],this.bus=t,this.defs=[],this.initDom(),this.updateState()},t.prototype.initDom=function(){this.element=e(),this.crankEl=this.element.querySelector("#crank"),this.crankTransform=this.crankEl.getAttribute("transform")},t.prototype.moveToCoord=function(t){var e=t[0],n=t[1];i.translateEl(this.element,[e,n])},t.prototype.updateState=function(){if(this.targetAngle=180-this.state.getPin(this.pin).servoAngle,this.targetAngle!=this.currentAngle){var t=r.U.now(),e=Math.min(t-this.lastAngleTime,50)/1e3,n=this.targetAngle-this.currentAngle;this.currentAngle+=Math.min(Math.abs(n),300*e)*(0<n?1:-1),this.crankEl.setAttribute("transform",this.crankTransform+" rotate("+this.currentAngle+", 56.661, 899.475)"),this.lastAngleTime=t,setTimeout(function(){return r.runtime.updateDisplay()},20)}},t.prototype.updateTheme=function(){},t}();i.MicroServoView=t}(r.visuals||(r.visuals={}))}(pxsim||(pxsim={})),function(O){!function(B){var t,a=B.PIN_DIST/2.5,E=15,D=100;function P(t){return t.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function A(t,e,n,i){var r=function(t){return t[0]+", "+t[1]},o=t[0],s=t[1],a=e[0],u=e[1],l=u-s,c=[o,s+l*n],p=[a,u-l*n],d=O.svg.mkPath("sim-bb-wire","M"+r(t)+" C"+r(c)+" "+r(p)+" "+r(e));return O.svg.addClass(d,"wire-stroke-"+i),d}function T(t,e,n){var i=function(t){return t[0]+", "+t[1]},r=O.svg.mkPath("sim-bb-wire","M"+i(t)+" L"+i(e));return O.svg.addClass(r,"wire-stroke-"+n),r}function M(t,e){var n=B.PIN_DIST/4,i=O.svg.elt("circle"),r=t[0],o=t[1],s=a/2+n/2;return O.svg.hydrate(i,{cx:r,cy:o,r:s,class:"sim-bb-wire-end"}),O.svg.addClass(i,"wire-fill-"+e),i.style["stroke-width"]=n+"px",i}function S(t,e,n){var i=.24*B.PIN_DIST,r=10*i,o=2*i,s=6*i,a=i,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("rect"),f=r,m=o,g=l-m/2,v=c-f/2;O.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=O.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+p*(f/2+y/2)-y/2;return O.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}function L(t,e,n){var i=.24*B.PIN_DIST,r=4*i,o=10*i,s=3.5*i,a=3.5*i,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("polygon"),f=o,m=r,g=l-m/2,v=c-f/2,b=e?.15:.3,y=e?.7:1-.7,w=e?.3:.15;O.svg.hydrate(h,{points:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(function(t){return(e=t)[0]+","+e[1];var e}).join(" ")}([g+m*b,v],[g+m*(1-b),v],[g+m,v+f*y],[g+m*(1-w),v+f],[g+m*w,v+f],[g,v+f*y])}),O.svg.hydrate(h,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var x=O.svg.elt("rect"),C=s,R=a,k=l-R/2,I=c+p*(f/2+C/2)-C/2;return O.svg.hydrate(x,{x:k,y:I,width:R,height:C,class:"sim-bb-wire-bare-end"}),d.appendChild(x),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,I),w:m+2*u,h:f+C}}B.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+a+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+a+"px;\n            visibility: hidden;\n            stroke-dasharray: "+B.PIN_DIST/10+","+B.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",(t=B.WireEndStyle||(B.WireEndStyle={}))[t.BBJumper=0]="BBJumper",t[t.OpenJumper=1]="OpenJumper",t[t.Croc=2]="Croc",B.mkWirePart=function(t,e,n){void 0===n&&(n=!1);var i,r=O.svg.elt("g"),o=t[0],s=t[1],a=[o-E,s-D/2],u=[o+E,s+D/2];e=B.mapWireColor(e),i=n?L(a,!0,e):S(a,!0,e);var l,c,p,d,h,f,m,g,v,b,y,w,x=(c=u,p=e,d=function(t){return t[0]+", "+t[1]},h=(l=a)[0],f=l[1],m=c[0],g=c[1],b=[h,f+.8*(v=g-f)],y=[m,g-.8*v],(w=O.svg.mkPath("sim-bb-wire","M"+d(l)+" C"+d(b)+" "+d(y)+" "+d(c))).style.stroke=p,{el:w,x:Math.min(h,m),y:Math.min(f,g),w:Math.abs(h-m),h:Math.abs(f-g)}),C=S(u,!1,e);r.appendChild(x.el),r.appendChild(i.el),r.appendChild(C.el);var R=Math.min(i.x,C.x),k=Math.max(i.x+i.w,C.x+C.w),I=Math.min(i.y,C.y);return{el:r,x:R,y:I,w:k-R,h:Math.max(i.y+i.h,C.y+C.h)-I}};var e=function(){function t(t,e,n,i,r,o){this.nextWireId=0,this.styleEl=i,this.styleEl.textContent+=B.WIRES_CSS,this.underboard=t,this.overboard=e,this.boardEdges=n,this.getLocCoord=r,this.getPinStyle=o}return t.prototype.indexOfMin=function(t){for(var e=0,n=t[0],i=1;i<t.length;i++)t[i]<n&&(n=t[i],e=i);return e},t.prototype.closestEdgeIdx=function(e){var t=this.boardEdges.map(function(t){return Math.abs(e[1]-t)});return this.indexOfMin(t)},t.prototype.closestEdge=function(t){return this.boardEdges[this.closestEdgeIdx(t)]},t.prototype.drawWire=function(t,e,n){var r=this,i=[],o=O.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),s=function(t){var e,n=B.PIN_DIST/2,i=r.closestEdge(t);return e=i-t[1]<0?i-n:i+n,[t[0],e]},a=this.nextWireId++,u=P(n),l=M(t,u),c=M(e,u),p=O.svg.child(o,"g",{class:"sim-bb-wire-ends-g"});p.appendChild(l),p.appendChild(c);var d=this.closestEdgeIdx(t),h=this.closestEdgeIdx(e);if(d==h){var f=T(t,e,u);o.appendChild(f),i.push(f)}else{var m=s(t),g=s(e),v=T(t,m,u),b=T(e,g,u),y=void 0,w=void 0;!(1!=d&&2!=d||1!=h&&2!=h)?(y=A(m,g,.7,u),w=A(m,g,.7,u)):(y=T(m,g,u),w=T(m,g,u)),O.svg.addClass(w,"sim-bb-wire-hover"),o.appendChild(v),i.push(v),o.appendChild(b),i.push(b),this.underboard.appendChild(y),i.push(y),o.appendChild(w),i.push(w);var x="sim-bb-wire-id-"+a,C=function(t){return O.svg.addClass(t,x)};C(p),C(w),this.styleEl.textContent+="\n                    ."+x+":hover ~ ."+x+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var R="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=R,{endG:p,end1:l,end2:c,wires:i}},t.prototype.drawWireWithCrocs=function(t,e,n,i){var r=this;void 0===i&&(i=!1);var o=[],s=O.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),a=this.nextWireId++,u=P(n),l=M(t,u),c=e,p=e[0],d=e[1],h=[p=(e=[p,d+40])[0],(d=e[1])+-17],f=(i?function(t,e,n){var i=.24*B.PIN_DIST,r=4*i,o=1.2*i,s=10*i,a=i,u=B.PIN_DIST/4,l=t[0],c=t[1],p=e?-1:1,d=O.svg.elt("g"),h=O.svg.elt("rect"),f=r,m=o,g=l-m/2,v=c+10-f/2;O.svg.hydrate(h,{x:g,y:v,width:m,height:f,rx:.5,ry:.5,class:"sim-bb-wire-end"}),h.style["stroke-width"]=u+"px";var b=O.svg.elt("rect"),y=s,w=a,x=l-w/2,C=c+10+p*(f/2+y/2)-y/2;return O.svg.hydrate(b,{x:x,y:C,width:w,height:y,class:"sim-bb-wire-bare-end"}),b.style.fill="#bbb",d.appendChild(b),d.appendChild(h),{el:d,x:g-u,y:Math.min(v,C),w:m+2*u,h:f+y}}(h,!0):L(h,!0)).el,m=O.svg.child(s,"g",{class:"sim-bb-wire-ends-g"});m.appendChild(l);var g,v,b,y,w=this.closestEdgeIdx(t),x=this.closestEdgeIdx(c);if(w==x){var C=T(t,e,u);s.appendChild(C),o.push(C)}else{var R=(g=t,b=B.PIN_DIST/2,y=r.closestEdge(g),v=y-g[1]<0?y-b:y+b,[g[0],v]),k=T(t,R,u),I=void 0,E=void 0;!(1!=w&&2!=w||1!=x&&2!=x)?(I=A(R,e,.7,u),E=A(R,e,.7,u)):(I=T(R,e,u),E=T(R,e,u)),O.svg.addClass(E,"sim-bb-wire-hover"),s.appendChild(k),o.push(k),this.underboard.appendChild(I),o.push(I);var D="sim-bb-wire-id-"+a,S=function(t){return O.svg.addClass(t,D)};S(m),S(E),this.styleEl.textContent+="\n                    ."+D+":hover ~ ."+D+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}m.appendChild(f);var _="\n                .wire-stroke-"+u+" {\n                    stroke: "+B.mapWireColor(n)+";\n                }\n                .wire-fill-"+u+" {\n                    fill: "+B.mapWireColor(n)+";\n                }\n                ";return this.styleEl.textContent+=_,{endG:m,end1:l,end2:f,wires:o}},t.prototype.addWire=function(t,e,n){var i=this.getLocCoord(t),r=this.getLocCoord(e),o=(this.getPinStyle(t),this.getPinStyle(e));return"dalboard"==e.type&&"croc"==o?this.drawWireWithCrocs(i,r,n):this.drawWire(i,r,n)},t}();B.WireFactory=e}(O.visuals||(O.visuals={}))}(pxsim||(pxsim={}));