"use strict";var rt,serial,pxsim,__extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(t){t.getUserData=function(t,e){return t.userData[e]},t.setUserData=function(t,e,n){t.userData[e]=n};var e=function(){function t(){this._isDisposed=!1}return t.prototype.dispose=function(){this._isDisposed||(this._onDispose(),this._isDisposed=!0)},t}(),n=function(n){function t(t){var e=n.call(this)||this;return e._reference=t,e}return __extends(t,n),Object.defineProperty(t.prototype,"reference",{get:function(){return this._reference},enumerable:!0,configurable:!0}),t}(t.DisposableObject=e);t.ProxyObject=n;var o=function(){function e(t){this._objectcache=new Map,this._creator=t,e._factories.push(this)}return e.forgetAllInstances=function(){e._factories.forEach(function(t){return t.forgetAllInstances()})},e.prototype.instantiate=function(t){return this._creator(t)},e.prototype.instantiateWithCache=function(t){var e=objectHash(t||{},{algorithm:"md5",encoding:"hex",respectType:!1}),n=this._objectcache.get(e);return n||this._objectcache.set(e,n=this.instantiate(t)),n},e.prototype.forgetAllInstances=function(){this._objectcache.clear()},e._factories=new Array,e}();t.ObjectFactory=o}(rt||(rt={})),function(e){function t(t){return function(o){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.apply(this,t)||this;return n._rigidbody=null,n._isDisposed=!1,void 0!==n.castShadow&&(n.castShadow=!0),void 0!==n.receiveShadow&&(n.receiveShadow=!0),n}return __extends(t,o),Object.defineProperty(t.prototype,"position_",{get:function(){return this.position},set:function(t){this.position.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation_",{get:function(){var t=this.rotation.toVector3();return new e.VectorConstructor(THREE.Math.radToDeg(t.x),THREE.Math.radToDeg(t.y),THREE.Math.radToDeg(t.z))},set:function(t){this.rotation.setFromVector3(new e.VectorConstructor(THREE.Math.degToRad(t.x),THREE.Math.degToRad(t.y),THREE.Math.degToRad(t.z)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quaternion_",{get:function(){return this.quaternion},set:function(t){this.quaternion.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale_",{get:function(){return this.scale},set:function(t){this.scale.copy(t)},enumerable:!0,configurable:!0}),t.prototype.setRotationFromAxisAngle=function(t,e){t&&this.setRotationFromAxisAngle(t,THREE.Math.degToRad(e))},t.prototype.setPhysicsEnabled=function(t){this._rigidbody&&(this._rigidbody.isKinematic=!t)},t.prototype.lookAtPosition=function(t){t&&this.lookAt(t)},t.prototype.animate=function(e){this._rigidbody&&this._rigidbody.syncMotionStateToObject3d(),this.children.forEach(function(t){return t.animate(e)})},t.prototype.onAdded=function(e){this._rigidbody&&this._rigidbody.addRigidBody(e.physicsWorld),this.children.forEach(function(t){return t.onAdded(e)})},t.prototype.onRemoved=function(e){this.children.forEach(function(t){return t.onRemoved(e)}),this._rigidbody&&this._rigidbody.removeRigidBody(e.physicsWorld)},t.prototype.copy=function(t,e){throw o.prototype.copy.call(this,t,e),Error()},t.prototype.dispose=function(){this._isDisposed||(this._onDispose(),this._isDisposed=!0)},t.prototype._onDispose=function(){this.children.forEach(function(t){return t.dispose()}),e.Helper.safeObjectDispose(this._rigidbody)},t}(t)}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((e.Object3dMixin=t)(THREE.Object3D));e.Object3d=n}(pxsim||(pxsim={})),(pxsim||(pxsim={})).OrbitControlsConstructor=THREE.OrbitControls,function(r){function t(t){return function(o){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.apply(this,t)||this;return n._controls=new r.OrbitControlsConstructor(n),n._controls.target.set(0,0,0),n._controls.update(),n}return __extends(t,o),t.prototype.setSize=function(t,e){},t}(t)}var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((r.CameraMixin=t)(r.Object3dMixin(THREE.Camera)));r.Camera=e;var n=function(r){function t(t,e,n){var o=r.call(this,t||60,1,e||.2,n||2e3)||this;return o._oldaspect=0,o}return __extends(t,r),t.prototype.setSize=function(t,e){r.prototype.setSize.call(this,t,e);var n=this.aspect=t/e;this._oldaspect!==n&&(this._oldaspect=n,this.updateProjectionMatrix())},t}(t(r.Object3dMixin(THREE.PerspectiveCamera)));r.PerspectiveCamera=n}(pxsim||(pxsim={})),function(t){(t.camera||(t.camera={})).perspectiveCamera=function(){return new t.PerspectiveCamera}}(pxsim||(pxsim={})),(pxsim||(pxsim={})).ColorConstructor=THREE.Color,function(o){var t;(t=o.color||(o.color={})).colorToString=function(t){return"("+255*t.r+", "+255*t.g+", "+255*t.b+")"},t.standardColor=function(t){return new o.ColorConstructor(t)},t.randomColor=function(){return new o.ColorConstructor(Math.random()*(1<<24))},t.colorFromRgb=function(t,e,n){return new o.ColorConstructor(t/255,e/255,n/255)},t.colorFromHsv=function(t,e,n){return(new o.ColorConstructor).setHSL(t/255,e/255,n/255)},t.colorWheel=function(t){return new o.ColorConstructor(t)},t.colorPicker=function(t){return new o.ColorConstructor(t)}}(pxsim||(pxsim={})),function(t){function n(t){var e;e=t+"\r\n",console.log(e),pxsim.runtime.board.writeSerial(e)}t.writeLine=n,t.writeValue=function(t,e){n((t?t+":":"")+e)}}(serial||(serial={})),function(t){var e;(e=t.console||(t.console={})).log=function(t){serial.writeLine(t)},e.logValue=function(t,e){serial.writeValue(t,e)}}(pxsim||(pxsim={})),function(o){var t;(t=o.input||(o.input={})).onMouseEnter=function(t){o.singletonWorldBoard().events.listen(2,1,t)},t.onMouseMove=function(t){o.singletonWorldBoard().events.listen(2,2,t)},t.onMouseLeave=function(t){o.singletonWorldBoard().events.listen(2,3,t)},t.onMouseClick=function(t,e){var n;switch(t){case 1:n=3;break;case 2:n=4;break;case 3:n=5;break;default:return}o.singletonWorldBoard().events.listen(n,4,e)}}(pxsim||(pxsim={})),function(t){function e(t){return(e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._configureShadow=function(){this.shadow.camera instanceof THREE.OrthographicCamera&&(this.shadow.camera.left=-n.distFrustum,this.shadow.camera.right=n.distFrustum,this.shadow.camera.top=n.distFrustum,this.shadow.camera.bottom=-n.distFrustum),this.shadow.bias=1e-4,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048},e}(t)).distFrustum=100,e;var e}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((t.LightMixin=e)(t.Object3dMixin(THREE.Light)));t.Light=n;var o=function(n){function t(t,e){return n.call(this,t||4210752,e||1)||this}return __extends(t,n),t}(e(t.Object3dMixin(THREE.AmbientLight)));t.AmbientLight=o;var r=function(o){function t(t,e){var n=o.call(this,t||16777215,e||1)||this;return n._configureShadow(),n}return __extends(t,o),t}(e(t.Object3dMixin(THREE.DirectionalLight)));t.DirectionalLight=r;var i=function(o){function t(t,e,n){return o.call(this,t||3310847,e||16763007,n||.6)||this}return __extends(t,o),t}(e(t.Object3dMixin(THREE.HemisphereLight)));t.HemisphereLight=i;var s=function(i){function t(t,e,n,o){var r=i.call(this,t||16777215,e||1,n||0,o||2)||this;return r._configureShadow(),r}return __extends(t,i),t}(e(t.Object3dMixin(THREE.PointLight)));t.PointLight=s;var c=function(c){function t(t,e,n,o,r,i){var s=c.call(this,t||16777215,e||1,n||0,o||Math.PI/3,r||0,i||2)||this;return s._configureShadow(),s}return __extends(t,c),t}(e(t.Object3dMixin(THREE.SpotLight)));t.SpotLight=c}(pxsim||(pxsim={})),function(o){var t;(t=o.light||(o.light={})).ambientLight=function(t,e){return new o.DirectionalLight(t,e)},t.directionalLight=function(t,e){return new o.DirectionalLight(t,e)},t.hemisphereLight=function(t,e,n){return new o.HemisphereLight(t,e,n)}}(pxsim||(pxsim={})),function(e){var t;(t=e.loops||(e.loops={})).forever=function(t){e.thread.forever(t)},t.pauseAsync=function(t){return Promise.delay(t)}}(pxsim||(pxsim={})),function(t){function e(t){return function(o){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.apply(this,t)||this;return n._density=1,n}return __extends(t,o),Object.defineProperty(t.prototype,"density",{get:function(){return this._density},set:function(t){this._density=t},enumerable:!0,configurable:!0}),t.prototype.copy=function(t){return o.prototype.copy.call(this,t),this.density=t.density,this},t}(t)}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((t.MaterialMixin=e)(THREE.MeshStandardMaterial)),o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.instantiate=function(t){return e._factory.instantiate({color:(t?t.getHex():void 0)||16777215,emissive:0,metalness:0,roughness:.5})},e._factory=new rt.ObjectFactory(function(t){return new e(t)}),e}(t.Material=n);t.SolidMaterial=o}(pxsim||(pxsim={})),function(e){(e.material||(e.material={})).materialOfColor=function(t){return e.SolidMaterial.instantiate(t)}}(pxsim||(pxsim={})),function(t){t.VectorConstructor=THREE.Vector3,t.QuaternionConstructor=THREE.Quaternion,t.EulerConstructor=THREE.Euler,t.SphericalConstructor=THREE.Spherical}(pxsim||(pxsim={})),function(t){var e;(e=t.math||(t.math={})).degreesInRadians=function(t){return THREE.Math.degToRad(t)},e.radiansInDegrees=function(t){return THREE.Math.radToDeg(t)}}(pxsim||(pxsim={})),function(i){!function(t){function e(t,e,n){return new i.VectorConstructor(t,e,n)}function r(){return e(0,0,0)}function n(t,e,n,o){return new i.QuaternionConstructor(t,e,n,o)}t.vectorToString=function(t){return"("+t.x+", "+t.y+", "+t.z+")"},t.quaternionToString=function(t){return"("+t.x+", "+t.y+", "+t.z+", "+t.w+")"},t.vector=e,t.zeroVector=r,t.unitVector=function(){return e(1,1,1)},t.vectorOp=function(t,e,n){var o=r();switch(e){case 1:return o.addVectors(t,n);case 2:return o.subVectors(t,n);case 3:return o.multiplyVectors(t,n)}throw new Error},t.vectorScalarOp=function(t,e,n){var o=t;switch(e){case 1:return o.addScalar(n);case 2:return o.subScalar(n);case 3:return o.multiplyScalar(n);case 4:return o.divideScalar(n)}},t.quaternion=n,t.zeroQuaternion=function(){return n(0,0,0,0)}}(i.math3d||(i.math3d={}))}(pxsim||(pxsim={})),function(r){var t=function(o){function t(t,e){var n=o.call(this,t,e)||this;return n._rigidbody=new r.RigidBody(n,t,t.volume*e.density),n}return __extends(t,o),t}(r.Object3dMixin(THREE.Mesh));r.Mesh3d=t}(pxsim||(pxsim={})),function(n){var t;(t=n.mesh||(n.mesh={})).fromShapeAndMaterial=function(t,e){return t&&e?new n.Mesh3d(t,e):null},t.materialOf=function(t){if(!(t&&t instanceof n.Mesh3d))return null;var e=t.material;return Array.isArray(e)?0<e.length?e[0]:null:e}}(pxsim||(pxsim={})),(pxsim||(pxsim={})).RaycasterConstructor=THREE.Raycaster,function(e){var t=function(o){function t(){var t=o.call(this)||this;return t._physicsworld=new e.PhysicsWorld,t._camera=null,t._ambientlight=new e.AmbientLight,t._raycaster=new e.RaycasterConstructor,t.background=new e.ColorConstructor(8900331),t._ambientlight.color.setScalar(.5),t.addAt(t._ambientlight,e.math3d.zeroVector()),t}return __extends(t,o),Object.defineProperty(t.prototype,"physicsWorld",{get:function(){return this._physicsworld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this.background},set:function(t){this.background=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientlight.color},set:function(t){this._ambientlight.color=t},enumerable:!0,configurable:!0}),t.prototype.addAt=function(t,e){t&&(t.position.copy(e),this.add(t))},t.prototype.add=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t&&(o.prototype.add.apply(this,t),t.forEach(function(t){return t.onAdded(e)}))},t.prototype.remove=function(t){t&&(t.onRemoved(this),o.prototype.remove.call(this,t))},t.prototype.animate=function(t){o.prototype.animate.call(this,t),this._physicsworld.animate(t),e.singletonWorldBoard().events.queue(1,0,t)},t.prototype.intersectedObjects=function(t,e){if(!this._camera)return null;this._raycaster.setFromCamera({x:t,y:e},this._camera);var n=this._raycaster.intersectObjects(this.children);return n?n.map(function(t){return t.object}):null},t.prototype.setPhysicsEnabled=function(t){},t.prototype.copy=function(t,e){throw o.prototype.copy.call(this,t,e),Error()},t.prototype._onDispose=function(){o.prototype._onDispose.call(this),this._physicsworld.dispose()},t}(e.Object3dMixin(THREE.Scene));e.Scene3d=t}(pxsim||(pxsim={})),function(r){var t;(t=r.scene||(r.scene={})).randomPositionInSphere=function(t){var e=new r.SphericalConstructor(Math.random()*t*.5,Math.random()*Math.PI*2,Math.random()*Math.PI*2);return(new r.VectorConstructor).setFromSpherical(e)},t.randomPositionInCube=function(t){return new r.VectorConstructor(Math.random()*t,Math.random()*t,Math.random()*t).addScalar(-.5*t)},t.intersectedObjectAt=function(t,e){var n=r.world.scene(),o=n?n.intersectedObjects(t,e):null;return o&&0<o.length?o[0]:null},t.onAnimate=function(t){r.singletonWorldBoard().events.listen(1,0,t)}}(pxsim||(pxsim={})),function(o){function t(t){return(e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._volume=0,t._ctorCollisionShape=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},enumerable:!0,configurable:!0}),t.prototype.createCollisionShape=function(){return this._ctorCollisionShape?this._ctorCollisionShape():null},t.prototype.copy=function(t){throw e.prototype.copy.call(this,t),new Error},t.prototype._setShapeVolume=function(t){this._volume=t},t.prototype._setCtorCollisionShape=function(t){this._ctorCollisionShape=t},t.prototype._getBounds=function(t){return this.computeBoundingBox(),this.boundingBox.getSize(t)},t.prototype._createCollisionShapeFromHalfExtents=function(t){var e=o.Helper.btVector3FromThree(this._getBounds(new THREE.Vector3).divideScalar(2)),n=t(e);return n.setMargin(i._collisionMargin),o.Helper.safeAmmoObjectDestroy(e),n},t}(t))._radialSegments=32,e._collisionMargin=.05,e;var e}var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((o.ShapeMixin=t)(THREE.BufferGeometry));o.Shape3d=i;var e=function(o){function t(t,e){var n=this;return t=t||100,e=e||100,(n=o.call(this,t,e)||this).rotateX(-Math.PI/2),n._setCtorCollisionShape(function(){return n._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btBoxShape(t)})}),n}return __extends(t,o),t}(t(THREE.PlaneBufferGeometry));o.PlaneShape3d=e;var n=function(i){function t(t,e,n,o){var r=this;return t=t||1,e=e||1,n=n||1,(r=i.call(this,t,e,n)||this)._setShapeVolume(t*e*n),r._setCtorCollisionShape(function(){return r._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btBoxShape(t)})}),r}return __extends(t,i),t}(t(THREE.BoxBufferGeometry));o.BoxShape3d=n;var r=function(r){function t(t,e,n){var o=this;return t=t||.5,e=e||1,(o=r.call(this,t,t,e,i._radialSegments,1,n||!1)||this)._setShapeVolume(Math.PI*Math.pow(t,2)*e),o._setCtorCollisionShape(function(){return o._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btCylinderShape(t)})}),o}return __extends(t,r),t}(t(THREE.CylinderBufferGeometry));o.CylinderShape3d=r;var s=function(n){function t(t){var e=this;return t=t||.5,(e=n.call(this,t,i._radialSegments,i._radialSegments)||this)._setShapeVolume(4/3*Math.PI*Math.pow(t,3)),e._setCtorCollisionShape(function(){return new Ammo.btSphereShape(t)}),e}return __extends(t,n),t}(t(THREE.SphereBufferGeometry));o.SphereShape3d=s;var c=function(o){function t(t,e){var n=this;return t=t||.5,e=e||1,(n=o.call(this,t,e,i._radialSegments)||this)._setShapeVolume(Math.PI*Math.pow(t,2)*e/3),n._setCtorCollisionShape(function(){return new Ammo.btConeShape(t,e)}),n}return __extends(t,o),t}(t(THREE.ConeBufferGeometry));o.ConeShape3d=c}(pxsim||(pxsim={})),function(o){var t;(t=o.shape||(o.shape={})).planeShape=function(t,e){return new o.PlaneShape3d(t,e)},t.boxShape=function(t,e,n){return new o.BoxShape3d(t,e,n)},t.cylinderShape=function(t,e){return new o.CylinderShape3d(t,e)},t.sphereShape=function(t){return new o.SphereShape3d(t)},t.coneShape=function(t,e){return new o.ConeShape3d(t,e)}}(pxsim||(pxsim={})),function(s){var t=function(n){function o(t){void 0===t&&(t="container");var i=n.call(this)||this;i._scene3d=new s.Scene3d,i._onWindowResize=function(){i._renderer.resize(window.innerWidth,window.innerHeight,window.devicePixelRatio)},i._onDocumentMouseEnter=function(t){return i._onDocumentEvent(2,1,t)},i._onDocumentMouseMove=function(t){return i._onDocumentMouseEvent(2,2,t)},i._onDocumentMouseLeave=function(t){return i._onDocumentEvent(2,3,t)},i._onDocumentMouseClick=function(t){return i._onDocumentMouseEvent(o._sidFromMouseButtonEvent(t),4,t)},i._onDocumentKeyDown=function(t){return i._onDocumentKeyEvent(6,8,t)},i._onDocumentKeyPress=function(t){return i._onDocumentKeyEvent(6,7,t)},i._onDocumentKeyUp=function(t){return i._onDocumentKeyEvent(6,6,t)},i._onDocumentEvent=function(t,e,n,o){t&&s.singletonWorldBoard().events.queue(t,e,o)},i._onDocumentMouseEvent=function(t,e,n){var o=n.clientX/window.innerWidth*2-1,r=-n.clientY/window.innerHeight*2+1;i._onDocumentEvent(t,e,n,new s.EventCoordValue(o,r))},i._onDocumentKeyEvent=function(t,e,n){i._onDocumentEvent(t,e,n,new s.EventKeyValue("F1"))},i._renderer=new s.Renderer(t),i._renderer.scene=i._scene3d;var e=document.getElementById(i._renderer.id);return e&&(e.innerHTML="",Detector.webgl?e.appendChild(i._renderer.domElement):Detector.addGetWebGLMessage({parent:e})),i._onWindowResize(),window.addEventListener("resize",i._onWindowResize,!1),document.addEventListener("mouseenter",i._onDocumentMouseEnter,!1),document.addEventListener("mousemove",i._onDocumentMouseMove,!1),document.addEventListener("mouseleave",i._onDocumentMouseLeave,!1),document.addEventListener("click",i._onDocumentMouseClick,!1),document.addEventListener("keydown",i._onDocumentKeyDown,!1),document.addEventListener("keypress",i._onDocumentKeyPress,!1),document.addEventListener("keyup",i._onDocumentKeyUp,!1),i}return __extends(o,n),o._sidFromMouseButtonEvent=function(t){var e;return 0===t.button?e=3:1===t.button?e=4:2===t.button&&(e=5),e},Object.defineProperty(o.prototype,"scene",{get:function(){return this._scene3d},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),o.prototype._onDispose=function(){document.removeEventListener("click",this._onDocumentMouseClick,!1),document.removeEventListener("mouseleave",this._onDocumentMouseLeave,!1),document.removeEventListener("mousemove",this._onDocumentMouseMove,!1),document.removeEventListener("mouseenter",this._onDocumentMouseEnter,!1),document.removeEventListener("keyup",this._onDocumentKeyUp,!1),document.removeEventListener("keypress",this._onDocumentKeyPress,!1),document.removeEventListener("keydown",this._onDocumentKeyDown,!1),window.removeEventListener("resize",this._onWindowResize,!1);var t=document.getElementById(this._renderer.id);t&&(t.innerHTML=""),s.Helper.safeObjectDispose(this._renderer),s.Helper.safeObjectDispose(this._scene3d)},o}(rt.DisposableObject);s.World3d=t}(pxsim||(pxsim={})),function(e){var t;(t=e.world||(e.world={})).world=function(){return e.singletonWorldBoard().world},t.scene=function(){var t=e.world.world();return t?t.scene:null}}(pxsim||(pxsim={})),function(n){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._world3d=null,t._events=null,t}return __extends(t,e),Object.defineProperty(t,"singleton",{get:function(){return this._board},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._world3d},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),t.prototype.initAsync=function(t){return this.init(),Promise.resolve()},t.prototype.init=function(){this.postkill(),this._world3d=new n.World3d,this._events=new n.WorldEventBus(n.runtime)},t.prototype.kill=function(){this._world3d&&(this._world3d.renderer.pause=!0)},t.prototype.postkill=function(){rt.ObjectFactory.forgetAllInstances(),n.Helper.safeObjectDispose(this._world3d),this._world3d=null},t.prototype.receiveMessage=function(t){},t.prototype.updateView=function(){},t._board=new t,t}(n.BaseBoard);function e(){return t.singleton}n.WorldBoard=t,n.initCurrentRuntime=function(t){return e().postkill(),n.runtime.board=e()},n.singletonWorldBoard=e}(pxsim||(pxsim={})),function(t){var e=function(){},n=function(o){function t(t,e){var n=o.call(this)||this;return n.x=t,n.y=e,n}return __extends(t,o),t.prototype.toActionArgs=function(){return[this.x,this.y]},t}(t.EventValue=e);t.EventCoordValue=n;var o=function(n){function t(t){var e=n.call(this)||this;return e.key=t,e}return __extends(t,n),t.prototype.toActionArgs=function(){return[this.key]},t}(e);t.EventKeyValue=o;var r=function(e){function t(t){return e.call(this,t,function(t){return t?"object"==typeof t?t.toActionArgs():[t]:[]})||this}return __extends(t,e),t}(t.EventBusGeneric);t.WorldEventBus=r}(pxsim||(pxsim={})),function(t){var e=function(){function t(){}return t.btVector3FromThree=function(t){return new Ammo.btVector3(t.x,t.y,t.z)},t.btQuaternionFromThree=function(t){return new Ammo.btQuaternion(t.x,t.y,t.z,t.w)},t.applyFn=function(t,e){return Array.isArray(t)?t.map(e):e(t)},t.safeObjectDispose=function(t){t&&t.dispose()},t.safeAmmoObjectDestroy=function(t){t&&Ammo.destroy(t)},t}();t.Helper=e}(pxsim||(pxsim={})),function(o){var t=function(e){function n(){var t=e.call(this)||this;return t._btconfig=new Ammo.btDefaultCollisionConfiguration,t._btdispatcher=new Ammo.btCollisionDispatcher(t._btconfig),t._btbroadphase=new Ammo.btDbvtBroadphase,t._btconstraintsolver=new Ammo.btSequentialImpulseConstraintSolver,t._btworld=new Ammo.btDiscreteDynamicsWorld(t._btdispatcher,t._btbroadphase,t._btconstraintsolver,t._btconfig),t._btworld.getSolverInfo().m_numIterations=n._numIterationsSolver,t}return __extends(n,e),Object.defineProperty(n.prototype,"btWorld",{get:function(){return this._btworld},enumerable:!0,configurable:!0}),n.prototype.getGravity=function(){return this._btworld.getGravity().y()},n.prototype.setGravity=function(t){var e=new Ammo.btVector3(0,t,0);this._btworld.setGravity(e),o.Helper.safeAmmoObjectDestroy(e)},n.prototype.animate=function(t){this._btworld.stepSimulation(t,n._maxStepSimulation,n._fixedTimeStep)},n.prototype._onDispose=function(){o.Helper.safeAmmoObjectDestroy(this._btworld),o.Helper.safeAmmoObjectDestroy(this._btconstraintsolver),o.Helper.safeAmmoObjectDestroy(this._btbroadphase),o.Helper.safeAmmoObjectDestroy(this._btdispatcher),o.Helper.safeAmmoObjectDestroy(this._btconfig)},n._numIterationsSolver=4,n._maxStepSimulation=3,n._fixedTimeStep=1/60,n}(rt.DisposableObject);o.PhysicsWorld=t}(pxsim||(pxsim={})),(pxsim||(pxsim={})).ClockConstructor=THREE.Clock,function(r){var t=function(n){function o(t){void 0===t&&(t="container");var e=n.call(this,o._instantiateReference(t))||this;return e._domElement=document.createElement("div"),e._scene3d=null,e._stats=new Stats,e._clock=new r.ClockConstructor,e._paused=!1,e._callbackRequestId=0,e._id=t,e._domElement.appendChild(e.reference.domElement),e._domElement.appendChild(e._stats.dom),e.reference.shadowMap.enabled=!0,e.reference.shadowMap.type=THREE.PCFSoftShadowMap,e.reference.setClearColor(13882323),e.runRenderLoop(),e}return __extends(o,n),o._instantiateReference=function(t){var e=o._renderers.get(t);return e||(o._renderers.set(t,e=new THREE.WebGLRenderer({antialias:!0})),e.shadowMap.enabled=!0,e.shadowMap.type=THREE.PCFSoftShadowMap),e},Object.defineProperty(o.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"domElement",{get:function(){return this._domElement},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scene",{get:function(){return this._scene3d},set:function(t){this._scene3d=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isPaused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"pause",{set:function(t){this._paused=t},enumerable:!0,configurable:!0}),o.prototype.runRenderLoop=function(){var i=this;this._callbackRequestId=requestAnimationFrame(function(t){if(!i._paused){i._stats.begin();var e=!1,n=i._scene3d;if(n){n.animate(i._clock.getDelta());var o=n.camera;if(o){var r=i.reference.getSize();o.setSize(r.width,r.height),i.reference.render(n,o),e=!0}}e||i.reference.clear(),i._stats.end()}i.runRenderLoop()})},o.prototype.stopRenderLoop=function(){0!==this._callbackRequestId&&(cancelAnimationFrame(this._callbackRequestId),this._callbackRequestId=0)},o.prototype.resize=function(t,e,n){this.reference.setPixelRatio(n),this.reference.setSize(t,e)},o.prototype._onDispose=function(){this.stopRenderLoop()},o._renderers=new Map,o}(rt.ProxyObject);r.Renderer=t}(pxsim||(pxsim={})),function(d){function e(t,e){var n,o,r=new Ammo.btTransform;return r.setOrigin(n=d.Helper.btVector3FromThree(e.position)),r.setRotation(o=d.Helper.btQuaternionFromThree(e.quaternion)),t.setWorldTransform(r),d.Helper.safeAmmoObjectDestroy(o),d.Helper.safeAmmoObjectDestroy(n),d.Helper.safeAmmoObjectDestroy(r),t}function t(t,e){var n=new Ammo.btTransform;t.getWorldTransform(n);var o=n.getOrigin(),r=n.getRotation();e.position.set(o.x(),o.y(),o.z()),e.quaternion.set(r.x(),r.y(),r.z(),r.w()),d.Helper.safeAmmoObjectDestroy(n)}d.btMotionStateFromObject3d=e,d.btMotionStateToObject3d=t;var n=function(u){function l(t,e,n){var o=u.call(this)||this;o._world=null;var r=0!==(n=Math.max(l._minMass,Math.min(l._maxMass,n))),i=new Ammo.btDefaultMotionState,s=e.createCollisionShape(),c=new Ammo.btVector3(0,0,0);r&&s.calculateLocalInertia(n,c);var a=new Ammo.btRigidBodyConstructionInfo(n,i,s,c);return d.Helper.safeAmmoObjectDestroy(c),o._btbody=new Ammo.btRigidBody(a),o._btshape=s,o._btmotionstate=i,o._btinfo=a,o._btbody.setFriction(l._defaultFriction),o.isStatic=!r,o.isKinematic=r,o._object3d=t,o}return __extends(l,u),Object.defineProperty(l.prototype,"isStatic",{get:function(){return this._btbody.isStaticObject()},set:function(t){this._toggleCollisionFlag(1,t)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isKinematic",{get:function(){return this._btbody.isKinematicObject()},set:function(t){this._toggleCollisionFlag(2,t),this._btbody.setActivationState(t?4:1),t||this._btbody.activate(),this._world&&this.addRigidBody(this._world)},enumerable:!0,configurable:!0}),l.prototype.addRigidBody=function(t){this.removeRigidBody(t),e(this._btmotionstate,this._object3d),this._btbody.setMotionState(this._btmotionstate),this._world=t,this._world.btWorld.addRigidBody(this._btbody)},l.prototype.removeRigidBody=function(t){this._world===t&&(this._world.btWorld.removeRigidBody(this._btbody),this._world=null)},l.prototype.syncMotionStateToObject3d=function(){this._btbody.isStaticOrKinematicObject()||t(this._btbody.getMotionState(),this._object3d)},l.prototype._toggleCollisionFlag=function(t,e){var n=this._btbody.getCollisionFlags();e?n|=t:n&=~t,this._btbody.setCollisionFlags(n)},l.prototype._onDispose=function(){d.Helper.safeAmmoObjectDestroy(this._btbody),d.Helper.safeAmmoObjectDestroy(this._btinfo),d.Helper.safeAmmoObjectDestroy(this._btmotionstate),d.Helper.safeAmmoObjectDestroy(this._btshape)},l._minMass=0,l._maxMass=100,l._defaultFriction=.75,l}(rt.DisposableObject);d.RigidBody=n}(pxsim||(pxsim={}));