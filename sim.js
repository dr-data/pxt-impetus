"use strict";var rt,serial,KeyboardKey,pxsim,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(t){t.getUserData=function(t,e){return t.userData[e]},t.setUserData=function(t,e,n){t.userData[e]=n};var e=function(){function t(){this._isDisposed=!1}return t.prototype.dispose=function(){this._isDisposed||(this._onDispose(),this._isDisposed=!0)},t}(),n=function(n){function t(t){var e=n.call(this)||this;return e._reference=t,e}return __extends(t,n),Object.defineProperty(t.prototype,"reference",{get:function(){return this._reference},enumerable:!0,configurable:!0}),t}(t.DisposableObject=e);t.ProxyObject=n;var r=function(){function e(t){this._objectcache=new Map,this._creator=t,e._factories.push(this)}return e.forgetAllInstances=function(){e._factories.forEach(function(t){return t.forgetAllInstances()})},e.prototype.instantiate=function(t){return this._creator(t)},e.prototype.instantiateWithCache=function(t){var e=objectHash(t||{},{algorithm:"md5",encoding:"hex",respectType:!1}),n=this._objectcache.get(e);return n||this._objectcache.set(e,n=this.instantiate(t)),n},e.prototype.forgetAllInstances=function(){this._objectcache.clear()},e._factories=new Array,e}();t.ObjectFactory=r}(rt||(rt={})),function(e){function t(t){return function(r){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(this,t)||this;return n._rigidbody=null,n._isDisposed=!1,void 0!==n.castShadow&&(n.castShadow=!0),void 0!==n.receiveShadow&&(n.receiveShadow=!0),n}return __extends(t,r),Object.defineProperty(t.prototype,"position_",{get:function(){return this.position},set:function(t){this.position.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation_",{get:function(){var t=this.rotation.toVector3();return new e.VectorConstructor(THREE.Math.radToDeg(t.x),THREE.Math.radToDeg(t.y),THREE.Math.radToDeg(t.z))},set:function(t){this.rotation.setFromVector3(new e.VectorConstructor(THREE.Math.degToRad(t.x),THREE.Math.degToRad(t.y),THREE.Math.degToRad(t.z)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quaternion_",{get:function(){return this.quaternion},set:function(t){this.quaternion.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale_",{get:function(){return this.scale},set:function(t){this.scale.copy(t)},enumerable:!0,configurable:!0}),t.prototype.setRotationFromAxisAngle=function(t,e){t&&this.setRotationFromAxisAngle(t,THREE.Math.degToRad(e))},t.prototype.setPhysicsEnabled=function(t){this._rigidbody&&(this._rigidbody.isKinematic=!t)},t.prototype.lookAtPosition=function(t){t&&this.lookAt(t)},t.prototype.animate=function(e){this._rigidbody&&this._rigidbody.syncMotionStateToObject3d(),this.children.forEach(function(t){return t.animate(e)})},t.prototype.onAdded=function(e){this._rigidbody&&this._rigidbody.addRigidBody(e.physicsWorld),this.children.forEach(function(t){return t.onAdded(e)})},t.prototype.onRemoved=function(e){this.children.forEach(function(t){return t.onRemoved(e)}),this._rigidbody&&this._rigidbody.removeRigidBody(e.physicsWorld)},t.prototype.copy=function(t,e){throw r.prototype.copy.call(this,t,e),Error()},t.prototype.dispose=function(){this._isDisposed||(this._onDispose(),this._isDisposed=!0)},t.prototype._onDispose=function(){this.children.forEach(function(t){return t.dispose()}),e.Helper.safeObjectDispose(this._rigidbody)},t}(t)}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((e.Object3dMixin=t)(THREE.Object3D));e.Object3d=n}(pxsim||(pxsim={})),(pxsim||(pxsim={})).OrbitControlsConstructor=THREE.OrbitControls,function(o){function t(t){return function(r){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(this,t)||this;return n._controls=new o.OrbitControlsConstructor(n),n._controls.target.set(0,0,0),n._controls.update(),n}return __extends(t,r),t.prototype.setSize=function(t,e){},t}(t)}var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((o.CameraMixin=t)(o.Object3dMixin(THREE.Camera)));o.Camera=e;var n=function(o){function t(t,e,n){var r=o.call(this,t||60,1,e||.2,n||2e3)||this;return r._oldaspect=0,r}return __extends(t,o),t.prototype.setSize=function(t,e){o.prototype.setSize.call(this,t,e);var n=this.aspect=t/e;this._oldaspect!==n&&(this._oldaspect=n,this.updateProjectionMatrix())},t}(t(o.Object3dMixin(THREE.PerspectiveCamera)));o.PerspectiveCamera=n}(pxsim||(pxsim={})),function(t){(t.camera||(t.camera={})).perspectiveCamera=function(){return new t.PerspectiveCamera}}(pxsim||(pxsim={})),(pxsim||(pxsim={})).ColorConstructor=THREE.Color,function(r){var t;(t=r.color||(r.color={})).colorToString=function(t){return"("+255*t.r+", "+255*t.g+", "+255*t.b+")"},t.standardColor=function(t){return new r.ColorConstructor(t)},t.randomColor=function(){return new r.ColorConstructor(Math.random()*(1<<24))},t.colorFromRgb=function(t,e,n){return(new r.ColorConstructor).setRGB(t/255,e/255,n/255)},t.colorFromHsv=function(t,e,n){return(new r.ColorConstructor).setHSL(t/255,e/255,n/255)},t.colorWheel=function(t){return new r.ColorConstructor(t)},t.colorPicker=function(t){return new r.ColorConstructor(t)}}(pxsim||(pxsim={})),function(t){function n(t){var e;e=t+"\r\n",console.log(e),pxsim.runtime.board.writeSerial(e)}t.writeLine=n,t.writeValue=function(t,e){n((t?t+":":"")+e)}}(serial||(serial={})),function(t){var e;(e=t.console||(t.console={})).log=function(t){serial.writeLine(t)},e.logValue=function(t,e){serial.writeValue(t,e)}}(pxsim||(pxsim={})),function(t){t[t.Delete=8]="Delete",t[t.Tab=9]="Tab",t[t.Enter=13]="Enter",t[t.Escape=27]="Escape",t[t.Spacebar=32]="Spacebar",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12"}(KeyboardKey||(KeyboardKey={})),function(r){var t;(t=r.input||(r.input={})).onKeyEvent=function(t,e,n){r.singletonWorldBoard().events.listen(r.keyboardScopeIdFromKey(t),e,n)},t.onMouseEnter=function(t){r.singletonWorldBoard().events.listen(200,0,t)},t.onMouseMove=function(t){r.singletonWorldBoard().events.listen(200,1,t)},t.onMouseLeave=function(t){r.singletonWorldBoard().events.listen(200,2,t)},t.onMouseButtonEvent=function(t,e,n){r.singletonWorldBoard().events.listen(r.mouseScopeIdFromButton(t),e,n)}}(pxsim||(pxsim={})),function(t){function e(t){return(e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._configureShadow=function(){this.shadow.camera instanceof THREE.OrthographicCamera&&(this.shadow.camera.left=-n.distFrustum,this.shadow.camera.right=n.distFrustum,this.shadow.camera.top=n.distFrustum,this.shadow.camera.bottom=-n.distFrustum),this.shadow.bias=1e-4,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048},e}(t)).distFrustum=100,e;var e}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((t.LightMixin=e)(t.Object3dMixin(THREE.Light)));t.Light=n;var r=function(n){function t(t,e){return n.call(this,t||4210752,e||1)||this}return __extends(t,n),t}(e(t.Object3dMixin(THREE.AmbientLight)));t.AmbientLight=r;var o=function(r){function t(t,e){var n=r.call(this,t||16777215,e||1)||this;return n._configureShadow(),n}return __extends(t,r),t}(e(t.Object3dMixin(THREE.DirectionalLight)));t.DirectionalLight=o;var i=function(r){function t(t,e,n){return r.call(this,t||3310847,e||16763007,n||.6)||this}return __extends(t,r),t}(e(t.Object3dMixin(THREE.HemisphereLight)));t.HemisphereLight=i;var s=function(i){function t(t,e,n,r){var o=i.call(this,t||16777215,e||1,n||0,r||2)||this;return o._configureShadow(),o}return __extends(t,i),t}(e(t.Object3dMixin(THREE.PointLight)));t.PointLight=s;var a=function(a){function t(t,e,n,r,o,i){var s=a.call(this,t||16777215,e||1,n||0,r||Math.PI/3,o||0,i||2)||this;return s._configureShadow(),s}return __extends(t,a),t}(e(t.Object3dMixin(THREE.SpotLight)));t.SpotLight=a}(pxsim||(pxsim={})),function(r){var t;(t=r.light||(r.light={})).ambientLight=function(t,e){return new r.DirectionalLight(t,e)},t.directionalLight=function(t,e){return new r.DirectionalLight(t,e)},t.hemisphereLight=function(t,e,n){return new r.HemisphereLight(t,e,n)}}(pxsim||(pxsim={})),function(e){var t;(t=e.loops||(e.loops={})).forever=function(t){e.thread.forever(t)},t.pauseAsync=function(t){return Promise.delay(t)}}(pxsim||(pxsim={})),function(t){function e(t){return function(r){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=r.apply(this,t)||this;return n._density=1,n}return __extends(t,r),Object.defineProperty(t.prototype,"density",{get:function(){return this._density},set:function(t){this._density=t},enumerable:!0,configurable:!0}),t.prototype.copy=function(t){return r.prototype.copy.call(this,t),this.density=t.density,this},t}(t)}var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((t.MaterialMixin=e)(THREE.MeshStandardMaterial)),r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.instantiate=function(t){return e._factory.instantiate({color:(t?t.getHex():void 0)||16777215,emissive:0,metalness:0,roughness:.5})},e._factory=new rt.ObjectFactory(function(t){return new e(t)}),e}(t.Material=n);t.SolidMaterial=r}(pxsim||(pxsim={})),function(e){(e.material||(e.material={})).materialOfColor=function(t){return e.SolidMaterial.instantiate(t)}}(pxsim||(pxsim={})),function(t){t.VectorConstructor=THREE.Vector3,t.QuaternionConstructor=THREE.Quaternion,t.EulerConstructor=THREE.Euler,t.SphericalConstructor=THREE.Spherical}(pxsim||(pxsim={})),function(t){var e;(e=t.math||(t.math={})).degreesInRadians=function(t){return THREE.Math.degToRad(t)},e.radiansInDegrees=function(t){return THREE.Math.radToDeg(t)}}(pxsim||(pxsim={})),function(i){!function(t){function e(t,e,n){return new i.VectorConstructor(t,e,n)}function o(){return e(0,0,0)}function n(t,e,n,r){return new i.QuaternionConstructor(t,e,n,r)}t.vectorToString=function(t){return"("+t.x+", "+t.y+", "+t.z+")"},t.quaternionToString=function(t){return"("+t.x+", "+t.y+", "+t.z+", "+t.w+")"},t.vector=e,t.zeroVector=o,t.unitVector=function(){return e(1,1,1)},t.vectorOp=function(t,e,n){var r=o();switch(e){case 1:return r.addVectors(t,n);case 2:return r.subVectors(t,n);case 3:return r.multiplyVectors(t,n)}throw new Error},t.vectorScalarOp=function(t,e,n){var r=t;switch(e){case 1:return r.addScalar(n);case 2:return r.subScalar(n);case 3:return r.multiplyScalar(n);case 4:return r.divideScalar(n)}},t.quaternion=n,t.zeroQuaternion=function(){return n(0,0,0,0)}}(i.math3d||(i.math3d={}))}(pxsim||(pxsim={})),function(o){var t=function(r){function t(t,e){var n=r.call(this,t,e)||this;return n._rigidbody=new o.RigidBody(n,t,t.volume*e.density),n}return __extends(t,r),t}(o.Object3dMixin(THREE.Mesh));o.Mesh3d=t}(pxsim||(pxsim={})),function(n){var t;(t=n.mesh||(n.mesh={})).fromShapeAndMaterial=function(t,e){return t&&e?new n.Mesh3d(t,e):null},t.materialOf=function(t){if(!(t&&t instanceof n.Mesh3d))return null;var e=t.material;return Array.isArray(e)?0<e.length?e[0]:null:e}}(pxsim||(pxsim={})),(pxsim||(pxsim={})).RaycasterConstructor=THREE.Raycaster,function(e){var t=function(r){function t(){var t=r.call(this)||this;return t._physicsworld=new e.PhysicsWorld,t._camera=null,t._ambientlight=new e.AmbientLight,t._raycaster=new e.RaycasterConstructor,t.background=new e.ColorConstructor(8900331),t._ambientlight.color.setScalar(.5),t.addAt(t._ambientlight,e.math3d.zeroVector()),t}return __extends(t,r),Object.defineProperty(t.prototype,"physicsWorld",{get:function(){return this._physicsworld},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this.background},set:function(t){this.background=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ambientColor",{get:function(){return this._ambientlight.color},set:function(t){this._ambientlight.color=t},enumerable:!0,configurable:!0}),t.prototype.addAt=function(t,e){t&&(t.position.copy(e),this.add(t))},t.prototype.add=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t&&(r.prototype.add.apply(this,t),t.forEach(function(t){return t.onAdded(e)}))},t.prototype.remove=function(t){t&&(t.onRemoved(this),r.prototype.remove.call(this,t))},t.prototype.animate=function(t){r.prototype.animate.call(this,t),this._physicsworld.animate(t),e.singletonWorldBoard().events.queue(1,0,t)},t.prototype.intersectedObjects=function(t,e){if(!this._camera)return null;this._raycaster.setFromCamera({x:t,y:e},this._camera);var n=this._raycaster.intersectObjects(this.children);return n?n.map(function(t){return t.object}):null},t.prototype.setPhysicsEnabled=function(t){},t.prototype.copy=function(t,e){throw r.prototype.copy.call(this,t,e),Error()},t.prototype._onDispose=function(){r.prototype._onDispose.call(this),this._physicsworld.dispose()},t}(e.Object3dMixin(THREE.Scene));e.Scene3d=t}(pxsim||(pxsim={})),function(o){var t;(t=o.scene||(o.scene={})).randomPositionInSphere=function(t){var e=new o.SphericalConstructor(Math.random()*t*.5,Math.random()*Math.PI*2,Math.random()*Math.PI*2);return(new o.VectorConstructor).setFromSpherical(e)},t.randomPositionInCube=function(t){return new o.VectorConstructor(Math.random()*t,Math.random()*t,Math.random()*t).addScalar(-.5*t)},t.intersectedObjectAt=function(t,e){var n=o.world.scene(),r=n?n.intersectedObjects(t,e):null;return r&&0<r.length?r[0]:null},t.onAnimate=function(t){o.singletonWorldBoard().events.listen(1,0,t)}}(pxsim||(pxsim={})),function(s){function t(t){return(e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._volume=0,t._ctorCollisionShape=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},enumerable:!0,configurable:!0}),t.prototype.createCollisionShape=function(){return this._ctorCollisionShape?this._ctorCollisionShape():null},t.prototype.copy=function(t){throw e.prototype.copy.call(this,t),new Error},t.prototype._setShapeVolume=function(t){this._volume=t},t.prototype._setCtorCollisionShape=function(t){this._ctorCollisionShape=t},t.prototype._getBounds=function(){return this._getBoundingBox().getSize(new THREE.Vector3)},t.prototype._getBoundingBox=function(){return this.computeBoundingBox(),this.boundingBox},t.prototype._getBoundingSphere=function(){return this.computeBoundingSphere(),this.boundingSphere},t.prototype._createCollisionShapeFromHalfExtents=function(t){var e=s.Helper.btVector3FromThree(this._getBounds().divideScalar(2)),n=t(e);return n.setMargin(i._collisionMargin),s.Helper.safeAmmoObjectDestroy(e),n},t}(t))._radialSegments=32,e._collisionMargin=.05,e;var e}var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}((s.ShapeMixin=t)(THREE.BufferGeometry));s.Shape3d=i;var e=function(r){function t(t,e){var n=this;return t=t||100,e=e||100,(n=r.call(this,t,e)||this).rotateX(-Math.PI/2),n._setCtorCollisionShape(function(){return n._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btBoxShape(t)})}),n}return __extends(t,r),t}(t(THREE.PlaneBufferGeometry));s.PlaneShape3d=e;var n=function(i){function t(t,e,n,r){var o=this;return t=t||1,e=e||1,n=n||1,(o=i.call(this,t,e,n)||this)._setShapeVolume(t*e*n),o._setCtorCollisionShape(function(){return o._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btBoxShape(t)})}),o}return __extends(t,i),t}(t(THREE.BoxBufferGeometry));s.BoxShape3d=n;var r=function(o){function t(t,e,n){var r=this;return t=t||.5,e=e||1,(r=o.call(this,t,t,e,i._radialSegments,1,n||!1)||this)._setShapeVolume(Math.PI*Math.pow(t,2)*e),r._setCtorCollisionShape(function(){return r._createCollisionShapeFromHalfExtents(function(t){return new Ammo.btCylinderShape(t)})}),r}return __extends(t,o),t}(t(THREE.CylinderBufferGeometry));s.CylinderShape3d=r;var o=function(n){function t(t){var e=this;return t=t||.5,(e=n.call(this,t,i._radialSegments,i._radialSegments)||this)._setShapeVolume(4/3*Math.PI*Math.pow(t,3)),e._setCtorCollisionShape(function(){return new Ammo.btSphereShape(t)}),e}return __extends(t,n),t}(t(THREE.SphereBufferGeometry));s.SphereShape3d=o;var a=function(r){function t(t,e){var n=this;return t=t||.5,e=e||1,(n=r.call(this,t,e,i._radialSegments)||this)._setShapeVolume(Math.PI*Math.pow(t,2)*e/3),n._setCtorCollisionShape(function(){return new Ammo.btConeShape(t,e)}),n}return __extends(t,r),t}(t(THREE.ConeBufferGeometry));s.ConeShape3d=a;var c=function(i){function t(t){var e=this;t=t||1,e=i.call(this,t,2)||this;var n=(new s.QuickHull3d).calculateFromShape3d(e),r=new Ammo.btConvexHullShape;r.setMargin(0);var o=new Ammo.btVector3;return n.points.forEach(function(t){return r.addPoint(s.Helper.btVector3FromThree(t,o))}),s.Helper.safeAmmoObjectDestroy(o),e._setShapeVolume(1),e._setCtorCollisionShape(function(){return r}),e}return __extends(t,i),t}(t(THREEX.TeapotBufferGeometry));s.TeapotShape3d=c}(pxsim||(pxsim={})),function(r){var t;(t=r.shape||(r.shape={})).planeShape=function(t,e){return new r.PlaneShape3d(t,e)},t.boxShape=function(t,e,n){return new r.BoxShape3d(t,e,n)},t.cylinderShape=function(t,e){return new r.CylinderShape3d(t,e)},t.sphereShape=function(t){return new r.SphereShape3d(t)},t.coneShape=function(t,e){return new r.ConeShape3d(t,e)},t.teapotShape=function(t){return new r.TeapotShape3d(t)}}(pxsim||(pxsim={})),function(s){var t=function(n){function t(t){var e=n.call(this)||this;return e._scene3d=new s.Scene3d,e._renderer=new s.Renderer(t),e._renderer.scene=e._scene3d,e._listenerhelper=new s.SimpleEventListenerHelper(e._renderer.container),e._listenerhelper.addEventListener("blur",function(t){return e._onElementFocused(t.target,!1)}),e._listenerhelper.addEventListener("focus",function(t){return e._onElementFocused(t.target,!0)}),e._listenerhelper.addEventListener("mouseenter",function(t){return e._onElementEvent(200,0,t)}),e._listenerhelper.addEventListener("mousemove",function(t){return e._onElementMouseEvent(200,1,t)}),e._listenerhelper.addEventListener("mouseleave",function(t){return e._onElementEvent(200,2,t)}),e._listenerhelper.addEventListener("mousedown",function(t){return e._onElementMouseEvent(s.mouseScopeIdFromButton(t.button),0,t)}),e._listenerhelper.addEventListener("click",function(t){return e._onElementMouseEvent(s.mouseScopeIdFromButton(t.button),1,t)}),e._listenerhelper.addEventListener("dblclick",function(t){return e._onElementMouseEvent(s.mouseScopeIdFromButton(t.button),2,t)}),e._listenerhelper.addEventListener("mouseup",function(t){return e._onElementMouseEvent(s.mouseScopeIdFromButton(t.button),3,t)}),e._listenerhelper.addEventListener("keydown",function(t){return e._onElementEvent(s.keyboardScopeIdFromKey(t.key),0,t)}),e._listenerhelper.addEventListener("keypress",function(t){return e._onElementEvent(s.keyboardScopeIdFromKey(t.key),1,t)}),e._listenerhelper.addEventListener("keyup",function(t){return e._onElementEvent(s.keyboardScopeIdFromKey(t.key),2,t)}),e._onElementFocused(e._renderer.container,!1),e}return __extends(t,n),Object.defineProperty(t.prototype,"scene",{get:function(){return this._scene3d},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0}),t.prototype._onDispose=function(){this._listenerhelper.removeAllEventListeners(),s.Helper.safeObjectDispose(this._renderer),s.Helper.safeObjectDispose(this._scene3d)},t.prototype._onElementEvent=function(t,e,n,r){s.singletonWorldBoard().events.queue(t,e,r)},t.prototype._onElementFocused=function(t,e){t.classList.toggle("blur",!e),t.classList.toggle("focus",e)},t.prototype._onElementMouseEvent=function(t,e,n){if(t){201===t&&0===e&&this._renderer.container.focus();var r=this._renderer.canvas.getBoundingClientRect(),o=(n.clientX-r.left)/r.width*2-1,i=-(n.clientY-r.top)/r.height*2+1;this._onElementEvent(t,e,n,new s.EventCoordValue(o,i))}},t}(rt.DisposableObject);s.World3d=t}(pxsim||(pxsim={})),function(e){var t;(t=e.world||(e.world={})).world=function(){return e.singletonWorldBoard().world},t.scene=function(){var t=e.world.world();return t?t.scene:null}}(pxsim||(pxsim={})),function(n){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._world3d=null,t._events=null,t}return __extends(t,e),Object.defineProperty(t,"singleton",{get:function(){return this._board},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"world",{get:function(){return this._world3d},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),t.prototype.initAsync=function(t){return this.init(),Promise.resolve()},t.prototype.init=function(){this.postkill(),this._world3d=new n.World3d,this._events=new n.WorldEventBus(n.runtime)},t.prototype.kill=function(){this._world3d&&(this._world3d.renderer.pause=!0)},t.prototype.postkill=function(){rt.ObjectFactory.forgetAllInstances(),n.Helper.safeObjectDispose(this._world3d),this._world3d=null},t.prototype.receiveMessage=function(t){},t.prototype.updateView=function(){},t._board=new t,t}(n.BaseBoard);function e(){return t.singleton}n.WorldBoard=t,n.initCurrentRuntime=function(t){return e().postkill(),n.runtime.board=e()},n.singletonWorldBoard=e}(pxsim||(pxsim={})),function(t){t.keyboardScopeIdFromKey=function(t){var e;return"string"==typeof t?(" "===t&&(t="Spacebar"),e=KeyboardKey[t]):e=t,101+e},t.mouseScopeIdFromButton=function(t){return 201+t};var e=function(){},n=function(r){function t(t,e){var n=r.call(this)||this;return n.x=t,n.y=e,n}return __extends(t,r),t.prototype.toActionArgs=function(){return[this.x,this.y]},t}(t.EventValue=e);t.EventCoordValue=n;var r=function(n){function t(t){var e=n.call(this)||this;return e.key=t,e}return __extends(t,n),t.prototype.toActionArgs=function(){return[this.key]},t}(e);t.EventKeyValue=r;var o=function(e){function t(t){return e.call(this,t,function(t){return t?"object"==typeof t?t.toActionArgs():[t]:[]})||this}return __extends(t,e),t}(t.EventBusGeneric);t.WorldEventBus=o}(pxsim||(pxsim={})),function(t){var e=function(){function t(){}return t.btVector3FromThree=function(t,e){return void 0===e&&(e=new Ammo.btVector3),e.setValue(t.x,t.y,t.z),e},t.btQuaternionFromThree=function(t,e){return void 0===e&&(e=new Ammo.btQuaternion),e.setValue(t.x,t.y,t.z,t.w),e},t.arrayFromBufferAttribute=function(t,e){for(var n=new Array(t.count),r=0;r<t.count;r++)n[r]=new e,n[r].fromBufferAttribute(t,r);return n},t.applyFn=function(t,e){return Array.isArray(t)?t.map(e):e(t)},t.safeObjectDispose=function(t){t&&t.dispose()},t.safeAmmoObjectDestroy=function(t){t&&Ammo.destroy(t)},t}();t.Helper=e;var n=function(){function t(t){this.target=t,this._listeners=new Map}return t.prototype.addEventListener=function(t,e){this.target.addEventListener(t,e),this._listeners.set(t,e)},t.prototype.removeEventListener=function(t){var e=this._listeners.get(t);e&&(this.target.removeEventListener(t,e),this._listeners.delete(t))},t.prototype.removeAllEventListeners=function(){var n=this;this._listeners.forEach(function(t,e){n.target.removeEventListener(e,t)}),this._listeners.clear()},t}();t.SimpleEventListenerHelper=n}(pxsim||(pxsim={})),function(n){var r=function(){this.points=[],this.vertices=[],this.normals=[]};n.QuickHull3dResult=r;var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.calculateFromShape3d=function(t){return this.setFromPoints(n.Helper.arrayFromBufferAttribute(t.getAttribute("position"),THREE.Vector3)),this._getResult()},e.prototype._getResult=function(){var i=new r;return this.faces.forEach(function(t){var e=t.edge;do{var n=e.head(),r=n.point,o=!!n.userData;n.userData=!0,o||i.points.push(r),i.vertices.push(r),i.normals.push(t.normal),e=e.next}while(e!==t.edge)}),i},e}(THREEX.QuickHull);n.QuickHull3d=t}(pxsim||(pxsim={})),function(r){var t=function(e){function n(){var t=e.call(this)||this;return t._btconfig=new Ammo.btDefaultCollisionConfiguration,t._btdispatcher=new Ammo.btCollisionDispatcher(t._btconfig),t._btbroadphase=new Ammo.btDbvtBroadphase,t._btconstraintsolver=new Ammo.btSequentialImpulseConstraintSolver,t._btworld=new Ammo.btDiscreteDynamicsWorld(t._btdispatcher,t._btbroadphase,t._btconstraintsolver,t._btconfig),t._btworld.getSolverInfo().m_numIterations=n._numIterationsSolver,t}return __extends(n,e),Object.defineProperty(n.prototype,"btWorld",{get:function(){return this._btworld},enumerable:!0,configurable:!0}),n.prototype.getGravity=function(){return this._btworld.getGravity().y()},n.prototype.setGravity=function(t){var e=new Ammo.btVector3(0,t,0);this._btworld.setGravity(e),r.Helper.safeAmmoObjectDestroy(e)},n.prototype.animate=function(t){this._btworld.stepSimulation(t,n._maxStepSimulation,n._fixedTimeStep)},n.prototype._onDispose=function(){r.Helper.safeAmmoObjectDestroy(this._btworld),r.Helper.safeAmmoObjectDestroy(this._btconstraintsolver),r.Helper.safeAmmoObjectDestroy(this._btbroadphase),r.Helper.safeAmmoObjectDestroy(this._btdispatcher),r.Helper.safeAmmoObjectDestroy(this._btconfig)},n._numIterationsSolver=4,n._maxStepSimulation=3,n._fixedTimeStep=1/60,n}(rt.DisposableObject);r.PhysicsWorld=t}(pxsim||(pxsim={})),(pxsim||(pxsim={})).ClockConstructor=THREE.Clock,function(o){var t=function(n){function r(t){void 0===t&&(t="maincanvas");var e=n.call(this,r._instantiateReference(t))||this;if(e._scene3d=null,e._stats=new Stats,e._clock=new o.ClockConstructor,e._paused=!1,e._callbackRequestId=0,e._onWindowResize=function(){e._container&&(e.reference.setPixelRatio(window.devicePixelRatio),e.reference.setSize(e._container.clientWidth,e._container.clientHeight))},e._id=t,e._container=document.getElementById(t.toString()),!e._container)throw new Error("Canvas container element "+t+" not found.");return THREEX.Detector.webgl?(e._container.innerHTML="",e._container.appendChild(e.reference.domElement),e._container.appendChild(e._stats.dom),window.addEventListener("resize",e._onWindowResize),e._onWindowResize(),e.runRenderLoop()):THREEX.Detector.addGetWebGLMessage({parent:e._container}),e}return __extends(r,n),r._instantiateReference=function(t){var e=r._renderers.get(t);return e||(r._renderers.set(t,e=new THREE.WebGLRenderer({antialias:!0})),e.shadowMap.enabled=!0,e.shadowMap.type=THREE.PCFSoftShadowMap,e.setClearColor(13882323)),e},Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"container",{get:function(){return this._container},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvas",{get:function(){return this.reference.domElement},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scene",{get:function(){return this._scene3d},set:function(t){this._scene3d=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPaused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pause",{set:function(t){this._paused=t},enumerable:!0,configurable:!0}),r.prototype.runRenderLoop=function(){var i=this;this._callbackRequestId=requestAnimationFrame(function(t){if(!i._paused){i._stats.begin();var e=!1,n=i._scene3d;if(n){n.animate(i._clock.getDelta());var r=n.camera;if(r){var o=i.reference.getSize();r.setSize(o.width,o.height),i.reference.render(n,r),e=!0}}e||i.reference.clear(),i._stats.end()}i.runRenderLoop()})},r.prototype.stopRenderLoop=function(){0!==this._callbackRequestId&&(cancelAnimationFrame(this._callbackRequestId),this._callbackRequestId=0)},r.prototype._onDispose=function(){this.stopRenderLoop(),this._container&&(window.removeEventListener("resize",this._onWindowResize),this._container.innerHTML="")},r._renderers=new Map,r}(rt.ProxyObject);o.Renderer=t}(pxsim||(pxsim={})),function(p){function e(t,e){var n,r,o=new Ammo.btTransform;return o.setOrigin(n=p.Helper.btVector3FromThree(e.position)),o.setRotation(r=p.Helper.btQuaternionFromThree(e.quaternion)),t.setWorldTransform(o),p.Helper.safeAmmoObjectDestroy(r),p.Helper.safeAmmoObjectDestroy(n),p.Helper.safeAmmoObjectDestroy(o),t}function t(t,e){var n=new Ammo.btTransform;t.getWorldTransform(n);var r=n.getOrigin(),o=n.getRotation();e.position.set(r.x(),r.y(),r.z()),e.quaternion.set(o.x(),o.y(),o.z(),o.w()),p.Helper.safeAmmoObjectDestroy(n)}p.btMotionStateFromObject3d=e,p.btMotionStateToObject3d=t;var n=function(u){function l(t,e,n){var r=u.call(this)||this;r._world=null;var o=0!==(n=Math.max(l._minMass,Math.min(l._maxMass,n))),i=new Ammo.btDefaultMotionState,s=e.createCollisionShape(),a=new Ammo.btVector3(0,0,0);o&&s.calculateLocalInertia(n,a);var c=new Ammo.btRigidBodyConstructionInfo(n,i,s,a);return p.Helper.safeAmmoObjectDestroy(a),r._btbody=new Ammo.btRigidBody(c),r._btshape=s,r._btmotionstate=i,r._btinfo=c,r._btbody.setFriction(l._defaultFriction),r.isStatic=!o,r.isKinematic=o,r._object3d=t,r}return __extends(l,u),Object.defineProperty(l.prototype,"isStatic",{get:function(){return this._btbody.isStaticObject()},set:function(t){this._toggleCollisionFlag(1,t)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"isKinematic",{get:function(){return this._btbody.isKinematicObject()},set:function(t){this._toggleCollisionFlag(2,t),this._btbody.setActivationState(t?4:1),t||this._btbody.activate(),this._world&&this.addRigidBody(this._world)},enumerable:!0,configurable:!0}),l.prototype.addRigidBody=function(t){this.removeRigidBody(t),e(this._btmotionstate,this._object3d),this._btbody.setMotionState(this._btmotionstate),this._world=t,this._world.btWorld.addRigidBody(this._btbody)},l.prototype.removeRigidBody=function(t){this._world===t&&(this._world.btWorld.removeRigidBody(this._btbody),this._world=null)},l.prototype.syncMotionStateToObject3d=function(){this._btbody.isStaticOrKinematicObject()||t(this._btbody.getMotionState(),this._object3d)},l.prototype._toggleCollisionFlag=function(t,e){var n=this._btbody.getCollisionFlags();e?n|=t:n&=~t,this._btbody.setCollisionFlags(n)},l.prototype._onDispose=function(){p.Helper.safeAmmoObjectDestroy(this._btbody),p.Helper.safeAmmoObjectDestroy(this._btinfo),p.Helper.safeAmmoObjectDestroy(this._btmotionstate),p.Helper.safeAmmoObjectDestroy(this._btshape)},l._minMass=0,l._maxMass=100,l._defaultFriction=.75,l}(rt.DisposableObject);p.RigidBody=n}(pxsim||(pxsim={}));